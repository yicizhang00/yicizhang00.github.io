<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>设计模式 | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="设计模式"><meta name="application-name" content="设计模式"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="设计模式"><meta property="og:url" content="http://example.com/2025/08/12/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="设计原则1.SOLID1.S-单一职责原则类的设计要高内聚低耦合，一个类只有一个引发其变化的原因。 2.O-开闭原则系统要扩展功能，而不是修改原有代码 3.L-里氏替换原则 子类必须能够代替父类，并保持其正确性 4.I-接口隔离原则客户端不应该被迫依赖其不使用的方法 5.D-依赖倒置原则高层模块不应"><meta property="og:locale" content="en"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="John Doe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="设计原则1.SOLID1.S-单一职责原则类的设计要高内聚低耦合，一个类只有一个引发其变化的原因。 2.O-开闭原则系统要扩展功能，而不是修改原有代码 3.L-里氏替换原则 子类必须能够代替父类，并保持其正确性 4.I-接口隔离原则客户端不应该被迫依赖其不使用的方法 5.D-依赖倒置原则高层模块不应"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/08/12/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: John Doe","link":"Link: ","source":"Source: Hexo","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Hexo',
  title: '设计模式',
  postAI: '',
  pageFillDescription: '设计原则, 1.SOLID, 1.S-单一职责原则, 2.O-开闭原则, 4.I-接口隔离原则, 5.D-依赖倒置原则, 2.其他设计原则, 1.迪米特法则, 2.合成复用原则, 设计模式, 创建型模式, 1.单例模式, 1.饿汉式（Eager Initialization）, 2.懒汉式（Lazy Initialization线程不安全）, 3.懒汉式（线程安全版）, 4.双重检查锁(DCL), 5.静态内部类, 6.枚举类, SLF4J的单例模式, 2.工厂方法模式, 3.抽象工厂方法模式, 4.建造者模式, 内部静态类, 客户端, ✅ 优点, ❌ 缺点, Lombok 的 @Builder, StringBuilder, 5.原型模式, 1. 浅拷贝（Shallow Copy）, 2. 深拷贝（Deep Copy）, Java中应用, 结构型模式, 6.适配器模式, Java中的标准适配器, java的实现例子, ✅ 优点, ❌ 缺点, 7.装饰器模式, java实现例子, 现实例子, ✅ 优点, ❌ 缺点, 8.代理模式, 代理模式类型, ✅ 优点, ❌ 缺点, 9.外观模式, ✅ 优点, ❌ 缺点, 10.桥接模式, ✅ 优点, ❌ 缺点, 11.组合模式, ✅ 优点, ❌ 缺点, 12.享元模式, ✅ 优点, ❌ 缺点, 行为型模式, 观察者模式, ✅ 优点, ❌ 缺点, 策略模式, ✅ 优点, ❌ 缺点, 责任链模式, ✅  优点, ❌ 缺点, 状态模式, ✅ 优点, ❌ 缺点, 命令模式, ✅ 优点, ❌ 缺点, 迭代器模式, ✅ 优点, ❌ 缺点, 备忘录模式, ✅ 优点, ❌ 缺点, 解释器模式, ✅ 优点, ❌ 缺点, 中介者模式, ✅ 优点, ❌ 缺点, 模板方法模式, ✅ 优点, ❌ 缺点, 访问者模式, ✅ 优点, ❌ 缺点设计原则单一职责原则类的设计要高内聚低耦合一个类只有一个引发其变化的原因开闭原则系统要扩展功能而不是修改原有代码里氏替换原则子类必须能够代替父类并保持其正确性接口隔离原则客户端不应该被迫依赖其不使用的方法依赖倒置原则高层模块不应该依赖低层模块两者都应该依赖抽象其他设计原则迪米特法则一个对象应该对其他对象有尽可能少的了解降低耦合避免过长调用链合成复用原则优先使用组合而不是继承意义继承是强耦合组合更灵活设计模式创建型模式单例模式核心思想某个类只有一个实例并且提供一个全局访问点来获取这个实例结构构造器私有化静态实例全局访问方法适用场景配置对象线程池日志系统优点控制全局唯一对象节省资源缺点全局状态可能导致代码难以测试应用默认单例饿汉式特点饿汉式在类加载时就创建对象即在类的加载阶段创建优点线程安全简单缺点一开始就加载可能会导致内存浪费懒汉式线程不安全特点只有在需要用到这个实例时才进行第一次创建缺点多线程环境下可能有多个线程同时进入中导致创建多个实例懒汉式线程安全版在实例方法加锁等价于锁的对象是当前实例同一个对象的多个实例方法调用时会互斥不同对象之间互不影响在静态方法加锁等价于锁的对象是类的对象整个类范围内所有实例共享一把锁无论从哪个对象或类名调用都要竞争同一把类锁特点因此懒汉式的线程安全版加的是静态方法锁即对整个类的对象加锁优点线程安全缺点每次调用都需要加锁效率低双重检查锁其中关键字防止指令重排在中创建一个对象可以大概分为三步分配内存初始化对象将指向内存而和的指令重排会导致分配内存将指向内存初始化对象那么一个对象在可能会直接一个存在引用但是未初始化完成的对象优点对比整体加锁外层的循环可以在已经存在实例时直接返回单例对象静态内部类外部类的加载当加载时并不会立即加载类所以此时单例对象还没有被创建的加载与初始化只有在第一次调用时才会触发对类的主动使用从而导致被加载并初始化在初始化阶段才会执行线程安全保证在类的初始化阶段会保证方法即类的静态初始化逻辑对同一个类只会被执行一次并且是由保证的同步过程因此不需要天然线程安全特点采用了的同步过程保证只会加载一次枚举类特点天然防止反射和序列化破坏反射破坏不了层面禁止序列化也破坏不了自动处理缺点语义上可能不如类清晰的单例模式在中我们可以得到一个存储各个类的使用其保证每个类只有一个实例使用存储已创建的实例先检查缓存中是否存在不存在则创建并放入缓存对于每一个类创建唯一一个对象使用保持线程安全在类中在类中工厂方法模式核心思想定义一个创建对象的接口让子类决定实例化哪个类结构抽象工厂接口具体工厂实现适用场景需要根据环境决定创建的对象优点解耦对象创建和使用缺点类数量增加应用的的和方法工厂方法模式主要有以下角色产品接口抽象类定义产品的抽象如接口具体产品类实现接口如抽象工厂创建者声明工厂方法返回工厂方法返回抽象产品使用工厂方法具体工厂类实现工厂方法返回具体的客户端实例化过程使用工厂方法创建按钮优点符合开闭原则新增产品时只需要新增工厂类不改原有代码客户端只依赖抽象降低耦合容易扩展产品族缺点每增加一个产品类就要写一个新的工厂类类的数量会增加结构比简单工厂复杂抽象工厂方法模式抽象工厂模式是一种创建型设计模式它提供一个接口可以创建一系列相关或相互依赖的对象而无需指定它们的具体类抽象产品每个产品的抽象例如按钮接口复选框接口具体产品具体产品实现如抽象工厂定义创建一组抽象产品的方法具体工厂实现抽象工厂的方法生产具体产品族客户端通过抽象工厂获取产品只依赖抽象不关心具体实现建造者模式建造者模式是一种将复杂对象的构造过程与表示分离的设计模式使得同样的构建过程可以创建不同的表示内部静态类客户端优点将复杂对象的构建和表示分离代码更清晰支持链式调用易读性强可以复用构造步骤创建不同对象符合单一职责原则负责构造负责表示缺点类数量可能增多传统写法需要多个不适合简单对象会显得过度设计的通过在类或构造器方法上加自动生成内部静态类省去手写的麻烦编译后会帮你生成一个类支持链式调用使用不断追加内容最后通过得到结果不是严格的建造者模式但用法上体现了模式的思想链式构建最后生成结果原型模式浅拷贝拷贝对象本身但引用类型属性只拷贝引用不拷贝对象本身即共享引用可能会引发改一处动全身的问题深拷贝不仅拷贝对象本身还拷贝它引用的所有对象新对象完全独立不会共享引用实现方法手写在里面递归克隆引用对象或者通过序列化反序列化实现中应用浅拷贝浅拷贝提供了接口方法但是是一个标记接口不定义方法必须重写并调用否则会抛出很多框架如更推荐拷贝构造函数工具类如的来做深拷贝结构型模式解决对象和类如何组合的问题适配器模式核心思想将不兼容的接口转换为可用接口结构包装适用场景老代码接口不兼容优点复用已有类缺点类层次复杂化应用参数适配器类适配器继承继承实现接口通过继承获得的功能组合适配持有引用持有的引用转发调用更灵活可以适配多个不同的接口适配器提供一个抽象类实现接口的所有方法为空实现子类可以选择性地重写需要的方法常用于回调接口场景比如的监听器中的标准适配器返回对象返回对象和不完全是适配器模式要实现适配器模式类似于以下方式将转为的实现例子让方钉适配圆孔圆孔圆钉方钉适配器客户端优点解耦客户端和被适配类解耦复用复用已有功能无需改源码灵活对象适配器方式支持组合多个适配对象缺点增加了系统复杂度多了一层转换类适配器方式受限于单继承装饰器模式核心思想在不修改对象代码的前提下动态添加功能结构包含被装饰对象适用场景多层功能增强优点比继承更灵活缺点多层装饰会难以调试应用流在不改变原有对象结构的前提下动态地给对象增加新的功能它通过包装一个对象来增强功能而不是通过继承使用同一个接口保证客户端无感知实现例子执行基本操作抽象装饰器默认转发具体装饰器记录日志检查权限客户端使用增强功能先权限检查再日志记录再执行基本操作现实例子是抽象构件是具体构件是装饰器它们可以层层嵌套的本质上也是装饰思想在初始化前后加功能框架滚动条装饰器可以给窗口动态加滚动条优点扩展性强不修改原有类就能添加功能灵活组合不同装饰器可以任意组合遵循开闭原则对扩展开放对修改关闭缺点对象层层包装调试时可能比较复杂装饰链过长时可能影响性能和可读性代理模式核心思想通过代理对象控制对真实对象的访问结构持有适用场景远程代理安全代理延迟加载优点控制访问增强功能缺点增加层级可能影响性能应用动态代理定义接口真实主题执行真实请求代理主题可以做权限控制检查权限延迟初始化懒加载调用真实对象可以做日志记录日志客户端代理模式类型静态代理编译期就写死了代理类缺点如果接口很多需要写很多代理类动态代理动态代理基于反射要求被代理对象必须实现接口动态代理基于字节码生成可以代理没有实现接口的类就是基于动态代理实现的优点控制访问隔离客户端与真实对象可扩展代理可在不修改真实对象的前提下增强功能提高灵活性支持远程调用懒加载等模式缺点可能增加系统复杂度动态代理可能影响性能尤其是反射和字节码生成外观模式子系统电视音响播放器外观外观类电影模式一个简单的方法背后执行一系列复杂操作准备进入电影模式电影模式准备就绪结束模式另一个简单的方法准备退出电影模式所有设备已关闭客户端客户端创建外观对象客户端无需关心子系统的复杂性客户端只需调用一个简单的方法框架就是外观模式的应用它们对复杂的数据库操作操作调用进行了封装客户端只需调用简单方法日志框架就是外观底层可能是但客户端只依赖统一接口电脑开机按下电源键调用内存硬盘等子系统微服务网关外部系统只调用网关网关再去调度多个微服务优点简化调用屏蔽复杂性让客户端更容易使用系统降低耦合客户端与子系统解耦只依赖更安全外观类可以控制客户端访问的子系统范围缺点可能成为上帝类职责过多增加了一层间接调用灵活性降低客户端无法访问到子系统的所有功能桥接模式核心思想将抽象与实现分离使它们可以独立变化解决组合爆炸问题结构持有适用场景多维度扩展颜色形状优点避免类爆炸缺点增加抽象层应用接口驱动实现具体实现实现者接口定义消息发送方式具体实现者邮件发送通过邮件发送消息具体实现者短信发送通过短信发送消息抽象层抽象类定义消息类型抽象方法留给子类实现细化抽象普通消息普通消息直接发送细化抽象加急消息加急消息可以添加额外的处理逻辑加急客户端桥接普通消息邮件发送这是一条普通消息桥接加急消息短信发送这是一条加急消息优点避免类爆炸降低继承层次抽象与实现可以独立扩展互不影响符合开闭原则缺点增加了系统复杂性要多设计一层适合变化维度明显的场景不适合单一维度系统组合模式核心思想将对象组合成树形结构使用户对单个对象和组合对象使用一致接口结构适用场景层次结构文件夹文件优点一致性操作缺点难以限制组合层次应用组件树抽象组件叶子节点文件容器节点目录客户端文件系统文件和文件夹统一看作节点组织架构员工和部门都实现接口菜单系统菜单项和子菜单统一处理图形绘制系统线段圆形组合图形优点统一性客户端可以统一处理单个对象和组合对象扩展性强新增叶子节点或组合节点时不影响已有代码层次结构清晰天然适合树形数据表示缺点系统会产生过多的细粒度对象节点多时内存占用高控制粒度可能变弱比如有些方法只适用于叶子但接口统一后容易被误用享元模式核心思想共享对象减少内存消耗结构管理共享对象适用场景大量细粒度对象字符棋子优点节省内存缺点逻辑复杂化应用缓存字符串常量池抽象享元具体享元内部状态共享内部状态外部状态享元工厂客户端位置位置位置享元池大小常量池字符串字面量会被放入常量池复用相同字符串对象缓存总是返回缓存对象避免频繁创建数据库连接池线程池资源复用避免频繁创建销毁字体渲染图标缓存文本编辑器中重复出现的字符图标只创建一个对象位置作为外部状态游戏对象子弹树木草地等大量相同对象可以复用优点大大减少内存中对象的数量提升性能共享对象更容易集中管理节省系统资源缺点引入了区分内部状态和外部状态的复杂性外部状态需要由客户端维护增加了使用成本过度使用可能导致系统结构不清晰行为型模式观察者模式核心思想对象状态改变时通知所有依赖者结构适用场景事件订阅优点解耦发布与订阅缺点链式通知可能影响性能应用事件监听基础发布者具体发布者优点解耦主题和观察者之间是抽象依赖不直接耦合灵活扩展增加新的观察者无需修改主题代码支持广播通信一个事件可以通知多个对象缺点性能问题观察者数量多时通知会很耗时通知链复杂若观察者之间有依赖可能引发级联更新难以调试内存泄漏风险如果观察者忘记移除引用可能导致对象无法被回收策略模式核心思想封装一系列算法使它们可以互换结构适用场景不同算法可替换优点避免大量缺点客户端必须知道所有策略应用支付方式选择定义一系列算法策略将每个算法封装起来并使它们可以相互替换让算法的变化独立于使用它的客户端简单说把拆出来封装成可替换的策略类客户端只依赖抽象策略具体实现由外部注入环境类策略接口具体策略类使用支付宝支付元使用微信支付元使用信用卡支付元客户端开始支持方法它可作为一种替代策略模式的简单方式这里有一些核心程序库中策略模式的示例对的调用来自方法还有所有接受和对象作为参数的方法优点遵循开闭原则新增策略不需要改避免大量算法可自由切换灵活性高策略类可以复用缺点会增加类的数量每个策略都是一个类客户端必须了解不同策略的区别才能正确选择如果策略过多维护成本可能变高责任链模式核心思想多个对象依次处理请求直到被处理结构链适用场景请求过滤拦截器优点解耦请求与处理者缺点调试困难可能无人处理请求应用过滤器链日志框架抽象处理者下一个处理者具体处理者批准了天假批准了天假批准了天假批准了天假客户端构建责任链组长经理总监发起请求过滤器链请求经过一系列编码过滤器权限过滤器日志过滤器每个要么处理要么传递拦截器链多个切面事务日志安全依次执行日志处理多级日志记录器审批流程工作流引擎常见于系统请假审批费用报销优点遵循开闭原则新增处理者只需要加类不影响现有逻辑请求和处理逻辑解耦灵活性高可以动态组合处理链缺点如果链太长请求可能会经过很多节点才被处理效率低不保证一定会被处理可能没人接收调试和追踪较麻烦状态模式核心思想对象行为随内部状态改变而改变结构适用场景状态机优点消除缺点类数量增加应用连接状态环境类持有状态对象对外提供接口但内部调用委托给当前状态对象初始状态抽象状态定义不同状态下的公共行为接口具体状态实现具体状态下的逻辑可以决定是否切换到其他状态订单待支付执行支付操作切换到已支付状态订单已支付执行发货操作切换到已发货状态订单已发货执行确认收货操作切换到已完成状态订单已完成不可操作优点遵循开闭原则新增状态不影响已有逻辑状态切换逻辑清晰避免大量把与状态相关的行为封装在独立类里职责清晰缺点状态类数量可能过多增加系统复杂度状态切换的逻辑分散在各个状态类里维护时可能比较麻烦命令模式核心思想将请求封装为对象支持撤销排队操作结构适用场景事务日志操作优点解耦请求与执行缺点类数量增加应用按钮命令数据库事务日志抽象命令接口支持撤销具体命令接收者电灯已打开电灯已关闭调用者客户端打开灯撤销关灯关灯撤销开灯优点解耦调用者与接收者解耦扩展性高开闭原则新增命令只需增加类不影响已有代码可撤销重做命令对象可记录历史支持回滚组合命令可实现宏命令多个命令一起执行缺点会增加类的数量每个命令一个类如果命令过多代码结构可能比较复杂迭代器模式核心思想顺序访问集合元素而不暴露内部结构结构接口适用场景集合遍历优点统一遍历方式缺点额外开销应用的接口提供一种方法顺序访问聚合对象中的各个元素而不暴露其内部表示通俗说不管集合是数组链表还是树用户只需要用迭代器按顺序取元素不必关心内部数据结构集合类负责存储数据迭代器负责遍历数据接口优点遵循单一职责原则集合负责存储迭代器负责遍历封装性好不用暴露集合的内部结构可扩展性强支持多种遍历方式正向反向跳跃缺点迭代器对象会额外消耗内存如果集合被修改迭代器可能失效的机制备忘录模式核心思想保存对象内部状态支持撤销结构适用场景编辑器撤销游戏存档优点封装状态缺点内存消耗大应用功能发起人创建备忘录从备忘录恢复内部类保证外界不能随便操作管理人客户端第一次输入第二次输入第三次输入当前内容撤销一次撤销两次优点封装性好不暴露对象的内部细节简化了发起人只需要保存恢复不关心历史的管理符合单一职责原则状态的存储交给备忘录历史管理交给看护者缺点可能消耗大量内存如果频繁保存状态在复杂对象里备份状态的开销可能很大如果需要支持增量存档实现会变复杂解释器模式核心思想为语言定义文法并解释执行结构接口适用场景简单语言解析优点扩展性强缺点复杂文法难以维护应用正则表达式解析器抽象表达式终结符表达式非终结符表达式客户端构建表达式上下文赋值解释结果优点易于扩展每个文法规则对应一个类新增规则时只需新增类代码结构清晰将复杂表达式的解析逻辑拆分成对象树符合开闭原则缺点类数量可能爆炸每个规则一个类对于复杂文法性能差不如编译原理里的解析器生成工具可读性下降大量小类不利于维护中介者模式核心思想通过中介对象封装对象之间的交互结构适用场景复杂交互优点减少对象间耦合缺点中介者可能过于复杂应用的抽象中介者具体中介者抽象同事类具体同事类客户端大家好你好框架窗口按钮输入框之间的交互通常用中介者对话框管理器聊天室消息队列事件总线用户或模块之间通过中介者聊天室消息中心通信航班调度系统飞机同事通过塔台中介者协调起降之间的依赖关系通过容器调度本质上也是一种中介者思想优点降低对象之间的耦合解耦合将交互逻辑集中到一个中介者便于维护符合迪米特法则最少知识原则对象只与中介者交互缺点中介者本身可能变得过于复杂演变成上帝类过度使用会让逻辑集中在一个类里维护困难模板方法模式核心思想定义算法骨架子类实现具体步骤结构抽象类具体实现类适用场景算法流程固定但部分步骤变化优点复用流程逻辑缺点子类自由度受限应用抽象类模板方法规定流程具体子类读取数据处理数据写入结果读取数据处理数据写入结果客户端优点封装不变部分扩展可变部分遵循开闭原则新增子类即可扩展新的算法变种代码复用把公共部分提取到父类缺点子类数量可能过多每个变化点一个子类继承关系使得父类对子类有一定的限制不如组合灵活访问者模式核心思想将操作从对象结构中分离出来避免修改类定义结构适用场景对象结构稳定操作频繁变化优点增加新操作简单缺点增加新元素困难应用编译器语法树遍历访问者接口具体访问者递归访问元素接口具体元素客户端打印统计大小总大小优点符合开闭原则数据结构不变增加新操作很容易操作集中将操作逻辑集中到访问者类中避免分散在元素类里支持对不同类型元素做不同操作缺点增加新元素困难如果要给结构中加一种新元素就要修改所有访问者违背开闭原则结构复杂需要双重分派侵入性元素类必须暴露自己的让访问者访问内部',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2026-01-05 17:06:22',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Hexo</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 1.05rem;">leetcode<sup>5</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.05rem;">分布式<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>2</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">网络安全<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2026/01/"><span class="card-archive-list-date">January 2026</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">December 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">September 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">August 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">28</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url">设计模式</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/java/" itemprop="url">java</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">设计模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-08-11T17:55:16.000Z" title="Created 2025-08-12 01:55:16">2025-08-12</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2026-01-05T09:06:22.199Z" title="Updated 2026-01-05 17:06:22">2026-01-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/08/12/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><header><a class="post-meta-categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url">设计模式</a><a class="post-meta-categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/java/" itemprop="url">java</a><h1 id="CrawlerTitle" itemprop="name headline">设计模式</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">John Doe</span><time itemprop="dateCreated datePublished" datetime="2025-08-11T17:55:16.000Z" title="Created 2025-08-12 01:55:16">2025-08-12</time><time itemprop="dateCreated datePublished" datetime="2026-01-05T09:06:22.199Z" title="Updated 2026-01-05 17:06:22">2026-01-05</time></header><h1 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h1><h2 id="1-SOLID"><a href="#1-SOLID" class="headerlink" title="1.SOLID"></a>1.SOLID</h2><h3 id="1-S-单一职责原则"><a href="#1-S-单一职责原则" class="headerlink" title="1.S-单一职责原则"></a>1.S-单一职责原则</h3><p>类的设计要<strong>高内聚低耦合</strong>，一个类只有一个引发其变化的原因。</p>
<h3 id="2-O-开闭原则"><a href="#2-O-开闭原则" class="headerlink" title="2.O-开闭原则"></a>2.O-开闭原则</h3><p>系统要扩展功能，而不是修改原有代码</p>
<p>3.L-里氏替换原则</p>
<p>子类必须能够代替父类，并保持其正确性</p>
<h3 id="4-I-接口隔离原则"><a href="#4-I-接口隔离原则" class="headerlink" title="4.I-接口隔离原则"></a>4.I-接口隔离原则</h3><p>客户端不应该被迫依赖其不使用的方法</p>
<h3 id="5-D-依赖倒置原则"><a href="#5-D-依赖倒置原则" class="headerlink" title="5.D-依赖倒置原则"></a>5.D-依赖倒置原则</h3><p>高层模块不应该依赖低层模块，两者都应该依赖抽象。</p>
<h2 id="2-其他设计原则"><a href="#2-其他设计原则" class="headerlink" title="2.其他设计原则"></a>2.其他设计原则</h2><h3 id="1-迪米特法则"><a href="#1-迪米特法则" class="headerlink" title="1.迪米特法则"></a>1.迪米特法则</h3><p>一个对象应该对其他对象有尽可能少的了解。</p>
<p>降低耦合，避免过长调用链</p>
<h3 id="2-合成复用原则"><a href="#2-合成复用原则" class="headerlink" title="2.合成复用原则"></a>2.合成复用原则</h3><p>优先使用组合，而不是继承。</p>
<p> 意义：继承是“强耦合”，组合更灵活。</p>
<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="创建型模式"><a href="#创建型模式" class="headerlink" title="创建型模式"></a>创建型模式</h2><h3 id="1-单例模式"><a href="#1-单例模式" class="headerlink" title="1.单例模式"></a>1.单例模式</h3><p><strong>核心思想</strong>：某个类只有一个实例，并且提供一个全局访问点来获取这个实例。<br> <strong>结构</strong>：构造器私有化 + 静态实例 + 全局访问方法。<br> <strong>适用场景</strong>：配置对象、线程池、日志系统。<br> <strong>优点</strong>：控制全局唯一对象，节省资源。<br> <strong>缺点</strong>：全局状态可能导致代码难以测试。<br> <strong>应用</strong>：<code>Runtime.getRuntime()</code>，Spring 默认 bean 单例。</p>
<h4 id="1-饿汉式（Eager-Initialization）"><a href="#1-饿汉式（Eager-Initialization）" class="headerlink" title="1.饿汉式（Eager Initialization）"></a>1.<strong>饿汉式（Eager Initialization）</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特点：饿汉式在类加载时就创建对象，即在类的Initialization（加载）阶段创建。</p>
<p>优点：线程安全简单。</p>
<p>缺点：一开始就加载可能会导致内存浪费。</p>
<h4 id="2-懒汉式（Lazy-Initialization，线程不安全）"><a href="#2-懒汉式（Lazy-Initialization，线程不安全）" class="headerlink" title="2.懒汉式（Lazy Initialization，线程不安全）"></a>2.懒汉式（Lazy Initialization，线程不安全）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>特点：只有在需要用到这个实例时才进行第一次创建。</p>
<p>缺点：多线程环境下，可能有多个线程同时进入<code>if(instance==null)</code>中，导致创建多个实例。</p>
<h4 id="3-懒汉式（线程安全版）"><a href="#3-懒汉式（线程安全版）" class="headerlink" title="3.懒汉式（线程安全版）"></a>3.懒汉式（线程安全版）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li>在实例方法加锁</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public synchronized void foo() &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void foo() &#123;</span><br><span class="line">    synchronized(this) &#123;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>锁的对象是 <strong>当前实例 (this)</strong>。</p>
</li>
<li><p>同一个对象的多个 <code>synchronized</code> 实例方法，调用时会互斥。</p>
</li>
<li><p>不同对象之间互不影响。</p>
</li>
</ul>
<ol start="2">
<li>在静态方法加锁</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static synchronized void bar() &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static void bar() &#123;</span><br><span class="line">    synchronized (Singleton.class) &#123;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>锁的对象是 <strong>类的 <code>Class</code> 对象</strong>。</p>
</li>
<li><p>整个类范围内（所有实例）共享一把锁。无论从哪个对象或类名调用，都要竞争 <strong>同一把类锁</strong>。</p>
</li>
</ul>
<p>特点：因此懒汉式的线程安全版加的是静态方法锁，即对整个类的对象加锁。</p>
<p>优点：线程安全</p>
<p>缺点：每次调用都需要加锁，效率低。</p>
<h4 id="4-双重检查锁-DCL"><a href="#4-双重检查锁-DCL" class="headerlink" title="4.双重检查锁(DCL)"></a>4.双重检查锁(DCL)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中<code>volatile</code>关键字防止指令重排，在Java中创建一个对象可以大概分为三步：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">memory = allocate();         // 1. 分配内存</span><br><span class="line">ctorInstance(memory);        // 2. 初始化对象</span><br><span class="line">instance = memory;           // 3. 将 instance 指向内存</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而JIT和CPU的指令重排会导致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory = allocate();         // 1. 分配内存</span><br><span class="line">instance = memory;           // 2. 将 instance 指向内存</span><br><span class="line">ctorInstance(memory);        // 3. 初始化对象</span><br></pre></td></tr></table></figure>

<p>那么一个对象在<code>if(instance==null)</code>可能会直接<code>return</code>一个存在引用但是未初始化完成的对象。</p>
<p>优点：对比整体加锁，外层的if循环可以在已经存在实例时直接返回单例对象。</p>
<h4 id="5-静态内部类"><a href="#5-静态内部类" class="headerlink" title="5.静态内部类"></a>5.静态内部类</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">    private Singleton() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    private static class Holder &#123;</span><br><span class="line">        private static final Singleton INSTANCE = new Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Singleton getInstance() &#123;</span><br><span class="line">        return Holder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>外部类 <code>Singleton</code> 的加载</strong><br> 当 JVM 加载 <code>Singleton.class</code> 时，并不会立即加载 <code>Holder</code> 类。<br> 所以此时单例对象 <strong>还没有被创建</strong>。</p>
<p><strong><code>Holder</code> 的加载与初始化</strong><br> 只有在第一次调用 <code>Singleton.getInstance()</code> 时，才会触发对 <code>Holder</code> 类的主动使用，从而导致 <code>Holder</code> 被 <strong>加载并初始化</strong>。<br> 在 <code>Holder</code> 初始化阶段，<code>INSTANCE = new Singleton()</code> 才会执行。</p>
<p><strong>线程安全保证</strong><br> JVM 在类的初始化阶段会保证：</p>
<ul>
<li><code>&lt;clinit&gt;()</code> 方法（即类的静态初始化逻辑）对同一个类只会被执行一次</li>
<li>并且是由 JVM 保证的 <strong>同步过程</strong><br> 因此不需要 <code>synchronized</code>，天然线程安全。</li>
</ul>
<p>特点：采用了JVM的同步过程保证只会加载一次。</p>
<h4 id="6-枚举类"><a href="#6-枚举类" class="headerlink" title="6.枚举类"></a>6.枚举类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;working...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特点：天然防止反射和序列化破坏。<strong>反射破坏不了</strong>（JVM 层面禁止），<strong>序列化也破坏不了</strong>（JVM 自动处理）。</p>
<p>缺点：语义上可能不如类清晰。</p>
<h4 id="SLF4J的单例模式"><a href="#SLF4J的单例模式" class="headerlink" title="SLF4J的单例模式"></a>SLF4J的单例模式</h4><p>在<code>LoggerFactory</code>中我们可以得到一个存储各个类的ConcurrentHashMap，使用其保证每个类只有一个实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggerFactory</span> &#123;</span><br><span class="line">    <span class="comment">// 使用ConcurrentHashMap存储已创建的Logger实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Logger&gt; loggerMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getLogger(clazz.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="comment">// 先检查缓存中是否存在</span></span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> loggerMap.get(name);</span><br><span class="line">        <span class="keyword">if</span> (logger != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> logger;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不存在则创建，并放入缓存</span></span><br><span class="line">        logger = <span class="keyword">new</span> <span class="title class_">Logger</span>(name);</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">existingLogger</span> <span class="operator">=</span> loggerMap.putIfAbsent(name, logger);</span><br><span class="line">        <span class="keyword">return</span> existingLogger != <span class="literal">null</span> ? existingLogger : logger;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于每一个类创建唯一一个<code>Logger</code>对象，使用ConcurrentHashMap保持线程安全</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在类A中</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ClassA.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在类B中</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ClassB.class);</span><br></pre></td></tr></table></figure>

<h3 id="2-工厂方法模式"><a href="#2-工厂方法模式" class="headerlink" title="2.工厂方法模式"></a>2.工厂方法模式</h3><p><strong>核心思想</strong>：定义一个创建对象的接口，让子类决定实例化哪个类。<br><strong>结构</strong>：抽象工厂接口 + 具体工厂实现。<br><strong>适用场景</strong>：需要根据环境决定创建的对象。<br><strong>优点</strong>：解耦对象创建和使用。<br><strong>缺点</strong>：类数量增加。<br><strong>应用</strong>：SLF4J的<code>LoggerFactory</code>，JDBC的<code>DriverManager.getConnection()</code>和<code>Iterator&lt;E&gt; iteator()</code>方法</p>
<p>工厂方法模式主要有以下角色：</p>
<ol>
<li><strong>Product（产品接口&#x2F;抽象类）</strong><br> 定义产品的抽象（如 <code>Button</code> 接口）。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>ConcreteProduct（具体产品类）</strong><br> 实现 Product 接口（如 <code>WindowsButton</code>, <code>MacButton</code>）。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Render a Windows style button&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Render a Mac style button&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Creator（抽象工厂&#x2F;创建者）</strong><br> 声明工厂方法，返回 Product。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Dialog</span> &#123;</span><br><span class="line">    <span class="comment">// 工厂方法，返回抽象产品</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Button <span class="title function_">createButton</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用工厂方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">renderWindow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Button</span> <span class="variable">okButton</span> <span class="operator">=</span> createButton();</span><br><span class="line">        okButton.render();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>ConcreteCreator（具体工厂类）</strong><br> 实现工厂方法，返回具体的 ConcreteProduct。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsDialog</span> <span class="keyword">extends</span> <span class="title class_">Dialog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacDialog</span> <span class="keyword">extends</span> <span class="title class_">Dialog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>客户端实例化过程</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Dialog dialog;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>).toLowerCase();</span><br><span class="line">        <span class="keyword">if</span> (os.contains(<span class="string">&quot;win&quot;</span>)) &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> <span class="title class_">WindowsDialog</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> <span class="title class_">MacDialog</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dialog.renderWindow(); <span class="comment">// 使用工厂方法创建按钮</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>优点</p>
<ul>
<li>符合 <strong>开闭原则</strong>：新增产品时，只需要新增工厂类，不改原有代码。</li>
<li>客户端只依赖抽象，降低耦合。</li>
<li>容易扩展产品族。</li>
</ul>
<p>缺点</p>
<ul>
<li>每增加一个产品类，就要写一个新的工厂类，类的数量会增加。</li>
<li>结构比简单工厂复杂。</li>
</ul>
<h3 id="3-抽象工厂方法模式"><a href="#3-抽象工厂方法模式" class="headerlink" title="3.抽象工厂方法模式"></a>3.抽象工厂方法模式</h3><p><strong>抽象工厂模式是一种创建型设计模式</strong>，它提供一个接口，可以创建一系列相关或相互依赖的对象，而无需指定它们的具体类。</p>
<p><strong>AbstractProduct（抽象产品）</strong><br> 每个产品的抽象（例如 <code>Button</code>, <code>Checkbox</code>）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按钮接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复选框接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>ConcreteProduct（具体产品）</strong><br> 具体产品实现（如 <code>WindowsButton</code>, <code>MacButton</code>）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Render a button in Windows style.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Render a button in Mac style.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Render a checkbox in Windows style.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Render a checkbox in Mac style.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>AbstractFactory（抽象工厂）</strong><br> 定义创建一组抽象产品的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    Button <span class="title function_">createButton</span><span class="params">()</span>;</span><br><span class="line">    Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ConcreteFactory（具体工厂）</strong><br> 实现抽象工厂的方法，生产具体产品族。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Client（客户端）</strong><br> 通过抽象工厂获取产品，只依赖抽象，不关心具体实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> Checkbox checkbox;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Application</span><span class="params">(GUIFactory factory)</span> &#123;</span><br><span class="line">        button = factory.createButton();</span><br><span class="line">        checkbox = factory.createCheckbox();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        button.paint();</span><br><span class="line">        checkbox.paint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        GUIFactory factory;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">os</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>).toLowerCase();</span><br><span class="line">        <span class="keyword">if</span> (os.contains(<span class="string">&quot;win&quot;</span>)) &#123;</span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">WindowsFactory</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">MacFactory</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Application</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Application</span>(factory);</span><br><span class="line">        app.render();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-建造者模式"><a href="#4-建造者模式" class="headerlink" title="4.建造者模式"></a>4.建造者模式</h3><p>建造者模式是一种将复杂对象的构造过程与表示分离的设计模式，使得同样的构建过程可以创建不同的表示。</p>
<h4 id="内部静态类"><a href="#内部静态类" class="headerlink" title="内部静态类"></a>内部静态类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String foundation;</span><br><span class="line">    <span class="keyword">private</span> String walls;</span><br><span class="line">    <span class="keyword">private</span> String roof;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasGarage;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasGarden;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">House</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.foundation = builder.foundation;</span><br><span class="line">        <span class="built_in">this</span>.walls = builder.walls;</span><br><span class="line">        <span class="built_in">this</span>.roof = builder.roof;</span><br><span class="line">        <span class="built_in">this</span>.hasGarage = builder.hasGarage;</span><br><span class="line">        <span class="built_in">this</span>.hasGarden = builder.hasGarden;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String foundation;</span><br><span class="line">        <span class="keyword">private</span> String walls;</span><br><span class="line">        <span class="keyword">private</span> String roof;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> hasGarage;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> hasGarden;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">foundation</span><span class="params">(String foundation)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.foundation = foundation;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">walls</span><span class="params">(String walls)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.walls = walls;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">roof</span><span class="params">(String roof)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.roof = roof;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">garage</span><span class="params">(<span class="type">boolean</span> hasGarage)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.hasGarage = hasGarage;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">garden</span><span class="params">(<span class="type">boolean</span> hasGarden)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.hasGarden = hasGarden;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> House <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">House</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;House [foundation=&quot;</span> + foundation + <span class="string">&quot;, walls=&quot;</span> + walls + </span><br><span class="line">               <span class="string">&quot;, roof=&quot;</span> + roof + <span class="string">&quot;, garage=&quot;</span> + hasGarage + <span class="string">&quot;, garden=&quot;</span> + hasGarden + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">House</span> <span class="variable">house</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">House</span>.Builder()</span><br><span class="line">    .foundation(<span class="string">&quot;Concrete&quot;</span>)</span><br><span class="line">    .walls(<span class="string">&quot;Brick&quot;</span>)</span><br><span class="line">    .roof(<span class="string">&quot;Tile&quot;</span>)</span><br><span class="line">    .garage(<span class="literal">true</span>)</span><br><span class="line">    .garden(<span class="literal">false</span>)</span><br><span class="line">    .build();</span><br><span class="line">System.out.println(house);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="✅-优点"><a href="#✅-优点" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>将复杂对象的构建和表示分离，代码更清晰。</li>
<li>支持链式调用，易读性强。</li>
<li>可以复用构造步骤，创建不同对象。</li>
<li>符合 <strong>单一职责原则</strong>：Builder 负责构造，Product 负责表示。</li>
</ul>
<h4 id="❌-缺点"><a href="#❌-缺点" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>类数量可能增多（传统写法需要多个 Builder、Director）。</li>
<li>不适合简单对象（会显得过度设计）。</li>
</ul>
<h4 id="Lombok-的-Builder"><a href="#Lombok-的-Builder" class="headerlink" title="Lombok 的 @Builder"></a>Lombok 的 @Builder</h4><p>Lombok 通过在类或构造器&#x2F;方法上加 <code>@Builder</code>，<strong>自动生成内部静态 Builder 类</strong>，省去手写 Builder 的麻烦。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编译后，Lombok 会帮你生成一个 <code>UserBuilder</code> 类，支持链式调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> User.builder()</span><br><span class="line">        .name(<span class="string">&quot;Tom&quot;</span>)</span><br><span class="line">        .age(<span class="number">20</span>)</span><br><span class="line">        .email(<span class="string">&quot;tom@example.com&quot;</span>)</span><br><span class="line">        .password(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">System.out.println(user);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="StringBuilder"><a href="#StringBuilder" class="headerlink" title="StringBuilder"></a>StringBuilder</h4><p>使用<code>append()</code>不断追加内容，最后通过<code>toString()</code>得到结果。<code>StringBuilder</code> 不是严格的 <strong>建造者模式</strong>，但用法上体现了 <strong>Builder 模式的思想</strong>：链式构建、最后生成结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> sb.append(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">                          .append(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">                          .append(<span class="string">&quot;World&quot;</span>)</span><br><span class="line">                          .append(<span class="string">&quot;!&quot;</span>)</span><br><span class="line">                          .toString();</span><br><span class="line"></span><br><span class="line">        System.out.println(result); <span class="comment">// Hello, World!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-原型模式"><a href="#5-原型模式" class="headerlink" title="5.原型模式"></a>5.原型模式</h3><h4 id="1-浅拷贝（Shallow-Copy）"><a href="#1-浅拷贝（Shallow-Copy）" class="headerlink" title="1. 浅拷贝（Shallow Copy）"></a>1. <strong>浅拷贝（Shallow Copy）</strong></h4><ul>
<li>拷贝对象本身，但引用类型属性只拷贝引用，不拷贝对象本身。</li>
<li>即 <strong>共享引用</strong>。</li>
<li>可能会引发 <mark>改一处动全身</mark> 的问题</li>
</ul>
<h4 id="2-深拷贝（Deep-Copy）"><a href="#2-深拷贝（Deep-Copy）" class="headerlink" title="2. 深拷贝（Deep Copy）"></a>2. <strong>深拷贝（Deep Copy）</strong></h4><ul>
<li>不仅拷贝对象本身，还拷贝它引用的所有对象。</li>
<li>新对象完全独立，不会共享引用。</li>
</ul>
<p>实现方法：</p>
<ul>
<li>手写 <code>clone()</code>，在里面递归克隆引用对象。</li>
<li>或者通过序列化&#x2F;反序列化实现。</li>
</ul>
<h4 id="Java中应用"><a href="#Java中应用" class="headerlink" title="Java中应用"></a>Java中应用</h4><ul>
<li><p><code>ArrayList.clone()</code>（浅拷贝）。</p>
<p><code>HashMap.clone()</code>（浅拷贝）。</p>
</li>
<li><p>Java 提供了 <strong><code>Cloneable</code> 接口</strong> + <strong><code>Object.clone()</code> 方法</strong>。</p>
</li>
<li><p>但是：</p>
<ul>
<li><code>Cloneable</code> 是一个<strong>标记接口</strong>，不定义方法。</li>
<li>必须重写 <code>clone()</code> 并调用 <code>super.clone()</code>。</li>
<li>否则会抛出 <code>CloneNotSupportedException</code>。</li>
</ul>
</li>
</ul>
<p>很多框架（如 Spring）更推荐 <strong>拷贝构造函数 &#x2F; 工具类（如 Apache Commons Lang 的 <code>SerializationUtils.clone()</code>）</strong> 来做深拷贝。</p>
<h2 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h2><p>解决 <strong>对象和类如何组合</strong> 的问题。</p>
<h3 id="6-适配器模式"><a href="#6-适配器模式" class="headerlink" title="6.适配器模式"></a>6.适配器模式</h3><p><strong>核心思想</strong>：将不兼容的接口转换为可用接口。<br> <strong>结构</strong>：Adapter 包装 Adaptee。<br> <strong>适用场景</strong>：老代码接口不兼容。<br> <strong>优点</strong>：复用已有类。<br> <strong>缺点</strong>：类层次复杂化。<br> <strong>应用</strong>：<code>InputStreamReader</code>，Spring MVC 参数适配器。</p>
<ol>
<li>类适配器（继承）</li>
</ol>
<ul>
<li><p><code>Adapter</code> 继承 <code>Adaptee</code>，实现 <code>Target</code> 接口。</p>
</li>
<li><p>通过继承获得 <code>Adaptee</code> 的功能。</p>
</li>
</ul>
<ol start="2">
<li>组合适配（持有引用）</li>
</ol>
<ul>
<li><code>Adapter</code> 持有 <code>Adaptee</code> 的引用，转发调用。</li>
<li>更灵活（可以适配多个不同的 <code>Adaptee</code>）。</li>
</ul>
<ol start="3">
<li>接口适配器</li>
</ol>
<ul>
<li>提供一个抽象类，实现接口的所有方法为空实现。</li>
<li>子类可以选择性地重写需要的方法。</li>
<li>常用于回调接口场景（比如 Java AWT&#x2F;Swing 的监听器）。</li>
</ul>
<h4 id="Java中的标准适配器"><a href="#Java中的标准适配器" class="headerlink" title="Java中的标准适配器"></a>Java中的标准适配器</h4><ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList-T...-"><code>java.util.Arrays#asList()</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#list-java.util.Enumeration-"><code>java.util.Collections#list()</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#enumeration-java.util.Collection-"><code>java.util.Collections#enumeration()</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStreamReader.html#InputStreamReader-java.io.InputStream-"><code>java.io.InputStreamReader(InputStream)</code></a> （返回 <code>Reader</code>对象）</li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/io/OutputStreamWriter.html#OutputStreamWriter-java.io.OutputStream-"><code>java.io.OutputStreamWriter(OutputStream)</code></a> （返回 <code>Writer</code>对象）</li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/XmlAdapter.html#marshal-BoundType-"><code>javax.xml.bind.annotation.adapters.XmlAdapter#marshal()</code></a> 和 <code>#unmarshal()</code></li>
</ul>
<p><code>java.util.Collections#list()</code>不完全是适配器模式，要实现适配器模式类似于以下方式，将Enumeration转为Iterator</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EnumerationIterator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Enumeration&lt;T&gt; enumeration;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EnumerationIterator</span><span class="params">(Enumeration&lt;T&gt; enumeration)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.enumeration = enumeration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enumeration.hasMoreElements();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enumeration.nextElement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="java的实现例子"><a href="#java的实现例子" class="headerlink" title="java的实现例子"></a>java的实现例子</h4><p>让方钉适配圆孔</p>
<p>圆孔：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.adapter.example.round;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RoundHoles are compatible with RoundPegs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoundHole</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundHole</span><span class="params">(<span class="type">double</span> radius)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getRadius</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">fits</span><span class="params">(RoundPeg peg)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> result;</span><br><span class="line">        result = (<span class="built_in">this</span>.getRadius() &gt;= peg.getRadius());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>圆钉：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.adapter.example.round;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RoundPegs are compatible with RoundHoles.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoundPeg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundPeg</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundPeg</span><span class="params">(<span class="type">double</span> radius)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getRadius</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方钉：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.adapter.example.square;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SquarePegs are not compatible with RoundHoles (they were implemented by</span></span><br><span class="line"><span class="comment"> * previous development team). But we have to integrate them into our program.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SquarePeg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SquarePeg</span><span class="params">(<span class="type">double</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getSquare</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">double</span> result;</span><br><span class="line">        result = Math.pow(<span class="built_in">this</span>.width, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>适配器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.adapter.example.adapters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.adapter.example.round.RoundPeg;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.adapter.example.square.SquarePeg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adapter allows fitting square pegs into round holes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SquarePegAdapter</span> <span class="keyword">extends</span> <span class="title class_">RoundPeg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> SquarePeg peg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SquarePegAdapter</span><span class="params">(SquarePeg peg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.peg = peg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getRadius</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">double</span> result;</span><br><span class="line">        <span class="comment">// Calculate a minimum circle radius, which can fit this peg.</span></span><br><span class="line">        result = (Math.sqrt(Math.pow((peg.getWidth() / <span class="number">2</span>), <span class="number">2</span>) * <span class="number">2</span>));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.adapter.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.adapter.example.adapters.SquarePegAdapter;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.adapter.example.round.RoundHole;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.adapter.example.round.RoundPeg;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.adapter.example.square.SquarePeg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Somewhere in client code...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Round fits round, no surprise.</span></span><br><span class="line">        <span class="type">RoundHole</span> <span class="variable">hole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoundHole</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="type">RoundPeg</span> <span class="variable">rpeg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoundPeg</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">if</span> (hole.fits(rpeg)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Round peg r5 fits round hole r5.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">SquarePeg</span> <span class="variable">smallSqPeg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePeg</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">SquarePeg</span> <span class="variable">largeSqPeg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePeg</span>(<span class="number">20</span>);</span><br><span class="line">        <span class="comment">// hole.fits(smallSqPeg); // Won&#x27;t compile.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Adapter solves the problem.</span></span><br><span class="line">        <span class="type">SquarePegAdapter</span> <span class="variable">smallSqPegAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePegAdapter</span>(smallSqPeg);</span><br><span class="line">        <span class="type">SquarePegAdapter</span> <span class="variable">largeSqPegAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePegAdapter</span>(largeSqPeg);</span><br><span class="line">        <span class="keyword">if</span> (hole.fits(smallSqPegAdapter)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Square peg w2 fits round hole r5.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!hole.fits(largeSqPegAdapter)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Square peg w20 does not fit into round hole r5.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-1"><a href="#✅-优点-1" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>解耦：客户端和被适配类解耦。</li>
<li>复用：复用已有功能，无需改源码。</li>
<li>灵活：对象适配器方式支持组合多个适配对象。</li>
</ul>
<h4 id="❌-缺点-1"><a href="#❌-缺点-1" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>增加了系统复杂度，多了一层转换。</li>
<li>类适配器方式受限于单继承。</li>
</ul>
<h3 id="7-装饰器模式"><a href="#7-装饰器模式" class="headerlink" title="7.装饰器模式"></a>7.装饰器模式</h3><p><strong>核心思想</strong>：在不修改对象代码的前提下动态添加功能。<br> <strong>结构</strong>：Decorator 包含被装饰对象。<br> <strong>适用场景</strong>：多层功能增强。<br> <strong>优点</strong>：比继承更灵活。<br> <strong>缺点</strong>：多层装饰会难以调试。<br> <strong>应用</strong>：Java I&#x2F;O 流。</p>
<blockquote>
<p>在不改变原有对象结构的前提下，动态地给对象增加新的功能。</p>
</blockquote>
<ul>
<li>它通过“包装”一个对象来增强功能，而不是通过继承。</li>
<li>使用同一个接口，保证客户端无感知。</li>
</ul>
<h4 id="java实现例子"><a href="#java实现例子" class="headerlink" title="java实现例子"></a>java实现例子</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface Component &#123;</span><br><span class="line">    void operation();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ConcreteComponent implements Component &#123;</span><br><span class="line">    public void operation() &#123;</span><br><span class="line">        System.out.println(&quot;执行基本操作&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>抽象装饰器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">abstract class Decorator implements Component &#123;</span><br><span class="line">    protected Component component;</span><br><span class="line"></span><br><span class="line">    public Decorator(Component component) &#123;</span><br><span class="line">        this.component = component;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void operation() &#123;</span><br><span class="line">        component.operation(); // 默认转发</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体装饰器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class LoggingDecorator extends Decorator &#123;</span><br><span class="line">    public LoggingDecorator(Component component) &#123;</span><br><span class="line">        super(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void operation() &#123;</span><br><span class="line">        System.out.println(&quot;记录日志...&quot;);</span><br><span class="line">        super.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecurityDecorator extends Decorator &#123;</span><br><span class="line">    public SecurityDecorator(Component component) &#123;</span><br><span class="line">        super(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void operation() &#123;</span><br><span class="line">        System.out.println(&quot;检查权限...&quot;);</span><br><span class="line">        super.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>客户端使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Component</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteComponent</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 增强功能：先权限检查，再日志记录，再执行基本操作</span></span><br><span class="line">        <span class="type">Component</span> <span class="variable">decorated</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoggingDecorator</span>(<span class="keyword">new</span> <span class="title class_">SecurityDecorator</span>(c));</span><br><span class="line">        decorated.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="现实例子"><a href="#现实例子" class="headerlink" title="现实例子"></a>现实例子</h4><p><strong>Java IO</strong></p>
<ul>
<li><p><code>InputStream</code> 是抽象构件。</p>
</li>
<li><p><code>FileInputStream</code> 是具体构件。</p>
</li>
<li><p><code>BufferedInputStream</code>、<code>DataInputStream</code>、<code>ZipInputStream</code> 是装饰器。</p>
</li>
<li><p>它们可以层层嵌套：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InputStream in = new BufferedInputStream(</span><br><span class="line">                     new DataInputStream(</span><br><span class="line">                         new FileInputStream(&quot;test.txt&quot;)));</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>Spring</strong></p>
<ul>
<li>Spring AOP 的 <code>BeanPostProcessor</code> 本质上也是装饰思想：在 Bean 初始化前后加功能。</li>
</ul>
<p><strong>GUI 框架</strong></p>
<ul>
<li>滚动条装饰器 <code>ScrollBarDecorator</code> 可以给窗口动态加滚动条。</li>
</ul>
<h4 id="✅-优点-2"><a href="#✅-优点-2" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li><strong>扩展性强</strong>：不修改原有类就能添加功能。</li>
<li><strong>灵活组合</strong>：不同装饰器可以任意组合。</li>
<li><strong>遵循开闭原则</strong>：对扩展开放，对修改关闭。</li>
</ul>
<h4 id="❌-缺点-2"><a href="#❌-缺点-2" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>对象层层包装，调试时可能比较复杂。</li>
<li>装饰链过长时，可能影响性能和可读性。</li>
</ul>
<h3 id="8-代理模式"><a href="#8-代理模式" class="headerlink" title="8.代理模式"></a>8.代理模式</h3><p><strong>核心思想</strong>：通过代理对象控制对真实对象的访问。<br> <strong>结构</strong>：Proxy 持有 RealSubject。<br> <strong>适用场景</strong>：远程代理、安全代理、延迟加载。<br> <strong>优点</strong>：控制访问、增强功能。<br> <strong>缺点</strong>：增加层级，可能影响性能。<br> <strong>应用</strong>：Spring AOP、JDK 动态代理。</p>
<p>定义接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Subject &#123;</span><br><span class="line">    void request();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>真实主题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class RealSubject implements Subject &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void request() &#123;</span><br><span class="line">        System.out.println(&quot;执行真实请求&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>代理主题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class Proxy implements Subject &#123;</span><br><span class="line">    private RealSubject realSubject;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void request() &#123;</span><br><span class="line">        // 可以做权限控制</span><br><span class="line">        System.out.println(&quot;检查权限...&quot;);</span><br><span class="line"></span><br><span class="line">        // 延迟初始化（懒加载）</span><br><span class="line">        if (realSubject == null) &#123;</span><br><span class="line">            realSubject = new RealSubject();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 调用真实对象</span><br><span class="line">        realSubject.request();</span><br><span class="line"></span><br><span class="line">        // 可以做日志</span><br><span class="line">        System.out.println(&quot;记录日志...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Subject proxy = new Proxy();</span><br><span class="line">        proxy.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="代理模式类型"><a href="#代理模式类型" class="headerlink" title="代理模式类型"></a>代理模式类型</h4><ol>
<li>静态代理</li>
</ol>
<p>编译期就写死了代理类。</p>
<p>缺点：如果接口很多，需要写很多代理类。</p>
<ol start="2">
<li>动态代理</li>
</ol>
<ul>
<li><strong>JDK 动态代理</strong>：基于 <code>InvocationHandler</code> + 反射，要求被代理对象必须实现接口。</li>
<li><strong>CGLIB 动态代理</strong>：基于字节码生成，可以代理没有实现接口的类。</li>
</ul>
<p> Spring AOP 就是基于 <strong>动态代理</strong> 实现的。</p>
<h4 id="✅-优点-3"><a href="#✅-优点-3" class="headerlink" title="✅ 优点"></a>✅ <strong>优点</strong></h4><ul>
<li>控制访问：隔离客户端与真实对象。</li>
<li>可扩展：代理可在不修改真实对象的前提下增强功能。</li>
<li>提高灵活性：支持远程调用、懒加载等模式。</li>
</ul>
<h4 id="❌-缺点-3"><a href="#❌-缺点-3" class="headerlink" title="❌ 缺点"></a>❌ <strong>缺点</strong></h4><ul>
<li>可能增加系统复杂度。</li>
<li>动态代理可能影响性能（尤其是反射和字节码生成）。</li>
</ul>
<h3 id="9-外观模式"><a href="#9-外观模式" class="headerlink" title="9.外观模式"></a>9.外观模式</h3><p>子系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// 电视</span><br><span class="line">class TV &#123;</span><br><span class="line">    public void on() &#123;</span><br><span class="line">        System.out.println(&quot;TV is on&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void off() &#123;</span><br><span class="line">        System.out.println(&quot;TV is off&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 音响</span><br><span class="line">class SoundSystem &#123;</span><br><span class="line">    public void on() &#123;</span><br><span class="line">        System.out.println(&quot;Sound system is on&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void off() &#123;</span><br><span class="line">        System.out.println(&quot;Sound system is off&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void setVolume(int volume) &#123;</span><br><span class="line">        System.out.println(&quot;Setting volume to &quot; + volume);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// DVD 播放器</span><br><span class="line">class DVDPlayer &#123;</span><br><span class="line">    public void on() &#123;</span><br><span class="line">        System.out.println(&quot;DVD player is on&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void off() &#123;</span><br><span class="line">        System.out.println(&quot;DVD player is off&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void playMovie(String movie) &#123;</span><br><span class="line">        System.out.println(&quot;Playing movie: &quot; + movie);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>外观</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 外观类</span><br><span class="line">public class HomeTheaterFacade &#123;</span><br><span class="line">    private TV tv;</span><br><span class="line">    private SoundSystem soundSystem;</span><br><span class="line">    private DVDPlayer dvdPlayer;</span><br><span class="line"></span><br><span class="line">    public HomeTheaterFacade() &#123;</span><br><span class="line">        this.tv = new TV();</span><br><span class="line">        this.soundSystem = new SoundSystem();</span><br><span class="line">        this.dvdPlayer = new DVDPlayer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 电影模式：一个简单的方法，背后执行一系列复杂操作</span><br><span class="line">    public void watchMovie(String movie) &#123;</span><br><span class="line">        System.out.println(&quot;准备进入电影模式...&quot;);</span><br><span class="line">        tv.on();</span><br><span class="line">        soundSystem.on();</span><br><span class="line">        soundSystem.setVolume(15);</span><br><span class="line">        dvdPlayer.on();</span><br><span class="line">        dvdPlayer.playMovie(movie);</span><br><span class="line">        System.out.println(&quot;电影模式准备就绪！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 结束模式：另一个简单的方法</span><br><span class="line">    public void endMovie() &#123;</span><br><span class="line">        System.out.println(&quot;准备退出电影模式...&quot;);</span><br><span class="line">        dvdPlayer.off();</span><br><span class="line">        soundSystem.off();</span><br><span class="line">        tv.off();</span><br><span class="line">        System.out.println(&quot;所有设备已关闭。&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 客户端</span><br><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 创建外观对象，客户端无需关心子系统的复杂性</span><br><span class="line">        HomeTheaterFacade homeTheater = new HomeTheaterFacade();</span><br><span class="line"></span><br><span class="line">        // 客户端只需调用一个简单的方法</span><br><span class="line">        homeTheater.watchMovie(&quot;The Matrix&quot;);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;\n----------------\n&quot;);</span><br><span class="line"></span><br><span class="line">        homeTheater.endMovie();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Spring 框架</strong></p>
<ul>
<li><code>JdbcTemplate</code>、<code>RedisTemplate</code>、<code>RestTemplate</code> 就是外观模式的应用：<br> 它们对复杂的数据库操作、Redis 操作、HTTP 调用进行了封装，客户端只需调用简单方法。</li>
</ul>
<p><strong>日志框架（SLF4J）</strong></p>
<ul>
<li><code>LoggerFactory.getLogger()</code> 就是外观，底层可能是 Logback、Log4j，但客户端只依赖统一接口。</li>
</ul>
<p><strong>电脑开机</strong></p>
<ul>
<li>按下电源键（Facade） → 调用 CPU、内存、硬盘等子系统。</li>
</ul>
<p><strong>API Gateway（微服务网关）</strong></p>
<ul>
<li>外部系统只调用网关，网关再去调度多个微服务。</li>
</ul>
<h4 id="✅-优点-4"><a href="#✅-优点-4" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li><strong>简化调用</strong>：屏蔽复杂性，让客户端更容易使用系统。</li>
<li><strong>降低耦合</strong>：客户端与子系统解耦，只依赖 Facade。</li>
<li><strong>更安全</strong>：外观类可以控制客户端访问的子系统范围。</li>
</ul>
<h4 id="❌-缺点-4"><a href="#❌-缺点-4" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>可能成为“上帝类”，职责过多。</li>
<li>增加了一层间接调用，灵活性降低（客户端无法访问到子系统的所有功能）。</li>
</ul>
<h3 id="10-桥接模式"><a href="#10-桥接模式" class="headerlink" title="10.桥接模式"></a>10.桥接模式</h3><p><strong>核心思想</strong>：将抽象与实现分离，使它们可以独立变化，解决组合爆炸问题。<br> <strong>结构</strong>：Abstraction 持有 Implementor。<br> <strong>适用场景</strong>：多维度扩展（颜色+形状）。<br> <strong>优点</strong>：避免类爆炸。<br> <strong>缺点</strong>：增加抽象层。<br> <strong>应用</strong>：JDBC 接口 + 驱动实现。</p>
<p>具体实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 实现者接口：定义消息发送方式</span><br><span class="line">interface MessageSender &#123;</span><br><span class="line">    void sendMessage(String message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 具体实现者：邮件发送</span><br><span class="line">class EmailMessageSender implements MessageSender &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void sendMessage(String message) &#123;</span><br><span class="line">        System.out.println(&quot;通过邮件发送消息: &quot; + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 具体实现者：短信发送</span><br><span class="line">class SMSMessageSender implements MessageSender &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void sendMessage(String message) &#123;</span><br><span class="line">        System.out.println(&quot;通过短信发送消息: &quot; + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抽象层</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// 抽象类：定义消息类型</span><br><span class="line">abstract class Message &#123;</span><br><span class="line">    protected MessageSender sender;</span><br><span class="line"></span><br><span class="line">    public Message(MessageSender sender) &#123;</span><br><span class="line">        this.sender = sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 抽象方法，留给子类实现</span><br><span class="line">    public abstract void send(String text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 细化抽象：普通消息</span><br><span class="line">class NormalMessage extends Message &#123;</span><br><span class="line">    public NormalMessage(MessageSender sender) &#123;</span><br><span class="line">        super(sender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void send(String text) &#123;</span><br><span class="line">        // 普通消息直接发送</span><br><span class="line">        sender.sendMessage(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 细化抽象：加急消息</span><br><span class="line">class UrgentMessage extends Message &#123;</span><br><span class="line">    public UrgentMessage(MessageSender sender) &#123;</span><br><span class="line">        super(sender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void send(String text) &#123;</span><br><span class="line">        // 加急消息可以添加额外的处理逻辑</span><br><span class="line">        text = &quot;加急：&quot; + text;</span><br><span class="line">        sender.sendMessage(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 桥接：普通消息 + 邮件发送</span><br><span class="line">        Message normalMessage = new NormalMessage(new EmailMessageSender());</span><br><span class="line">        normalMessage.send(&quot;这是一条普通消息。&quot;);</span><br><span class="line"></span><br><span class="line">        // 桥接：加急消息 + 短信发送</span><br><span class="line">        Message urgentMessage = new UrgentMessage(new SMSMessageSender());</span><br><span class="line">        urgentMessage.send(&quot;这是一条加急消息。&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-5"><a href="#✅-优点-5" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>避免类爆炸，降低继承层次。</li>
<li>抽象与实现可以独立扩展，互不影响。</li>
<li>符合开闭原则。</li>
</ul>
<h4 id="❌-缺点-5"><a href="#❌-缺点-5" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>增加了系统复杂性（要多设计一层 Implementor）。</li>
<li>适合变化维度明显的场景，不适合单一维度系统。</li>
</ul>
<h3 id="11-组合模式"><a href="#11-组合模式" class="headerlink" title="11.组合模式"></a>11.组合模式</h3><p><strong>核心思想</strong>：将对象组合成树形结构，使用户对单个对象和组合对象使用一致接口。<br> <strong>结构</strong>：Component → Leaf &#x2F; Composite。<br> <strong>适用场景</strong>：层次结构（文件夹&#x2F;文件）。<br> <strong>优点</strong>：一致性操作。<br> <strong>缺点</strong>：难以限制组合层次。<br> <strong>应用</strong>：Swing 组件树、XML DOM。</p>
<p>抽象组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">FileSystemNode</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>叶子节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileNode</span> <span class="keyword">implements</span> <span class="title class_">FileSystemNode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileNode</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;文件: &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>容器节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DirectoryNode</span> <span class="keyword">implements</span> <span class="title class_">FileSystemNode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;FileSystemNode&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DirectoryNode</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(FileSystemNode node)</span> &#123;</span><br><span class="line">        children.add(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;目录: &quot;</span> + name);</span><br><span class="line">        <span class="keyword">for</span> (FileSystemNode child : children) &#123;</span><br><span class="line">            child.show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">FileSystemNode</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileNode</span>(<span class="string">&quot;a.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileSystemNode</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileNode</span>(<span class="string">&quot;b.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DirectoryNode</span> <span class="variable">folder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DirectoryNode</span>(<span class="string">&quot;docs&quot;</span>);</span><br><span class="line">        folder.add(file1);</span><br><span class="line">        folder.add(file2);</span><br><span class="line"></span><br><span class="line">        <span class="type">DirectoryNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DirectoryNode</span>(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        root.add(folder);</span><br><span class="line">        root.add(<span class="keyword">new</span> <span class="title class_">FileNode</span>(<span class="string">&quot;c.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">        root.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>文件系统</strong></p>
<ul>
<li>文件和文件夹统一看作“节点”。</li>
</ul>
<p><strong>组织架构</strong></p>
<ul>
<li>员工（Leaf）和部门（Composite）都实现 <code>OrganizationUnit</code> 接口。</li>
</ul>
<p><strong>菜单系统（GUI）</strong></p>
<ul>
<li>菜单项（Leaf）和子菜单（Composite）统一处理。</li>
</ul>
<p><strong>图形绘制系统</strong></p>
<ul>
<li>线段、圆形（Leaf），组合图形（Composite）。</li>
</ul>
<h4 id="✅-优点-6"><a href="#✅-优点-6" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li><strong>统一性</strong>：客户端可以统一处理单个对象和组合对象。</li>
<li><strong>扩展性强</strong>：新增叶子节点或组合节点时，不影响已有代码。</li>
<li><strong>层次结构清晰</strong>：天然适合树形数据表示。</li>
</ul>
<h4 id="❌-缺点-6"><a href="#❌-缺点-6" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>系统会产生过多的细粒度对象（节点多时内存占用高）。</li>
<li>控制粒度可能变弱（比如有些方法只适用于叶子，但接口统一后容易被误用）。</li>
</ul>
<h3 id="12-享元模式"><a href="#12-享元模式" class="headerlink" title="12.享元模式"></a>12.享元模式</h3><p><strong>核心思想</strong>：共享对象，减少内存消耗。<br> <strong>结构</strong>：FlyweightFactory 管理共享对象。<br> <strong>适用场景</strong>：大量细粒度对象（字符、棋子）。<br> <strong>优点</strong>：节省内存。<br> <strong>缺点</strong>：逻辑复杂化。<br> <strong>应用</strong>：<code>Integer.valueOf()</code> 缓存，JVM 字符串常量池。</p>
<p>抽象享元</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Flyweight</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(String extrinsicState)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体享元</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFlyweight</span> <span class="keyword">implements</span> <span class="title class_">Flyweight</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String intrinsicState; <span class="comment">// 内部状态（共享）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteFlyweight</span><span class="params">(String intrinsicState)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.intrinsicState = intrinsicState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(String extrinsicState)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;内部状态: &quot;</span> + intrinsicState + <span class="string">&quot;，外部状态: &quot;</span> + extrinsicState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>享元工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyweightFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Flyweight&gt; pool = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Flyweight <span class="title function_">getFlyweight</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!pool.containsKey(key)) &#123;</span><br><span class="line">            pool.put(key, <span class="keyword">new</span> <span class="title class_">ConcreteFlyweight</span>(key));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pool.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">poolSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pool.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">FlyweightFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FlyweightFactory</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Flyweight</span> <span class="variable">f1</span> <span class="operator">=</span> factory.getFlyweight(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Flyweight</span> <span class="variable">f2</span> <span class="operator">=</span> factory.getFlyweight(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">Flyweight</span> <span class="variable">f3</span> <span class="operator">=</span> factory.getFlyweight(<span class="string">&quot;B&quot;</span>);</span><br><span class="line"></span><br><span class="line">        f1.operation(<span class="string">&quot;位置1&quot;</span>);</span><br><span class="line">        f2.operation(<span class="string">&quot;位置2&quot;</span>);</span><br><span class="line">        f3.operation(<span class="string">&quot;位置3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;享元池大小: &quot;</span> + factory.poolSize());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><strong>Java String 常量池</strong></p>
<ul>
<li><code>&quot;abc&quot;</code> 字符串字面量会被放入常量池，复用相同字符串对象。</li>
</ul>
<p><strong>Java Integer 缓存</strong></p>
<ul>
<li><code>Integer.valueOf(127)</code> 总是返回缓存对象，避免频繁创建。</li>
</ul>
<p><strong>数据库连接池、线程池</strong></p>
<ul>
<li>资源复用，避免频繁创建销毁。</li>
</ul>
<p><strong>字体渲染、图标缓存</strong></p>
<ul>
<li>文本编辑器中重复出现的字符、图标只创建一个对象，位置作为外部状态。</li>
</ul>
<p><strong>游戏对象</strong></p>
<ul>
<li>子弹、树木、草地等大量相同对象可以复用。</li>
</ul>
<h4 id="✅-优点-7"><a href="#✅-优点-7" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>大大减少内存中对象的数量，提升性能。</li>
<li>共享对象更容易集中管理，节省系统资源。</li>
</ul>
<h4 id="❌-缺点-7"><a href="#❌-缺点-7" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>引入了区分内部状态和外部状态的复杂性。</li>
<li>外部状态需要由客户端维护，增加了使用成本。</li>
<li>过度使用可能导致系统结构不清晰。</li>
</ul>
<h2 id="行为型模式"><a href="#行为型模式" class="headerlink" title="行为型模式"></a>行为型模式</h2><h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><p><strong>核心思想</strong>：对象状态改变时通知所有依赖者。<br> <strong>结构</strong>：Subject + Observer。<br> <strong>适用场景</strong>：事件订阅。<br> <strong>优点</strong>：解耦发布与订阅。<br> <strong>缺点</strong>：链式通知可能影响性能。<br> <strong>应用</strong>：Java <code>Observer</code>，GUI 事件监听。</p>
<p>基础发布者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.publisher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.listeners.EventListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventManager</span> &#123;</span><br><span class="line">    Map&lt;String, List&lt;EventListener&gt;&gt; listeners = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EventManager</span><span class="params">(String... operations)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String operation : operations) &#123;</span><br><span class="line">            <span class="built_in">this</span>.listeners.put(operation, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(String eventType, EventListener listener)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.add(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unsubscribe</span><span class="params">(String eventType, EventListener listener)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.remove(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String eventType, File file)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        <span class="keyword">for</span> (EventListener listener : users) &#123;</span><br><span class="line">            listener.update(eventType, file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体发布者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.publisher.EventManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Editor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> EventManager events;</span><br><span class="line">    <span class="keyword">private</span> File file;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Editor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.events = <span class="keyword">new</span> <span class="title class_">EventManager</span>(<span class="string">&quot;open&quot;</span>, <span class="string">&quot;save&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">openFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.file = <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line">        events.notify(<span class="string">&quot;open&quot;</span>, file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.file != <span class="literal">null</span>) &#123;</span><br><span class="line">            events.notify(<span class="string">&quot;save&quot;</span>, file);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;Please open a file first.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-8"><a href="#✅-优点-8" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li><strong>解耦</strong>：主题和观察者之间是抽象依赖，不直接耦合。</li>
<li><strong>灵活扩展</strong>：增加新的观察者无需修改主题代码。</li>
<li><strong>支持广播通信</strong>：一个事件可以通知多个对象。</li>
</ul>
<h4 id="❌-缺点-8"><a href="#❌-缺点-8" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li><strong>性能问题</strong>：观察者数量多时，通知会很耗时。</li>
<li><strong>通知链复杂</strong>：若观察者之间有依赖，可能引发级联更新，难以调试。</li>
<li><strong>内存泄漏风险</strong>：如果观察者忘记移除引用，可能导致对象无法被回收。</li>
</ul>
<h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p><strong>核心思想</strong>：封装一系列算法，使它们可以互换。<br> <strong>结构</strong>：Context + Strategy。<br> <strong>适用场景</strong>：不同算法可替换。<br> <strong>优点</strong>：避免大量 <code>if-else</code>。<br> <strong>缺点</strong>：客户端必须知道所有策略。<br> <strong>应用</strong>：支付方式选择。</p>
<blockquote>
<p>定义一系列算法（策略），将每个算法封装起来，并使它们可以相互替换，让算法的变化独立于使用它的客户端。</p>
</blockquote>
<p>📌 简单说：</p>
<ul>
<li><strong>把 if-else&#x2F;switch 拆出来</strong>，封装成可替换的策略类。</li>
<li>客户端只依赖抽象策略，具体实现由外部注入。</li>
</ul>
<p>环境类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PayContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PayStrategy strategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PayContext</span><span class="params">(PayStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStrategy</span><span class="params">(PayStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        strategy.pay(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>策略接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">PayStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>具体策略类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AliPay</span> <span class="keyword">implements</span> <span class="title class_">PayStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用支付宝支付：&quot;</span> + amount + <span class="string">&quot; 元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeChatPay</span> <span class="keyword">implements</span> <span class="title class_">PayStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用微信支付：&quot;</span> + amount + <span class="string">&quot; 元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardPay</span> <span class="keyword">implements</span> <span class="title class_">PayStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用信用卡支付：&quot;</span> + amount + <span class="string">&quot; 元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PayContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PayContext</span>(<span class="keyword">new</span> <span class="title class_">AliPay</span>());</span><br><span class="line">        context.execute(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        context.setStrategy(<span class="keyword">new</span> <span class="title class_">WeChatPay</span>());</span><br><span class="line">        context.execute(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        context.setStrategy(<span class="keyword">new</span> <span class="title class_">CreditCardPay</span>());</span><br><span class="line">        context.execute(<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Java 8 开始支持 lambda 方法， 它可作为一种替代策略模式的简单方式。</p>
<p>这里有一些核心 Java 程序库中策略模式的示例：</p>
<ul>
<li>对 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html#compare-T-T-"><code>java.util.Comparator#compare()</code></a> 的调用来自 <code>Collections#sort()</code>.</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html"><code>javax.servlet.http.HttpServlet</code></a>：  <code>service­()</code>方法， 还有所有接受 <code>Http­Servlet­Request</code>和 <code>Http­Servlet­Response</code>对象作为参数的 <code>do­XXX()</code>方法。</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/servlet/Filter.html#doFilter-javax.servlet.ServletRequest-javax.servlet.ServletResponse-javax.servlet.FilterChain-"><code>javax.servlet.Filter#doFilter()</code></a></li>
</ul>
<h4 id="✅-优点-9"><a href="#✅-优点-9" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>遵循 <strong>开闭原则</strong>：新增策略不需要改 Context。</li>
<li>避免大量 if-else。</li>
<li>算法可自由切换，灵活性高。</li>
<li>策略类可以复用。</li>
</ul>
<h4 id="❌-缺点-9"><a href="#❌-缺点-9" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>会增加类的数量，每个策略都是一个类。</li>
<li>客户端必须了解不同策略的区别，才能正确选择。</li>
<li>如果策略过多，维护成本可能变高。</li>
</ul>
<h3 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h3><p><strong>核心思想</strong>：多个对象依次处理请求，直到被处理。<br> <strong>结构</strong>：Handler 链。<br> <strong>适用场景</strong>：请求过滤、拦截器。<br> <strong>优点</strong>：解耦请求与处理者。<br> <strong>缺点</strong>：调试困难，可能无人处理请求。<br> <strong>应用</strong>：Servlet 过滤器链，日志框架。</p>
<ol>
<li><strong>Handler（抽象处理者）</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Approver next;  <span class="comment">// 下一个处理者</span></span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Approver</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Approver next)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(<span class="type">int</span> days)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ol start="2">
<li><p><strong>ConcreteHandler（具体处理者）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TeamLeader</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TeamLeader</span><span class="params">(String name)</span> &#123; <span class="built_in">super</span>(name); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(<span class="type">int</span> days)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (days &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(name + <span class="string">&quot; 批准了 &quot;</span> + days + <span class="string">&quot; 天假&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (next != <span class="literal">null</span>) &#123;</span><br><span class="line">            next.approve(days);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Manager</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Manager</span><span class="params">(String name)</span> &#123; <span class="built_in">super</span>(name); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(<span class="type">int</span> days)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (days &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">            System.out.println(name + <span class="string">&quot; 批准了 &quot;</span> + days + <span class="string">&quot; 天假&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (next != <span class="literal">null</span>) &#123;</span><br><span class="line">            next.approve(days);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Director</span><span class="params">(String name)</span> &#123; <span class="built_in">super</span>(name); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(<span class="type">int</span> days)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (days &lt;= <span class="number">7</span>) &#123;</span><br><span class="line">            System.out.println(name + <span class="string">&quot; 批准了 &quot;</span> + days + <span class="string">&quot; 天假&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (next != <span class="literal">null</span>) &#123;</span><br><span class="line">            next.approve(days);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CEO</span> <span class="keyword">extends</span> <span class="title class_">Approver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CEO</span><span class="params">(String name)</span> &#123; <span class="built_in">super</span>(name); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">approve</span><span class="params">(<span class="type">int</span> days)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 批准了 &quot;</span> + days + <span class="string">&quot; 天假&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>Client（客户端）</strong></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 构建责任链</span></span><br><span class="line">        <span class="type">Approver</span> <span class="variable">leader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TeamLeader</span>(<span class="string">&quot;组长&quot;</span>);</span><br><span class="line">        <span class="type">Approver</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Manager</span>(<span class="string">&quot;经理&quot;</span>);</span><br><span class="line">        <span class="type">Approver</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>(<span class="string">&quot;总监&quot;</span>);</span><br><span class="line">        <span class="type">Approver</span> <span class="variable">ceo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CEO</span>(<span class="string">&quot;CEO&quot;</span>);</span><br><span class="line"></span><br><span class="line">        leader.setNext(manager);</span><br><span class="line">        manager.setNext(director);</span><br><span class="line">        director.setNext(ceo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发起请求</span></span><br><span class="line">        leader.approve(<span class="number">1</span>);</span><br><span class="line">        leader.approve(<span class="number">3</span>);</span><br><span class="line">        leader.approve(<span class="number">5</span>);</span><br><span class="line">        leader.approve(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Java Servlet Filter（过滤器链）</strong></p>
<ul>
<li>请求经过一系列 Filter（编码过滤器、权限过滤器、日志过滤器）。</li>
<li>每个 Filter 要么处理，要么传递。</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/servlet/Filter.html#doFilter-javax.servlet.ServletRequest-javax.servlet.ServletResponse-javax.servlet.FilterChain-"><code>javax.servlet.Filter#doFilter()</code></a></li>
</ul>
<p><strong>Spring AOP 拦截器链</strong></p>
<ul>
<li>多个切面（事务、日志、安全）依次执行。</li>
</ul>
<p><strong>日志处理</strong></p>
<ul>
<li>DEBUG → INFO → WARN → ERROR 多级日志记录器。</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/logging/Logger.html#log-java.util.logging.Level-java.lang.String-"><code>java.util.logging.Logger#log()</code></a></li>
</ul>
<p><strong>审批流程、工作流引擎</strong></p>
<ul>
<li>常见于 OA 系统、请假审批、费用报销。</li>
</ul>
<h4 id="✅-优点-10"><a href="#✅-优点-10" class="headerlink" title="✅  优点"></a>✅  优点</h4><ul>
<li>遵循 <strong>开闭原则</strong>：新增处理者只需要加类，不影响现有逻辑。</li>
<li>请求和处理逻辑解耦，灵活性高。</li>
<li>可以动态组合处理链。</li>
</ul>
<h4 id="❌-缺点-10"><a href="#❌-缺点-10" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>如果链太长，请求可能会经过很多节点才被处理，效率低。</li>
<li>不保证一定会被处理（可能没人接收）。</li>
<li>调试和追踪较麻烦。</li>
</ul>
<h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p><strong>核心思想</strong>：对象行为随内部状态改变而改变。<br> <strong>结构</strong>：Context + State。<br> <strong>适用场景</strong>：状态机。<br> <strong>优点</strong>：消除 <code>if-else</code>。<br> <strong>缺点</strong>：类数量增加。<br> <strong>应用</strong>：TCP 连接状态。</p>
<p><strong>Context（环境类）</strong></p>
<ul>
<li>持有状态对象。</li>
<li>对外提供接口，但内部调用委托给当前状态对象。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class OrderContext &#123;</span><br><span class="line">    private OrderState state;</span><br><span class="line"></span><br><span class="line">    public OrderContext() &#123;</span><br><span class="line">        this.state = new PendingPayment(); // 初始状态</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setState(OrderState state) &#123;</span><br><span class="line">        this.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void request() &#123;</span><br><span class="line">        state.handle(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>State（抽象状态）</strong></p>
<ul>
<li>定义不同状态下的公共行为接口。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface OrderState &#123;</span><br><span class="line">    void handle(OrderContext context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>ConcreteState（具体状态）</strong></p>
<ul>
<li>实现具体状态下的逻辑。</li>
<li>可以决定是否切换到其他状态。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PendingPayment</span> <span class="keyword">implements</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(OrderContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;订单待支付，执行支付操作...&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">Paid</span>());  <span class="comment">// 切换到已支付状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Paid</span> <span class="keyword">implements</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(OrderContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;订单已支付，执行发货操作...&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">Shipped</span>());  <span class="comment">// 切换到已发货状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shipped</span> <span class="keyword">implements</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(OrderContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;订单已发货，执行确认收货操作...&quot;</span>);</span><br><span class="line">        context.setState(<span class="keyword">new</span> <span class="title class_">Completed</span>());  <span class="comment">// 切换到已完成状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Completed</span> <span class="keyword">implements</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(OrderContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;订单已完成，不可操作。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-11"><a href="#✅-优点-11" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>遵循 <strong>开闭原则</strong>：新增状态不影响已有逻辑。</li>
<li>状态切换逻辑清晰，避免大量 if-else。</li>
<li>把与状态相关的行为封装在独立类里，职责清晰。</li>
</ul>
<h4 id="❌-缺点-11"><a href="#❌-缺点-11" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>状态类数量可能过多，增加系统复杂度。</li>
<li>状态切换的逻辑分散在各个状态类里，维护时可能比较麻烦。</li>
</ul>
<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p><strong>核心思想</strong>：将请求封装为对象，支持撤销&#x2F;排队操作。<br> <strong>结构</strong>：Invoker + Command + Receiver。<br> <strong>适用场景</strong>：事务、日志操作。<br> <strong>优点</strong>：解耦请求与执行。<br> <strong>缺点</strong>：类数量增加。<br> <strong>应用</strong>：GUI 按钮命令，数据库事务日志。</p>
<p>抽象命令接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface Command &#123;</span><br><span class="line">    void execute();</span><br><span class="line">    void undo();  // 支持撤销</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">class LightOnCommand implements Command &#123;</span><br><span class="line">    private Light light;</span><br><span class="line"></span><br><span class="line">    public LightOnCommand(Light light) &#123;</span><br><span class="line">        this.light = light;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        light.turnOn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void undo() &#123;</span><br><span class="line">        light.turnOff();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class LightOffCommand implements Command &#123;</span><br><span class="line">    private Light light;</span><br><span class="line"></span><br><span class="line">    public LightOffCommand(Light light) &#123;</span><br><span class="line">        this.light = light;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        light.turnOff();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void undo() &#123;</span><br><span class="line">        light.turnOn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接收者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Light</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOn</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电灯已打开&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOff</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;电灯已关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>调用者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCommand</span><span class="params">(Command command)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressButton</span><span class="params">()</span> &#123;</span><br><span class="line">        command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressUndo</span><span class="params">()</span> &#123;</span><br><span class="line">        command.undo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Light</span> <span class="variable">light</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Light</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Command</span> <span class="variable">lightOn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LightOnCommand</span>(light);</span><br><span class="line">        <span class="type">Command</span> <span class="variable">lightOff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LightOffCommand</span>(light);</span><br><span class="line"></span><br><span class="line">        <span class="type">RemoteControl</span> <span class="variable">remote</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteControl</span>();</span><br><span class="line"></span><br><span class="line">        remote.setCommand(lightOn);</span><br><span class="line">        remote.pressButton();  <span class="comment">// 打开灯</span></span><br><span class="line">        remote.pressUndo();    <span class="comment">// 撤销 → 关灯</span></span><br><span class="line"></span><br><span class="line">        remote.setCommand(lightOff);</span><br><span class="line">        remote.pressButton();  <span class="comment">// 关灯</span></span><br><span class="line">        remote.pressUndo();    <span class="comment">// 撤销 → 开灯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-12"><a href="#✅-优点-12" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li><strong>解耦</strong>：调用者与接收者解耦，扩展性高。</li>
<li><strong>开闭原则</strong>：新增命令只需增加类，不影响已有代码。</li>
<li><strong>可撤销&#x2F;重做</strong>：命令对象可记录历史，支持回滚。</li>
<li><strong>组合命令</strong>：可实现宏命令（多个命令一起执行）。</li>
</ul>
<h4 id="❌-缺点-12"><a href="#❌-缺点-12" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>会增加类的数量（每个命令一个类）。</li>
<li>如果命令过多，代码结构可能比较复杂。</li>
</ul>
<h3 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h3><p><strong>核心思想</strong>：顺序访问集合元素而不暴露内部结构。<br> <strong>结构</strong>：Iterator 接口 + Aggregate。<br> <strong>适用场景</strong>：集合遍历。<br> <strong>优点</strong>：统一遍历方式。<br> <strong>缺点</strong>：额外开销。<br> <strong>应用</strong>：Java 的 <code>Iterator</code> 接口。</p>
<blockquote>
<p>提供一种方法，顺序访问聚合对象中的各个元素，而不暴露其内部表示。</p>
</blockquote>
<p>📌 通俗说：</p>
<ul>
<li>不管集合是数组、链表还是树，<strong>用户只需要用迭代器按顺序取元素，不必关心内部数据结构</strong>。</li>
<li>集合类负责存储数据，迭代器负责遍历数据。</li>
</ul>
<p>Java接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Iterator&lt;String&gt; it = list.iterator();</span><br><span class="line"><span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">    System.out.println(it.next());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-13"><a href="#✅-优点-13" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>遵循 <strong>单一职责原则</strong>：集合负责存储，迭代器负责遍历。</li>
<li>封装性好：不用暴露集合的内部结构。</li>
<li>可扩展性强：支持多种遍历方式（正向、反向、跳跃）。</li>
</ul>
<h4 id="❌-缺点-13"><a href="#❌-缺点-13" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>迭代器对象会额外消耗内存。</li>
<li>如果集合被修改，迭代器可能失效（Java 的 <strong>fail-fast</strong> 机制）。</li>
</ul>
<h3 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h3><p><strong>核心思想</strong>：保存对象内部状态，支持撤销。<br> <strong>结构</strong>：Originator + Memento + Caretaker。<br> <strong>适用场景</strong>：编辑器撤销、游戏存档。<br> <strong>优点</strong>：封装状态。<br> <strong>缺点</strong>：内存消耗大。<br> <strong>应用</strong>：IDE Undo 功能。</p>
<p>发起人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建备忘录</span></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Memento</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从备忘录恢复</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restore</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = memento.getContent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内部类，保证外界不能随便操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String content;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Memento</span><span class="params">(String content)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.content = content;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>管理人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;TextEditor.Memento&gt; history = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(TextEditor editor)</span> &#123;</span><br><span class="line">        history.push(editor.save());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">(TextEditor editor)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!history.isEmpty()) &#123;</span><br><span class="line">            editor.restore(history.pop());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        TextEditor editor = new TextEditor();</span><br><span class="line">        Caretaker caretaker = new Caretaker();</span><br><span class="line"></span><br><span class="line">        editor.setContent(&quot;第一次输入&quot;);</span><br><span class="line">        caretaker.save(editor);</span><br><span class="line"></span><br><span class="line">        editor.setContent(&quot;第二次输入&quot;);</span><br><span class="line">        caretaker.save(editor);</span><br><span class="line"></span><br><span class="line">        editor.setContent(&quot;第三次输入&quot;);</span><br><span class="line">        System.out.println(&quot;当前内容: &quot; + editor.getContent());</span><br><span class="line"></span><br><span class="line">        caretaker.undo(editor);</span><br><span class="line">        System.out.println(&quot;撤销一次: &quot; + editor.getContent());</span><br><span class="line"></span><br><span class="line">        caretaker.undo(editor);</span><br><span class="line">        System.out.println(&quot;撤销两次: &quot; + editor.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="✅-优点-14"><a href="#✅-优点-14" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>封装性好：不暴露对象的内部细节。</li>
<li>简化了发起人：只需要保存&#x2F;恢复，不关心历史的管理。</li>
<li>符合 <strong>单一职责原则</strong>：状态的存储交给备忘录，历史管理交给看护者。</li>
</ul>
<h4 id="❌-缺点-14"><a href="#❌-缺点-14" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>可能消耗大量内存（如果频繁保存状态）。</li>
<li>在复杂对象里，备份状态的开销可能很大。</li>
<li>如果需要支持“增量存档”，实现会变复杂。</li>
</ul>
<h3 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h3><p><strong>核心思想</strong>：为语言定义文法，并解释执行。<br> <strong>结构</strong>：Expression 接口 + Terminal&#x2F;NonTerminal。<br> <strong>适用场景</strong>：简单语言解析。<br> <strong>优点</strong>：扩展性强。<br> <strong>缺点</strong>：复杂文法难以维护。<br> <strong>应用</strong>：正则表达式解析器。</p>
<p>抽象表达式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Expression &#123;</span><br><span class="line">    boolean interpret(Map&lt;String, Boolean&gt; context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>终结符表达式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class VariableExpression implements Expression &#123;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    public VariableExpression(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean interpret(Map&lt;String, Boolean&gt; context) &#123;</span><br><span class="line">        return context.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>非终结符表达式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">class AndExpression implements Expression &#123;</span><br><span class="line">    private Expression left, right;</span><br><span class="line"></span><br><span class="line">    public AndExpression(Expression left, Expression right) &#123;</span><br><span class="line">        this.left = left;</span><br><span class="line">        this.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean interpret(Map&lt;String, Boolean&gt; context) &#123;</span><br><span class="line">        return left.interpret(context) &amp;&amp; right.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class OrExpression implements Expression &#123;</span><br><span class="line">    private Expression left, right;</span><br><span class="line"></span><br><span class="line">    public OrExpression(Expression left, Expression right) &#123;</span><br><span class="line">        this.left = left;</span><br><span class="line">        this.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean interpret(Map&lt;String, Boolean&gt; context) &#123;</span><br><span class="line">        return left.interpret(context) || right.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class NotExpression implements Expression &#123;</span><br><span class="line">    private Expression exp;</span><br><span class="line"></span><br><span class="line">    public NotExpression(Expression exp) &#123;</span><br><span class="line">        this.exp = exp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean interpret(Map&lt;String, Boolean&gt; context) &#123;</span><br><span class="line">        return !exp.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 构建表达式: (a AND b) OR (c AND NOT d)</span><br><span class="line">        Expression a = new VariableExpression(&quot;a&quot;);</span><br><span class="line">        Expression b = new VariableExpression(&quot;b&quot;);</span><br><span class="line">        Expression c = new VariableExpression(&quot;c&quot;);</span><br><span class="line">        Expression d = new VariableExpression(&quot;d&quot;);</span><br><span class="line"></span><br><span class="line">        Expression expr = new OrExpression(</span><br><span class="line">            new AndExpression(a, b),</span><br><span class="line">            new AndExpression(c, new NotExpression(d))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        // 上下文赋值</span><br><span class="line">        Map&lt;String, Boolean&gt; context = new HashMap&lt;&gt;();</span><br><span class="line">        context.put(&quot;a&quot;, true);</span><br><span class="line">        context.put(&quot;b&quot;, false);</span><br><span class="line">        context.put(&quot;c&quot;, true);</span><br><span class="line">        context.put(&quot;d&quot;, false);</span><br><span class="line"></span><br><span class="line">        // 解释</span><br><span class="line">        boolean result = expr.interpret(context);</span><br><span class="line">        System.out.println(&quot;结果: &quot; + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="✅-优点-15"><a href="#✅-优点-15" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>易于扩展：每个文法规则对应一个类，新增规则时只需新增类。</li>
<li>代码结构清晰：将复杂表达式的解析逻辑拆分成对象树。</li>
<li>符合 <strong>开闭原则</strong>。</li>
</ul>
<h4 id="❌-缺点-15"><a href="#❌-缺点-15" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>类数量可能爆炸（每个规则一个类）。</li>
<li>对于复杂文法性能差，不如 <strong>编译原理里的解析器生成工具（ANTLR、Yacc）</strong>。</li>
<li>可读性下降，大量小类不利于维护。</li>
</ul>
<h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><p><strong>核心思想</strong>：通过中介对象封装对象之间的交互。<br> <strong>结构</strong>：Mediator + Colleague。<br> <strong>适用场景</strong>：复杂交互。<br> <strong>优点</strong>：减少对象间耦合。<br> <strong>缺点</strong>：中介者可能过于复杂。<br> <strong>应用</strong>：MVC 的 Controller。</p>
<p>抽象中介者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface ChatMediator &#123;</span><br><span class="line">    void sendMessage(String msg, User user);</span><br><span class="line">    void addUser(User user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>具体中介者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class ChatRoom implements ChatMediator &#123;</span><br><span class="line">    private List&lt;User&gt; users = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sendMessage(String msg, User user) &#123;</span><br><span class="line">        for (User u : users) &#123;</span><br><span class="line">            if (u != user) &#123;</span><br><span class="line">                u.receive(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addUser(User user) &#123;</span><br><span class="line">        users.add(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>抽象同事类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">abstract class User &#123;</span><br><span class="line">    protected ChatMediator mediator;</span><br><span class="line">    protected String name;</span><br><span class="line"></span><br><span class="line">    public User(ChatMediator mediator, String name) &#123;</span><br><span class="line">        this.mediator = mediator;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract void send(String msg);</span><br><span class="line">    public abstract void receive(String msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>具体同事类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">abstract class User &#123;</span><br><span class="line">    protected ChatMediator mediator;</span><br><span class="line">    protected String name;</span><br><span class="line"></span><br><span class="line">    public User(ChatMediator mediator, String name) &#123;</span><br><span class="line">        this.mediator = mediator;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract void send(String msg);</span><br><span class="line">    public abstract void receive(String msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ChatMediator chat = new ChatRoom();</span><br><span class="line"></span><br><span class="line">        User u1 = new ChatUser(chat, &quot;Alice&quot;);</span><br><span class="line">        User u2 = new ChatUser(chat, &quot;Bob&quot;);</span><br><span class="line">        User u3 = new ChatUser(chat, &quot;Charlie&quot;);</span><br><span class="line"></span><br><span class="line">        chat.addUser(u1);</span><br><span class="line">        chat.addUser(u2);</span><br><span class="line">        chat.addUser(u3);</span><br><span class="line"></span><br><span class="line">        u1.send(&quot;大家好！&quot;);</span><br><span class="line">        u2.send(&quot;你好 Alice！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>GUI 框架</strong></p>
<ul>
<li>窗口、按钮、输入框之间的交互，通常用中介者（对话框管理器）。</li>
</ul>
<p><strong>聊天室 &#x2F; 消息队列 &#x2F; 事件总线</strong></p>
<ul>
<li>用户或模块之间通过中介者（聊天室、消息中心）通信。</li>
</ul>
<p><strong>航班调度系统</strong></p>
<ul>
<li>飞机（同事）通过塔台（中介者）协调起降。</li>
</ul>
<p><strong>Spring ApplicationContext</strong></p>
<ul>
<li>Bean 之间的依赖关系，通过 IoC 容器调度，本质上也是一种中介者思想。</li>
</ul>
<h4 id="✅-优点-16"><a href="#✅-优点-16" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>降低对象之间的耦合（解耦合）。</li>
<li>将交互逻辑集中到一个中介者，便于维护。</li>
<li>符合 <strong>迪米特法则（最少知识原则）</strong>：对象只与中介者交互。</li>
</ul>
<h4 id="❌-缺点-16"><a href="#❌-缺点-16" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>中介者本身可能变得过于复杂，演变成“上帝类”。</li>
<li>过度使用会让逻辑集中在一个类里，维护困难。</li>
</ul>
<h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><p><strong>核心思想</strong>：定义算法骨架，子类实现具体步骤。<br> <strong>结构</strong>：抽象类 + 具体实现类。<br> <strong>适用场景</strong>：算法流程固定，但部分步骤变化。<br> <strong>优点</strong>：复用流程逻辑。<br> <strong>缺点</strong>：子类自由度受限。<br> <strong>应用</strong>：<code>AbstractList</code>，Spring <code>JdbcTemplate</code>。</p>
<p>抽象类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="comment">// 模板方法，规定流程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">()</span> &#123;</span><br><span class="line">        readData();</span><br><span class="line">        processData();</span><br><span class="line">        writeData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">readData</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体子类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CSVDataProcessor</span> <span class="keyword">extends</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;读取 CSV 数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理 CSV 数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;写入 CSV 结果&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExcelDataProcessor</span> <span class="keyword">extends</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;读取 Excel 数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理 Excel 数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;写入 Excel 结果&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DataProcessor</span> <span class="variable">csv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CSVDataProcessor</span>();</span><br><span class="line">        csv.process();</span><br><span class="line"></span><br><span class="line">        <span class="type">DataProcessor</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExcelDataProcessor</span>();</span><br><span class="line">        excel.process();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-17"><a href="#✅-优点-17" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li>封装不变部分，扩展可变部分。</li>
<li>遵循 <strong>开闭原则</strong>：新增子类即可扩展新的算法变种。</li>
<li>代码复用：把公共部分提取到父类。</li>
</ul>
<h4 id="❌-缺点-17"><a href="#❌-缺点-17" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li>子类数量可能过多（每个变化点一个子类）。</li>
<li>继承关系使得父类对子类有一定的限制（不如组合灵活）。</li>
</ul>
<h3 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h3><p><strong>核心思想</strong>：将操作从对象结构中分离出来，避免修改类定义。<br> <strong>结构</strong>：Visitor + Element。<br> <strong>适用场景</strong>：对象结构稳定，操作频繁变化。<br> <strong>优点</strong>：增加新操作简单。<br> <strong>缺点</strong>：增加新元素困难。<br> <strong>应用</strong>：编译器语法树遍历。</p>
<p>访问者接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface Visitor &#123;</span><br><span class="line">    void visitFile(FileElement file);</span><br><span class="line">    void visitDirectory(DirectoryElement dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>具体访问者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">class SizeVisitor implements Visitor &#123;</span><br><span class="line">    private int totalSize = 0;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void visitFile(FileElement file) &#123;</span><br><span class="line">        totalSize += file.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void visitDirectory(DirectoryElement dir) &#123;</span><br><span class="line">        for (Element e : dir.getChildren()) &#123;</span><br><span class="line">            e.accept(this); // 递归访问</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getTotalSize() &#123; return totalSize; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PrintVisitor implements Visitor &#123;</span><br><span class="line">    private int indent = 0;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void visitFile(FileElement file) &#123;</span><br><span class="line">        System.out.println(&quot;  &quot;.repeat(indent) + file.getName() + &quot; (&quot; + file.getSize() + &quot;)&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void visitDirectory(DirectoryElement dir) &#123;</span><br><span class="line">        System.out.println(&quot;  &quot;.repeat(indent) + &quot;[&quot; + dir.getName() + &quot;]&quot;);</span><br><span class="line">        indent++;</span><br><span class="line">        for (Element e : dir.getChildren()) &#123;</span><br><span class="line">            e.accept(this);</span><br><span class="line">        &#125;</span><br><span class="line">        indent--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>元素接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Element &#123;</span><br><span class="line">    void accept(Visitor visitor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>具体元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">class FileElement implements Element &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int size;</span><br><span class="line"></span><br><span class="line">    public FileElement(String name, int size) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getSize() &#123; return size; &#125;</span><br><span class="line">    public String getName() &#123; return name; &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void accept(Visitor visitor) &#123;</span><br><span class="line">        visitor.visitFile(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DirectoryElement implements Element &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private List&lt;Element&gt; children = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    public DirectoryElement(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void add(Element e) &#123; children.add(e); &#125;</span><br><span class="line">    public List&lt;Element&gt; getChildren() &#123; return children; &#125;</span><br><span class="line">    public String getName() &#123; return name; &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void accept(Visitor visitor) &#123;</span><br><span class="line">        visitor.visitDirectory(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        DirectoryElement root = new DirectoryElement(&quot;root&quot;);</span><br><span class="line">        root.add(new FileElement(&quot;a.txt&quot;, 10));</span><br><span class="line">        root.add(new FileElement(&quot;b.txt&quot;, 20));</span><br><span class="line"></span><br><span class="line">        DirectoryElement subDir = new DirectoryElement(&quot;sub&quot;);</span><br><span class="line">        subDir.add(new FileElement(&quot;c.txt&quot;, 5));</span><br><span class="line">        root.add(subDir);</span><br><span class="line"></span><br><span class="line">        // 打印</span><br><span class="line">        PrintVisitor printVisitor = new PrintVisitor();</span><br><span class="line">        root.accept(printVisitor);</span><br><span class="line"></span><br><span class="line">        // 统计大小</span><br><span class="line">        SizeVisitor sizeVisitor = new SizeVisitor();</span><br><span class="line">        root.accept(sizeVisitor);</span><br><span class="line">        System.out.println(&quot;总大小: &quot; + sizeVisitor.getTotalSize());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="✅-优点-18"><a href="#✅-优点-18" class="headerlink" title="✅ 优点"></a>✅ 优点</h4><ul>
<li><strong>符合开闭原则</strong>：数据结构不变，增加新操作很容易。</li>
<li><strong>操作集中</strong>：将操作逻辑集中到访问者类中，避免分散在元素类里。</li>
<li>支持对不同类型元素做不同操作。</li>
</ul>
<h4 id="❌-缺点-18"><a href="#❌-缺点-18" class="headerlink" title="❌ 缺点"></a>❌ 缺点</h4><ul>
<li><strong>增加新元素困难</strong>：如果要给结构中加一种新元素，就要修改所有访问者 → 违背开闭原则。</li>
<li><strong>结构复杂</strong>：需要双重分派（<code>element.accept(visitor)</code> → <code>visitor.visit(element)</code>）。</li>
<li><strong>侵入性</strong>：元素类必须暴露自己的 <code>accept()</code>，让访问者访问内部。</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">John Doe</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/08/12/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/08/12/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/')">设计模式</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/08/12/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=设计模式&amp;url=http://example.com/2025/08/12/Java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/08/12/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kafka/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">kafka</div></div></a></div><div class="next-post pull-right"><a href="/2025/08/12/Java/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">JVM类加载</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.</span> <span class="toc-text">设计原则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SOLID"><span class="toc-number">1.1.</span> <span class="toc-text">1.SOLID</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-S-%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.S-单一职责原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-O-%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.O-开闭原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-I-%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.3.</span> <span class="toc-text">4.I-接口隔离原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-D-%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.4.</span> <span class="toc-text">5.D-依赖倒置原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%85%B6%E4%BB%96%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">2.其他设计原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.迪米特法则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%E5%8E%9F%E5%88%99"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.合成复用原则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">创建型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%A5%BF%E6%B1%89%E5%BC%8F%EF%BC%88Eager-Initialization%EF%BC%89"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">1.饿汉式（Eager Initialization）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%87%92%E6%B1%89%E5%BC%8F%EF%BC%88Lazy-Initialization%EF%BC%8C%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%EF%BC%89"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">2.懒汉式（Lazy Initialization，线程不安全）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%87%92%E6%B1%89%E5%BC%8F%EF%BC%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%89%88%EF%BC%89"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">3.懒汉式（线程安全版）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81-DCL"><span class="toc-number">2.1.1.4.</span> <span class="toc-text">4.双重检查锁(DCL)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">2.1.1.5.</span> <span class="toc-text">5.静态内部类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%9E%9A%E4%B8%BE%E7%B1%BB"><span class="toc-number">2.1.1.6.</span> <span class="toc-text">6.枚举类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SLF4J%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.1.7.</span> <span class="toc-text">SLF4J的单例模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.工厂方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.3.</span> <span class="toc-text">3.抽象工厂方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.4.</span> <span class="toc-text">4.建造者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E9%9D%99%E6%80%81%E7%B1%BB"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">内部静态类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9"><span class="toc-number">2.1.4.3.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9"><span class="toc-number">2.1.4.4.</span> <span class="toc-text">❌ 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lombok-%E7%9A%84-Builder"><span class="toc-number">2.1.4.5.</span> <span class="toc-text">Lombok 的 @Builder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#StringBuilder"><span class="toc-number">2.1.4.6.</span> <span class="toc-text">StringBuilder</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.5.</span> <span class="toc-text">5.原型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B5%85%E6%8B%B7%E8%B4%9D%EF%BC%88Shallow-Copy%EF%BC%89"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">1. 浅拷贝（Shallow Copy）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B7%B1%E6%8B%B7%E8%B4%9D%EF%BC%88Deep-Copy%EF%BC%89"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">2. 深拷贝（Deep Copy）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E4%B8%AD%E5%BA%94%E7%94%A8"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">Java中应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">6.适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E4%B8%AD%E7%9A%84%E6%A0%87%E5%87%86%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">Java中的标准适配器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#java%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%BE%8B%E5%AD%90"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">java的实现例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-1"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-1"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">7.装饰器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#java%E5%AE%9E%E7%8E%B0%E4%BE%8B%E5%AD%90"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">java实现例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%B0%E5%AE%9E%E4%BE%8B%E5%AD%90"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">现实例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-2"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-2"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.3.</span> <span class="toc-text">8.代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">代理模式类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-3"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-3"><span class="toc-number">2.2.3.3.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.4.</span> <span class="toc-text">9.外观模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-4"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-4"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.5.</span> <span class="toc-text">10.桥接模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-5"><span class="toc-number">2.2.5.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-5"><span class="toc-number">2.2.5.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.6.</span> <span class="toc-text">11.组合模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-6"><span class="toc-number">2.2.6.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-6"><span class="toc-number">2.2.6.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.7.</span> <span class="toc-text">12.享元模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-7"><span class="toc-number">2.2.7.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-7"><span class="toc-number">2.2.7.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">行为型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.1.</span> <span class="toc-text">观察者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-8"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-8"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.2.</span> <span class="toc-text">策略模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-9"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-9"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.3.</span> <span class="toc-text">责任链模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-10"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">✅  优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-10"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.4.</span> <span class="toc-text">状态模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-11"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-11"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.5.</span> <span class="toc-text">命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-12"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-12"><span class="toc-number">2.3.5.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.6.</span> <span class="toc-text">迭代器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-13"><span class="toc-number">2.3.6.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-13"><span class="toc-number">2.3.6.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.7.</span> <span class="toc-text">备忘录模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-14"><span class="toc-number">2.3.7.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-14"><span class="toc-number">2.3.7.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.8.</span> <span class="toc-text">解释器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-15"><span class="toc-number">2.3.8.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-15"><span class="toc-number">2.3.8.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.9.</span> <span class="toc-text">中介者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-16"><span class="toc-number">2.3.9.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-16"><span class="toc-number">2.3.9.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.10.</span> <span class="toc-text">模板方法模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-17"><span class="toc-number">2.3.10.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-17"><span class="toc-number">2.3.10.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.3.11.</span> <span class="toc-text">访问者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9C%85-%E4%BC%98%E7%82%B9-18"><span class="toc-number">2.3.11.1.</span> <span class="toc-text">✅ 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9D%8C-%E7%BC%BA%E7%82%B9-18"><span class="toc-number">2.3.11.2.</span> <span class="toc-text">❌ 缺点</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/05/%E7%BD%91%E7%BB%9C/Untitled%201/" title="No title">No title</a><time datetime="2026-01-05T09:06:22.201Z" title="Created 2026-01-05 17:06:22">2026-01-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/05/linux%E5%86%85%E6%A0%B8/" title="No title">No title</a><time datetime="2026-01-05T09:06:22.200Z" title="Created 2026-01-05 17:06:22">2026-01-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/05/%E4%B8%AA%E4%BA%BA%E4%BB%8B%E7%BB%8D/" title="No title">No title</a><time datetime="2026-01-05T09:06:22.200Z" title="Created 2026-01-05 17:06:22">2026-01-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/05/hello-world/" title="Hello World">Hello World</a><time datetime="2026-01-05T09:06:22.199Z" title="Created 2026-01-05 17:06:22">2026-01-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/05/Java/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/" title="全局异常捕获">全局异常捕获</a><time datetime="2026-01-05T08:31:25.000Z" title="Created 2026-01-05 16:31:25">2026-01-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2026 By <a class="footer-bar-link" href="/" title="John Doe" target="_blank">John Doe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">40</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">21</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 0.88rem;">leetcode<sup>5</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 0.88rem;">分布式<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>2</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">网络安全<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 John Doe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>