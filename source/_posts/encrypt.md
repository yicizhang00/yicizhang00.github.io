---
title: 勒索软件最佳实践
date: 2025-12-15 03:09:50
tags:
- 网络安全
---

# 加密和密钥交换

勒索软件需要解决三个问题：

1.在加密时应当占用资源少并且耗时短。

2.加密的密钥应该能正确回传。

3.加密的密钥即使被流量监听到也不应能成功解密。

要解决这三个问题，一种混合的加密模式出现：

## 1. **生成非对称密钥对**

- 攻击者预先生成一对非对称密钥（公钥 PK 和私钥 SK）。
- **私钥 SK** 保存在攻击者的服务器上，不会泄露。
- **公钥 PK** 被用来加密文件密钥（对称密钥 K），并发送给受害者的机器。

### 2. **下载公钥（PK）**

- 当勒索软件被植入受害者的机器后，勒索软件会从攻击者的 **C2（Command and Control）服务器** 下载 **公钥 PK**，即攻击者用于加密文件密钥的公钥。

### 3. **生成对称密钥（K）**

- 勒索软件在受害者的机器上随机生成一个 **对称密钥 K**。通常使用高效的对称加密算法，如 **AES-256**，因为对称加密的速度比非对称加密快，适合加密大量数据（例如受害者的文件）。

### 4. **加密受害者文件**

- 勒索软件使用生成的 **对称密钥 K** 来加密受害者的文件。由于 **AES-256** 等对称加密算法的效率，文件加密操作非常快速，适合加密大量数据。

### 5. **加密对称密钥（K）**

- 一旦文件加密完成，勒索软件会用攻击者的 **公钥 PK** 加密受害者本地生成的 **对称密钥 K**。这样做是为了确保只有攻击者能够解密这个密钥。
- 由于 **PK** 是公钥，任何人都可以用它加密数据，但只有攻击者手中的私钥 **SK** 可以解密。

### 6. **保存加密的对称密钥（Encrypted_K）**

- **Encrypted_K = PK(K)** 是 **加密后的对称密钥**。勒索软件会将这个加密后的密钥（Encrypted_K）上传到攻击者的 **C2 服务器** 或者保存在本地，并删除明文对称密钥 K。
- 一旦删除了对称密钥 K，受害者就无法自行解密他们的文件。

### 7. **勒索和恢复**

- 受害者无法解密自己的文件，除非他们从攻击者手中购买私钥 **SK**，攻击者声称持有该私钥，并且能用它解密 **Encrypted_K**（从而恢复 K）。
- 使用私钥 **SK** 解密 **Encrypted_K** 得到 **K**，然后可以用 **K** 解密受害者的文件。

### **关键优点和解释**

- **对称加密**（如 AES）适用于大文件，因为它比非对称加密快。
- **非对称加密**（使用公钥 PK）用于加密对称密钥 K，确保只有攻击者能解密密钥。
- 这种混合加密方案避免了使用纯非对称加密的效率瓶颈，因为非对称加密（例如 RSA）处理大文件时会非常慢。

### **常见勒索软件中类似的加密流程**

这一加密过程与许多实际的勒索软件攻击相似，常见的勒索软件，如 **WannaCry**、**NotPetya**、**CryptoLocker** 等，都使用了 **对称加密 + 非对称加密** 的混合方法来加密受害者文件。

### **勒索软件的整体流程**：

1. **植入受害者机器**。
2. **下载攻击者公钥 PK**。
3. **生成对称密钥 K**。
4. **用 K 加密文件**。
5. **用 PK 加密 K**。
6. **将加密后的 K 上传或保存在本地**。
7. **删除明文 K**，使得受害者无法自行解密文件。
8. **要求支付赎金**，以换取私钥 SK，进而解密文件。
