---
title: è®¾è®¡æ¨¡å¼
date: 2025-08-12 01:55:16
tags:
categories: 
  - è®¾è®¡æ¨¡å¼
  - java
---

# è®¾è®¡åŸåˆ™

## 1.SOLID

### 1.S-å•ä¸€èŒè´£åŸåˆ™

ç±»çš„è®¾è®¡è¦**é«˜å†…èšä½è€¦åˆ**ï¼Œä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå¼•å‘å…¶å˜åŒ–çš„åŸå› ã€‚

### 2.O-å¼€é—­åŸåˆ™

ç³»ç»Ÿè¦æ‰©å±•åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸæœ‰ä»£ç 

3.L-é‡Œæ°æ›¿æ¢åŸåˆ™

å­ç±»å¿…é¡»èƒ½å¤Ÿä»£æ›¿çˆ¶ç±»ï¼Œå¹¶ä¿æŒå…¶æ­£ç¡®æ€§

### 4.I-æ¥å£éš”ç¦»åŸåˆ™

å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–å…¶ä¸ä½¿ç”¨çš„æ–¹æ³•

### 5.D-ä¾èµ–å€’ç½®åŸåˆ™

é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚

## 2.å…¶ä»–è®¾è®¡åŸåˆ™

### 1.è¿ªç±³ç‰¹æ³•åˆ™

ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡æœ‰å°½å¯èƒ½å°‘çš„äº†è§£ã€‚

é™ä½è€¦åˆï¼Œé¿å…è¿‡é•¿è°ƒç”¨é“¾

### 2.åˆæˆå¤ç”¨åŸåˆ™

ä¼˜å…ˆä½¿ç”¨ç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿ã€‚

 æ„ä¹‰ï¼šç»§æ‰¿æ˜¯â€œå¼ºè€¦åˆâ€ï¼Œç»„åˆæ›´çµæ´»ã€‚

# è®¾è®¡æ¨¡å¼

## åˆ›å»ºå‹æ¨¡å¼

### 1.å•ä¾‹æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šæŸä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è·å–è¿™ä¸ªå®ä¾‹ã€‚
 **ç»“æ„**ï¼šæ„é€ å™¨ç§æœ‰åŒ– + é™æ€å®ä¾‹ + å…¨å±€è®¿é—®æ–¹æ³•ã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šé…ç½®å¯¹è±¡ã€çº¿ç¨‹æ± ã€æ—¥å¿—ç³»ç»Ÿã€‚
 **ä¼˜ç‚¹**ï¼šæ§åˆ¶å…¨å±€å”¯ä¸€å¯¹è±¡ï¼ŒèŠ‚çœèµ„æºã€‚
 **ç¼ºç‚¹**ï¼šå…¨å±€çŠ¶æ€å¯èƒ½å¯¼è‡´ä»£ç éš¾ä»¥æµ‹è¯•ã€‚
 **åº”ç”¨**ï¼š`Runtime.getRuntime()`ï¼ŒSpring é»˜è®¤ bean å•ä¾‹ã€‚

#### 1.**é¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰**

```java
public class Singleton {
    private static final Singleton instance = new Singleton();
    private Singleton() {}
    public static Singleton getInstance() {
        return instance;
    }
}
```

ç‰¹ç‚¹ï¼šé¥¿æ±‰å¼åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå¯¹è±¡ï¼Œå³åœ¨ç±»çš„Initializationï¼ˆåŠ è½½ï¼‰é˜¶æ®µåˆ›å»ºã€‚

ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ç®€å•ã€‚

ç¼ºç‚¹ï¼šä¸€å¼€å§‹å°±åŠ è½½å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æµªè´¹ã€‚



#### 2.æ‡’æ±‰å¼ï¼ˆLazy Initializationï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼‰

```java
public class Singleton {
    private static Singleton instance;
    private Singleton() {}
    public static Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}

```

ç‰¹ç‚¹ï¼šåªæœ‰åœ¨éœ€è¦ç”¨åˆ°è¿™ä¸ªå®ä¾‹æ—¶æ‰è¿›è¡Œç¬¬ä¸€æ¬¡åˆ›å»ºã€‚

ç¼ºç‚¹ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥`if(instance==null)`ä¸­ï¼Œå¯¼è‡´åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚



#### 3.æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ç‰ˆï¼‰

```java
public class Singleton {
    private static Singleton instance;
    private Singleton() {}
    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}

```

1. åœ¨å®ä¾‹æ–¹æ³•åŠ é”

```
public synchronized void foo() {
    // ...
}

```

ç­‰ä»·äº

```
public void foo() {
    synchronized(this) {
        // ...
    }
}

```

- é”çš„å¯¹è±¡æ˜¯ **å½“å‰å®ä¾‹ (this)**ã€‚

- åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ª `synchronized` å®ä¾‹æ–¹æ³•ï¼Œè°ƒç”¨æ—¶ä¼šäº’æ–¥ã€‚

- ä¸åŒå¯¹è±¡ä¹‹é—´äº’ä¸å½±å“ã€‚

2. åœ¨é™æ€æ–¹æ³•åŠ é”

```
public static synchronized void bar() {
    // ...
}

```

ç­‰ä»·äº

```
public static void bar() {
    synchronized (Singleton.class) {
        // ...
    }
}

```

- é”çš„å¯¹è±¡æ˜¯ **ç±»çš„ `Class` å¯¹è±¡**ã€‚

- æ•´ä¸ªç±»èŒƒå›´å†…ï¼ˆæ‰€æœ‰å®ä¾‹ï¼‰å…±äº«ä¸€æŠŠé”ã€‚æ— è®ºä»å“ªä¸ªå¯¹è±¡æˆ–ç±»åè°ƒç”¨ï¼Œéƒ½è¦ç«äº‰ **åŒä¸€æŠŠç±»é”**ã€‚

ç‰¹ç‚¹ï¼šå› æ­¤æ‡’æ±‰å¼çš„çº¿ç¨‹å®‰å…¨ç‰ˆåŠ çš„æ˜¯é™æ€æ–¹æ³•é”ï¼Œå³å¯¹æ•´ä¸ªç±»çš„å¯¹è±¡åŠ é”ã€‚

ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨

ç¼ºç‚¹ï¼šæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦åŠ é”ï¼Œæ•ˆç‡ä½ã€‚

#### 4.åŒé‡æ£€æŸ¥é”(DCL)

```java
public class Singleton {
    private static volatile Singleton instance;
    private Singleton() {}
    public static Singleton getInstance() {
        if (instance == null) {
            synchronized(Singleton.class) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}

```

å…¶ä¸­`volatile`å…³é”®å­—é˜²æ­¢æŒ‡ä»¤é‡æ’ï¼Œåœ¨Javaä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¯ä»¥å¤§æ¦‚åˆ†ä¸ºä¸‰æ­¥ï¼š

```
memory = allocate();         // 1. åˆ†é…å†…å­˜
ctorInstance(memory);        // 2. åˆå§‹åŒ–å¯¹è±¡
instance = memory;           // 3. å°† instance æŒ‡å‘å†…å­˜

```

è€ŒJITå’ŒCPUçš„æŒ‡ä»¤é‡æ’ä¼šå¯¼è‡´

```
memory = allocate();         // 1. åˆ†é…å†…å­˜
instance = memory;           // 2. å°† instance æŒ‡å‘å†…å­˜
ctorInstance(memory);        // 3. åˆå§‹åŒ–å¯¹è±¡
```

é‚£ä¹ˆä¸€ä¸ªå¯¹è±¡åœ¨`if(instance==null)`å¯èƒ½ä¼šç›´æ¥`return`ä¸€ä¸ªå­˜åœ¨å¼•ç”¨ä½†æ˜¯æœªåˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡ã€‚

ä¼˜ç‚¹ï¼šå¯¹æ¯”æ•´ä½“åŠ é”ï¼Œå¤–å±‚çš„ifå¾ªç¯å¯ä»¥åœ¨å·²ç»å­˜åœ¨å®ä¾‹æ—¶ç›´æ¥è¿”å›å•ä¾‹å¯¹è±¡ã€‚

#### 5.é™æ€å†…éƒ¨ç±»

```
public class Singleton {
    private Singleton() {}

    private static class Holder {
        private static final Singleton INSTANCE = new Singleton();
    }

    public static Singleton getInstance() {
        return Holder.INSTANCE;
    }
}

```

**å¤–éƒ¨ç±» `Singleton` çš„åŠ è½½**
 å½“ JVM åŠ è½½ `Singleton.class` æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³åŠ è½½ `Holder` ç±»ã€‚
 æ‰€ä»¥æ­¤æ—¶å•ä¾‹å¯¹è±¡ **è¿˜æ²¡æœ‰è¢«åˆ›å»º**ã€‚

**`Holder` çš„åŠ è½½ä¸åˆå§‹åŒ–**
 åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ `Singleton.getInstance()` æ—¶ï¼Œæ‰ä¼šè§¦å‘å¯¹ `Holder` ç±»çš„ä¸»åŠ¨ä½¿ç”¨ï¼Œä»è€Œå¯¼è‡´ `Holder` è¢« **åŠ è½½å¹¶åˆå§‹åŒ–**ã€‚
 åœ¨ `Holder` åˆå§‹åŒ–é˜¶æ®µï¼Œ`INSTANCE = new Singleton()` æ‰ä¼šæ‰§è¡Œã€‚

**çº¿ç¨‹å®‰å…¨ä¿è¯**
 JVM åœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µä¼šä¿è¯ï¼š

- `<clinit>()` æ–¹æ³•ï¼ˆå³ç±»çš„é™æ€åˆå§‹åŒ–é€»è¾‘ï¼‰å¯¹åŒä¸€ä¸ªç±»åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡
- å¹¶ä¸”æ˜¯ç”± JVM ä¿è¯çš„ **åŒæ­¥è¿‡ç¨‹**
   å› æ­¤ä¸éœ€è¦ `synchronized`ï¼Œå¤©ç„¶çº¿ç¨‹å®‰å…¨ã€‚

ç‰¹ç‚¹ï¼šé‡‡ç”¨äº†JVMçš„åŒæ­¥è¿‡ç¨‹ä¿è¯åªä¼šåŠ è½½ä¸€æ¬¡ã€‚

#### 6.æšä¸¾ç±»

```java
public enum Singleton {
    INSTANCE;

    public void doSomething() {
        System.out.println("working...");
    }
}
```

ç‰¹ç‚¹ï¼šå¤©ç„¶é˜²æ­¢åå°„å’Œåºåˆ—åŒ–ç ´åã€‚**åå°„ç ´åä¸äº†**ï¼ˆJVM å±‚é¢ç¦æ­¢ï¼‰ï¼Œ**åºåˆ—åŒ–ä¹Ÿç ´åä¸äº†**ï¼ˆJVM è‡ªåŠ¨å¤„ç†ï¼‰ã€‚

ç¼ºç‚¹ï¼šè¯­ä¹‰ä¸Šå¯èƒ½ä¸å¦‚ç±»æ¸…æ™°ã€‚

#### SLF4Jçš„å•ä¾‹æ¨¡å¼

åœ¨`LoggerFactory`ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªå­˜å‚¨å„ä¸ªç±»çš„ConcurrentHashMapï¼Œä½¿ç”¨å…¶ä¿è¯æ¯ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹

```java
public class LoggerFactory {
    // ä½¿ç”¨ConcurrentHashMapå­˜å‚¨å·²åˆ›å»ºçš„Loggerå®ä¾‹
    private static final ConcurrentHashMap<String, Logger> loggerMap = new ConcurrentHashMap<>();

    public static Logger getLogger(Class<?> clazz) {
        return getLogger(clazz.getName());
    }

    public static Logger getLogger(String name) {
        // å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨
        Logger logger = loggerMap.get(name);
        if (logger != null) {
            return logger;
        }

        // ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¹¶æ”¾å…¥ç¼“å­˜
        logger = new Logger(name);
        Logger existingLogger = loggerMap.putIfAbsent(name, logger);
        return existingLogger != null ? existingLogger : logger;
    }
}
```

å¯¹äºæ¯ä¸€ä¸ªç±»åˆ›å»ºå”¯ä¸€ä¸€ä¸ª`Logger`å¯¹è±¡ï¼Œä½¿ç”¨ConcurrentHashMapä¿æŒçº¿ç¨‹å®‰å…¨

```java
// åœ¨ç±»Aä¸­
private static final Logger logger = LoggerFactory.getLogger(ClassA.class);

// åœ¨ç±»Bä¸­
private static final Logger logger = LoggerFactory.getLogger(ClassB.class);
```

### 2.å·¥å‚æ–¹æ³•æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚
**ç»“æ„**ï¼šæŠ½è±¡å·¥å‚æ¥å£ + å…·ä½“å·¥å‚å®ç°ã€‚
**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦æ ¹æ®ç¯å¢ƒå†³å®šåˆ›å»ºçš„å¯¹è±¡ã€‚
**ä¼˜ç‚¹**ï¼šè§£è€¦å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨ã€‚
**ç¼ºç‚¹**ï¼šç±»æ•°é‡å¢åŠ ã€‚
**åº”ç”¨**ï¼šSLF4Jçš„`LoggerFactory`ï¼ŒJDBCçš„`DriverManager.getConnection()`å’Œ`Iterator<E> iteator()`æ–¹æ³•

å·¥å‚æ–¹æ³•æ¨¡å¼ä¸»è¦æœ‰ä»¥ä¸‹è§’è‰²ï¼š

1. **Productï¼ˆäº§å“æ¥å£/æŠ½è±¡ç±»ï¼‰**
    å®šä¹‰äº§å“çš„æŠ½è±¡ï¼ˆå¦‚ `Button` æ¥å£ï¼‰ã€‚

```java
public interface Button {
    void render();
}
```

2. **ConcreteProductï¼ˆå…·ä½“äº§å“ç±»ï¼‰**
    å®ç° Product æ¥å£ï¼ˆå¦‚ `WindowsButton`, `MacButton`ï¼‰ã€‚

```java
public class WindowsButton implements Button {
    public void render() {
        System.out.println("Render a Windows style button");
    }
}

public class MacButton implements Button {
    public void render() {
        System.out.println("Render a Mac style button");
    }
}

```

3. **Creatorï¼ˆæŠ½è±¡å·¥å‚/åˆ›å»ºè€…ï¼‰**
    å£°æ˜å·¥å‚æ–¹æ³•ï¼Œè¿”å› Productã€‚

```java
public abstract class Dialog {
    // å·¥å‚æ–¹æ³•ï¼Œè¿”å›æŠ½è±¡äº§å“
    public abstract Button createButton();

    // ä½¿ç”¨å·¥å‚æ–¹æ³•
    public void renderWindow() {
        Button okButton = createButton();
        okButton.render();
    }
}

```

4. **ConcreteCreatorï¼ˆå…·ä½“å·¥å‚ç±»ï¼‰**
    å®ç°å·¥å‚æ–¹æ³•ï¼Œè¿”å›å…·ä½“çš„ ConcreteProductã€‚

```java
public class WindowsDialog extends Dialog {
    public Button createButton() {
        return new WindowsButton();
    }
}

public class MacDialog extends Dialog {
    public Button createButton() {
        return new MacButton();
    }
}
```

5. å®¢æˆ·ç«¯å®ä¾‹åŒ–è¿‡ç¨‹

```java
public class Client {
    public static void main(String[] args) {
        Dialog dialog;

        String os = System.getProperty("os.name").toLowerCase();
        if (os.contains("win")) {
            dialog = new WindowsDialog();
        } else {
            dialog = new MacDialog();
        }

        dialog.renderWindow(); // ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºæŒ‰é’®
    }
}

```

ä¼˜ç‚¹

- ç¬¦åˆ **å¼€é—­åŸåˆ™**ï¼šæ–°å¢äº§å“æ—¶ï¼Œåªéœ€è¦æ–°å¢å·¥å‚ç±»ï¼Œä¸æ”¹åŸæœ‰ä»£ç ã€‚
- å®¢æˆ·ç«¯åªä¾èµ–æŠ½è±¡ï¼Œé™ä½è€¦åˆã€‚
- å®¹æ˜“æ‰©å±•äº§å“æ—ã€‚

ç¼ºç‚¹

- æ¯å¢åŠ ä¸€ä¸ªäº§å“ç±»ï¼Œå°±è¦å†™ä¸€ä¸ªæ–°çš„å·¥å‚ç±»ï¼Œç±»çš„æ•°é‡ä¼šå¢åŠ ã€‚
- ç»“æ„æ¯”ç®€å•å·¥å‚å¤æ‚ã€‚

### 3.æŠ½è±¡å·¥å‚æ–¹æ³•æ¨¡å¼

**æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒæä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±»ã€‚

**AbstractProductï¼ˆæŠ½è±¡äº§å“ï¼‰**
 æ¯ä¸ªäº§å“çš„æŠ½è±¡ï¼ˆä¾‹å¦‚ `Button`, `Checkbox`ï¼‰ã€‚

```java
// æŒ‰é’®æ¥å£
public interface Button {
    void paint();
}

// å¤é€‰æ¡†æ¥å£
public interface Checkbox {
    void paint();
}

```



**ConcreteProductï¼ˆå…·ä½“äº§å“ï¼‰**
 å…·ä½“äº§å“å®ç°ï¼ˆå¦‚ `WindowsButton`, `MacButton`ï¼‰ã€‚

```java
public class WindowsButton implements Button {
    public void paint() {
        System.out.println("Render a button in Windows style.");
    }
}

public class MacButton implements Button {
    public void paint() {
        System.out.println("Render a button in Mac style.");
    }
}

public class WindowsCheckbox implements Checkbox {
    public void paint() {
        System.out.println("Render a checkbox in Windows style.");
    }
}

public class MacCheckbox implements Checkbox {
    public void paint() {
        System.out.println("Render a checkbox in Mac style.");
    }
}

```



**AbstractFactoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰**
 å®šä¹‰åˆ›å»ºä¸€ç»„æŠ½è±¡äº§å“çš„æ–¹æ³•ã€‚

```java
public interface GUIFactory {
    Button createButton();
    Checkbox createCheckbox();
}

```

**ConcreteFactoryï¼ˆå…·ä½“å·¥å‚ï¼‰**
 å®ç°æŠ½è±¡å·¥å‚çš„æ–¹æ³•ï¼Œç”Ÿäº§å…·ä½“äº§å“æ—ã€‚

```java
public class WindowsFactory implements GUIFactory {
    public Button createButton() {
        return new WindowsButton();
    }
    public Checkbox createCheckbox() {
        return new WindowsCheckbox();
    }
}

public class MacFactory implements GUIFactory {
    public Button createButton() {
        return new MacButton();
    }
    public Checkbox createCheckbox() {
        return new MacCheckbox();
    }
}

```

**Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**
 é€šè¿‡æŠ½è±¡å·¥å‚è·å–äº§å“ï¼Œåªä¾èµ–æŠ½è±¡ï¼Œä¸å…³å¿ƒå…·ä½“å®ç°ã€‚

```java
public class Application {
    private Button button;
    private Checkbox checkbox;

    public Application(GUIFactory factory) {
        button = factory.createButton();
        checkbox = factory.createCheckbox();
    }

    public void render() {
        button.paint();
        checkbox.paint();
    }

    public static void main(String[] args) {
        GUIFactory factory;

        String os = System.getProperty("os.name").toLowerCase();
        if (os.contains("win")) {
            factory = new WindowsFactory();
        } else {
            factory = new MacFactory();
        }

        Application app = new Application(factory);
        app.render();
    }
}

```

### 4.å»ºé€ è€…æ¨¡å¼

å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§å°†å¤æ‚å¯¹è±¡çš„æ„é€ è¿‡ç¨‹ä¸è¡¨ç¤ºåˆ†ç¦»çš„è®¾è®¡æ¨¡å¼ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚

#### å†…éƒ¨é™æ€ç±»

```java

public class House {
    private String foundation;
    private String walls;
    private String roof;
    private boolean hasGarage;
    private boolean hasGarden;

    private House(Builder builder) {
        this.foundation = builder.foundation;
        this.walls = builder.walls;
        this.roof = builder.roof;
        this.hasGarage = builder.hasGarage;
        this.hasGarden = builder.hasGarden;
    }

    public static class Builder {
        private String foundation;
        private String walls;
        private String roof;
        private boolean hasGarage;
        private boolean hasGarden;

        public Builder foundation(String foundation) {
            this.foundation = foundation;
            return this;
        }
        public Builder walls(String walls) {
            this.walls = walls;
            return this;
        }
        public Builder roof(String roof) {
            this.roof = roof;
            return this;
        }
        public Builder garage(boolean hasGarage) {
            this.hasGarage = hasGarage;
            return this;
        }
        public Builder garden(boolean hasGarden) {
            this.hasGarden = hasGarden;
            return this;
        }
        public House build() {
            return new House(this);
        }
    }

    @Override
    public String toString() {
        return "House [foundation=" + foundation + ", walls=" + walls + 
               ", roof=" + roof + ", garage=" + hasGarage + ", garden=" + hasGarden + "]";
    }
}

```

#### å®¢æˆ·ç«¯

```java
House house = new House.Builder()
    .foundation("Concrete")
    .walls("Brick")
    .roof("Tile")
    .garage(true)
    .garden(false)
    .build();
System.out.println(house);

```

#### âœ… ä¼˜ç‚¹

- å°†å¤æ‚å¯¹è±¡çš„æ„å»ºå’Œè¡¨ç¤ºåˆ†ç¦»ï¼Œä»£ç æ›´æ¸…æ™°ã€‚
- æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œæ˜“è¯»æ€§å¼ºã€‚
- å¯ä»¥å¤ç”¨æ„é€ æ­¥éª¤ï¼Œåˆ›å»ºä¸åŒå¯¹è±¡ã€‚
- ç¬¦åˆ **å•ä¸€èŒè´£åŸåˆ™**ï¼šBuilder è´Ÿè´£æ„é€ ï¼ŒProduct è´Ÿè´£è¡¨ç¤ºã€‚

#### âŒ ç¼ºç‚¹

- ç±»æ•°é‡å¯èƒ½å¢å¤šï¼ˆä¼ ç»Ÿå†™æ³•éœ€è¦å¤šä¸ª Builderã€Directorï¼‰ã€‚
- ä¸é€‚åˆç®€å•å¯¹è±¡ï¼ˆä¼šæ˜¾å¾—è¿‡åº¦è®¾è®¡ï¼‰ã€‚

#### Lombok çš„ @Builder

Lombok é€šè¿‡åœ¨ç±»æˆ–æ„é€ å™¨/æ–¹æ³•ä¸ŠåŠ  `@Builder`ï¼Œ**è‡ªåŠ¨ç”Ÿæˆå†…éƒ¨é™æ€ Builder ç±»**ï¼Œçœå»æ‰‹å†™ Builder çš„éº»çƒ¦ã€‚

```java
import lombok.Builder;
import lombok.ToString;

@Builder
@ToString
public class User {
    private String name;
    private int age;
    private String email;
    private String password;
}

```

ç¼–è¯‘åï¼ŒLombok ä¼šå¸®ä½ ç”Ÿæˆä¸€ä¸ª `UserBuilder` ç±»ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ï¼š

```java
User user = User.builder()
        .name("Tom")
        .age(20)
        .email("tom@example.com")
        .password("123456")
        .build();

System.out.println(user);

```

#### StringBuilder

ä½¿ç”¨`append()`ä¸æ–­è¿½åŠ å†…å®¹ï¼Œæœ€åé€šè¿‡`toString()`å¾—åˆ°ç»“æœã€‚`StringBuilder` ä¸æ˜¯ä¸¥æ ¼çš„ **å»ºé€ è€…æ¨¡å¼**ï¼Œä½†ç”¨æ³•ä¸Šä½“ç°äº† **Builder æ¨¡å¼çš„æ€æƒ³**ï¼šé“¾å¼æ„å»ºã€æœ€åç”Ÿæˆç»“æœã€‚

```java
public class Main {
    public static void main(String[] args) {
        StringBuilder sb = new StringBuilder();

        String result = sb.append("Hello")
                          .append(", ")
                          .append("World")
                          .append("!")
                          .toString();

        System.out.println(result); // Hello, World!
    }
}

```



### 5.åŸå‹æ¨¡å¼

#### 1. **æµ…æ‹·è´ï¼ˆShallow Copyï¼‰**

- æ‹·è´å¯¹è±¡æœ¬èº«ï¼Œä½†å¼•ç”¨ç±»å‹å±æ€§åªæ‹·è´å¼•ç”¨ï¼Œä¸æ‹·è´å¯¹è±¡æœ¬èº«ã€‚
- å³ **å…±äº«å¼•ç”¨**ã€‚
- å¯èƒ½ä¼šå¼•å‘ <mark>æ”¹ä¸€å¤„åŠ¨å…¨èº«</mark> çš„é—®é¢˜

#### 2. **æ·±æ‹·è´ï¼ˆDeep Copyï¼‰**

- ä¸ä»…æ‹·è´å¯¹è±¡æœ¬èº«ï¼Œè¿˜æ‹·è´å®ƒå¼•ç”¨çš„æ‰€æœ‰å¯¹è±¡ã€‚
- æ–°å¯¹è±¡å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¼šå…±äº«å¼•ç”¨ã€‚

å®ç°æ–¹æ³•ï¼š

- æ‰‹å†™ `clone()`ï¼Œåœ¨é‡Œé¢é€’å½’å…‹éš†å¼•ç”¨å¯¹è±¡ã€‚
- æˆ–è€…é€šè¿‡åºåˆ—åŒ–/ååºåˆ—åŒ–å®ç°ã€‚

#### Javaä¸­åº”ç”¨

- `ArrayList.clone()`ï¼ˆæµ…æ‹·è´ï¼‰ã€‚

  `HashMap.clone()`ï¼ˆæµ…æ‹·è´ï¼‰ã€‚

- Java æä¾›äº† **`Cloneable` æ¥å£** + **`Object.clone()` æ–¹æ³•**ã€‚
- ä½†æ˜¯ï¼š
  - `Cloneable` æ˜¯ä¸€ä¸ª**æ ‡è®°æ¥å£**ï¼Œä¸å®šä¹‰æ–¹æ³•ã€‚
  - å¿…é¡»é‡å†™ `clone()` å¹¶è°ƒç”¨ `super.clone()`ã€‚
  - å¦åˆ™ä¼šæŠ›å‡º `CloneNotSupportedException`ã€‚

å¾ˆå¤šæ¡†æ¶ï¼ˆå¦‚ Springï¼‰æ›´æ¨è **æ‹·è´æ„é€ å‡½æ•° / å·¥å…·ç±»ï¼ˆå¦‚ Apache Commons Lang çš„ `SerializationUtils.clone()`ï¼‰** æ¥åšæ·±æ‹·è´ã€‚

## ç»“æ„å‹æ¨¡å¼

è§£å†³ **å¯¹è±¡å’Œç±»å¦‚ä½•ç»„åˆ** çš„é—®é¢˜ã€‚

### 6.é€‚é…å™¨æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†ä¸å…¼å®¹çš„æ¥å£è½¬æ¢ä¸ºå¯ç”¨æ¥å£ã€‚
 **ç»“æ„**ï¼šAdapter åŒ…è£… Adapteeã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šè€ä»£ç æ¥å£ä¸å…¼å®¹ã€‚
 **ä¼˜ç‚¹**ï¼šå¤ç”¨å·²æœ‰ç±»ã€‚
 **ç¼ºç‚¹**ï¼šç±»å±‚æ¬¡å¤æ‚åŒ–ã€‚
 **åº”ç”¨**ï¼š`InputStreamReader`ï¼ŒSpring MVC å‚æ•°é€‚é…å™¨ã€‚

1. ç±»é€‚é…å™¨ï¼ˆç»§æ‰¿ï¼‰

- `Adapter` ç»§æ‰¿ `Adaptee`ï¼Œå®ç° `Target` æ¥å£ã€‚

- é€šè¿‡ç»§æ‰¿è·å¾— `Adaptee` çš„åŠŸèƒ½ã€‚

2. ç»„åˆé€‚é…ï¼ˆæŒæœ‰å¼•ç”¨ï¼‰

- `Adapter` æŒæœ‰ `Adaptee` çš„å¼•ç”¨ï¼Œè½¬å‘è°ƒç”¨ã€‚
- æ›´çµæ´»ï¼ˆå¯ä»¥é€‚é…å¤šä¸ªä¸åŒçš„ `Adaptee`ï¼‰ã€‚

3. æ¥å£é€‚é…å™¨

- æä¾›ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•ä¸ºç©ºå®ç°ã€‚
- å­ç±»å¯ä»¥é€‰æ‹©æ€§åœ°é‡å†™éœ€è¦çš„æ–¹æ³•ã€‚
- å¸¸ç”¨äºå›è°ƒæ¥å£åœºæ™¯ï¼ˆæ¯”å¦‚ Java AWT/Swing çš„ç›‘å¬å™¨ï¼‰ã€‚

#### Javaä¸­çš„æ ‡å‡†é€‚é…å™¨

- [`java.util.Arrays#asList()`](https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList-T...-)
- [`java.util.Collections#list()`](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#list-java.util.Enumeration-)
- [`java.util.Collections#enumeration()`](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#enumeration-java.util.Collection-)
- [`java.io.InputStreamReader(InputStream)`](https://docs.oracle.com/javase/8/docs/api/java/io/InputStreamReader.html#InputStreamReader-java.io.InputStream-) ï¼ˆè¿”å› `Reader`å¯¹è±¡ï¼‰
- [`java.io.OutputStreamWriter(OutputStream)`](https://docs.oracle.com/javase/8/docs/api/java/io/OutputStreamWriter.html#OutputStreamWriter-java.io.OutputStream-) ï¼ˆè¿”å› `Writer`å¯¹è±¡ï¼‰
- [`javax.xml.bind.annotation.adapters.XmlAdapter#marshal()`](https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/XmlAdapter.html#marshal-BoundType-) å’Œ `#unmarshal()`

`java.util.Collections#list()`ä¸å®Œå…¨æ˜¯é€‚é…å™¨æ¨¡å¼ï¼Œè¦å®ç°é€‚é…å™¨æ¨¡å¼ç±»ä¼¼äºä»¥ä¸‹æ–¹å¼ï¼Œå°†Enumerationè½¬ä¸ºIterator

```java
class EnumerationIterator<T> implements Iterator<T> {
    private Enumeration<T> enumeration;

    public EnumerationIterator(Enumeration<T> enumeration) {
        this.enumeration = enumeration;
    }

    @Override
    public boolean hasNext() {
        return enumeration.hasMoreElements();
    }

    @Override
    public T next() {
        return enumeration.nextElement();
    }
}
```

#### javaçš„å®ç°ä¾‹å­

è®©æ–¹é’‰é€‚é…åœ†å­”

åœ†å­”ï¼š

```java
package refactoring_guru.adapter.example.round;

/**
 * RoundHoles are compatible with RoundPegs.
 */
public class RoundHole {
    private double radius;

    public RoundHole(double radius) {
        this.radius = radius;
    }

    public double getRadius() {
        return radius;
    }

    public boolean fits(RoundPeg peg) {
        boolean result;
        result = (this.getRadius() >= peg.getRadius());
        return result;
    }
}
```

åœ†é’‰ï¼š

```java
package refactoring_guru.adapter.example.round;

/**
 * RoundPegs are compatible with RoundHoles.
 */
public class RoundPeg {
    private double radius;

    public RoundPeg() {}

    public RoundPeg(double radius) {
        this.radius = radius;
    }

    public double getRadius() {
        return radius;
    }
}
```

æ–¹é’‰ï¼š

```java
package refactoring_guru.adapter.example.square;

/**
 * SquarePegs are not compatible with RoundHoles (they were implemented by
 * previous development team). But we have to integrate them into our program.
 */
public class SquarePeg {
    private double width;

    public SquarePeg(double width) {
        this.width = width;
    }

    public double getWidth() {
        return width;
    }

    public double getSquare() {
        double result;
        result = Math.pow(this.width, 2);
        return result;
    }
}
```
é€‚é…å™¨
```java
package refactoring_guru.adapter.example.adapters;

import refactoring_guru.adapter.example.round.RoundPeg;
import refactoring_guru.adapter.example.square.SquarePeg;

/**
 * Adapter allows fitting square pegs into round holes.
 */
public class SquarePegAdapter extends RoundPeg {
    private SquarePeg peg;

    public SquarePegAdapter(SquarePeg peg) {
        this.peg = peg;
    }

    @Override
    public double getRadius() {
        double result;
        // Calculate a minimum circle radius, which can fit this peg.
        result = (Math.sqrt(Math.pow((peg.getWidth() / 2), 2) * 2));
        return result;
    }
}

```
å®¢æˆ·ç«¯
```java
package refactoring_guru.adapter.example;

import refactoring_guru.adapter.example.adapters.SquarePegAdapter;
import refactoring_guru.adapter.example.round.RoundHole;
import refactoring_guru.adapter.example.round.RoundPeg;
import refactoring_guru.adapter.example.square.SquarePeg;

/**
 * Somewhere in client code...
 */
public class Demo {
    public static void main(String[] args) {
        // Round fits round, no surprise.
        RoundHole hole = new RoundHole(5);
        RoundPeg rpeg = new RoundPeg(5);
        if (hole.fits(rpeg)) {
            System.out.println("Round peg r5 fits round hole r5.");
        }

        SquarePeg smallSqPeg = new SquarePeg(2);
        SquarePeg largeSqPeg = new SquarePeg(20);
        // hole.fits(smallSqPeg); // Won't compile.

        // Adapter solves the problem.
        SquarePegAdapter smallSqPegAdapter = new SquarePegAdapter(smallSqPeg);
        SquarePegAdapter largeSqPegAdapter = new SquarePegAdapter(largeSqPeg);
        if (hole.fits(smallSqPegAdapter)) {
            System.out.println("Square peg w2 fits round hole r5.");
        }
        if (!hole.fits(largeSqPegAdapter)) {
            System.out.println("Square peg w20 does not fit into round hole r5.");
        }
    }
}
```

#### âœ… ä¼˜ç‚¹

- è§£è€¦ï¼šå®¢æˆ·ç«¯å’Œè¢«é€‚é…ç±»è§£è€¦ã€‚
- å¤ç”¨ï¼šå¤ç”¨å·²æœ‰åŠŸèƒ½ï¼Œæ— éœ€æ”¹æºç ã€‚
- çµæ´»ï¼šå¯¹è±¡é€‚é…å™¨æ–¹å¼æ”¯æŒç»„åˆå¤šä¸ªé€‚é…å¯¹è±¡ã€‚

#### âŒ ç¼ºç‚¹

- å¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ï¼Œå¤šäº†ä¸€å±‚è½¬æ¢ã€‚
- ç±»é€‚é…å™¨æ–¹å¼å—é™äºå•ç»§æ‰¿ã€‚

### 7.è£…é¥°å™¨æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šåœ¨ä¸ä¿®æ”¹å¯¹è±¡ä»£ç çš„å‰æä¸‹åŠ¨æ€æ·»åŠ åŠŸèƒ½ã€‚
 **ç»“æ„**ï¼šDecorator åŒ…å«è¢«è£…é¥°å¯¹è±¡ã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šå¤šå±‚åŠŸèƒ½å¢å¼ºã€‚
 **ä¼˜ç‚¹**ï¼šæ¯”ç»§æ‰¿æ›´çµæ´»ã€‚
 **ç¼ºç‚¹**ï¼šå¤šå±‚è£…é¥°ä¼šéš¾ä»¥è°ƒè¯•ã€‚
 **åº”ç”¨**ï¼šJava I/O æµã€‚

> åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡ç»“æ„çš„å‰æä¸‹ï¼ŒåŠ¨æ€åœ°ç»™å¯¹è±¡å¢åŠ æ–°çš„åŠŸèƒ½ã€‚

- å®ƒé€šè¿‡â€œåŒ…è£…â€ä¸€ä¸ªå¯¹è±¡æ¥å¢å¼ºåŠŸèƒ½ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ã€‚
- ä½¿ç”¨åŒä¸€ä¸ªæ¥å£ï¼Œä¿è¯å®¢æˆ·ç«¯æ— æ„ŸçŸ¥ã€‚

#### javaå®ç°ä¾‹å­

```
interface Component {
    void operation();
}

class ConcreteComponent implements Component {
    public void operation() {
        System.out.println("æ‰§è¡ŒåŸºæœ¬æ“ä½œ");
    }
}

```

æŠ½è±¡è£…é¥°å™¨

```
abstract class Decorator implements Component {
    protected Component component;

    public Decorator(Component component) {
        this.component = component;
    }

    @Override
    public void operation() {
        component.operation(); // é»˜è®¤è½¬å‘
    }
}

```

å…·ä½“è£…é¥°å™¨

```
class LoggingDecorator extends Decorator {
    public LoggingDecorator(Component component) {
        super(component);
    }

    @Override
    public void operation() {
        System.out.println("è®°å½•æ—¥å¿—...");
        super.operation();
    }
}

class SecurityDecorator extends Decorator {
    public SecurityDecorator(Component component) {
        super(component);
    }

    @Override
    public void operation() {
        System.out.println("æ£€æŸ¥æƒé™...");
        super.operation();
    }
}

```
å®¢æˆ·ç«¯ä½¿ç”¨

```java
public class Client {
    public static void main(String[] args) {
        Component c = new ConcreteComponent();

        // å¢å¼ºåŠŸèƒ½ï¼šå…ˆæƒé™æ£€æŸ¥ï¼Œå†æ—¥å¿—è®°å½•ï¼Œå†æ‰§è¡ŒåŸºæœ¬æ“ä½œ
        Component decorated = new LoggingDecorator(new SecurityDecorator(c));
        decorated.operation();
    }
}

```

#### ç°å®ä¾‹å­

**Java IO**

- `InputStream` æ˜¯æŠ½è±¡æ„ä»¶ã€‚

- `FileInputStream` æ˜¯å…·ä½“æ„ä»¶ã€‚

- `BufferedInputStream`ã€`DataInputStream`ã€`ZipInputStream` æ˜¯è£…é¥°å™¨ã€‚

- å®ƒä»¬å¯ä»¥å±‚å±‚åµŒå¥—ï¼š

  ```
  InputStream in = new BufferedInputStream(
                       new DataInputStream(
                           new FileInputStream("test.txt")));
  ```

**Spring**

- Spring AOP çš„ `BeanPostProcessor` æœ¬è´¨ä¸Šä¹Ÿæ˜¯è£…é¥°æ€æƒ³ï¼šåœ¨ Bean åˆå§‹åŒ–å‰ååŠ åŠŸèƒ½ã€‚

**GUI æ¡†æ¶**

- æ»šåŠ¨æ¡è£…é¥°å™¨ `ScrollBarDecorator` å¯ä»¥ç»™çª—å£åŠ¨æ€åŠ æ»šåŠ¨æ¡ã€‚

#### âœ… ä¼˜ç‚¹

- **æ‰©å±•æ€§å¼º**ï¼šä¸ä¿®æ”¹åŸæœ‰ç±»å°±èƒ½æ·»åŠ åŠŸèƒ½ã€‚
- **çµæ´»ç»„åˆ**ï¼šä¸åŒè£…é¥°å™¨å¯ä»¥ä»»æ„ç»„åˆã€‚
- **éµå¾ªå¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚

#### âŒ ç¼ºç‚¹

- å¯¹è±¡å±‚å±‚åŒ…è£…ï¼Œè°ƒè¯•æ—¶å¯èƒ½æ¯”è¾ƒå¤æ‚ã€‚
- è£…é¥°é“¾è¿‡é•¿æ—¶ï¼Œå¯èƒ½å½±å“æ€§èƒ½å’Œå¯è¯»æ€§ã€‚

### 8.ä»£ç†æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ã€‚
 **ç»“æ„**ï¼šProxy æŒæœ‰ RealSubjectã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šè¿œç¨‹ä»£ç†ã€å®‰å…¨ä»£ç†ã€å»¶è¿ŸåŠ è½½ã€‚
 **ä¼˜ç‚¹**ï¼šæ§åˆ¶è®¿é—®ã€å¢å¼ºåŠŸèƒ½ã€‚
 **ç¼ºç‚¹**ï¼šå¢åŠ å±‚çº§ï¼Œå¯èƒ½å½±å“æ€§èƒ½ã€‚
 **åº”ç”¨**ï¼šSpring AOPã€JDK åŠ¨æ€ä»£ç†ã€‚

å®šä¹‰æ¥å£

```
interface Subject {
    void request();
}

```



çœŸå®ä¸»é¢˜

```
class RealSubject implements Subject {
    @Override
    public void request() {
        System.out.println("æ‰§è¡ŒçœŸå®è¯·æ±‚");
    }
}

```





ä»£ç†ä¸»é¢˜

```
class Proxy implements Subject {
    private RealSubject realSubject;

    @Override
    public void request() {
        // å¯ä»¥åšæƒé™æ§åˆ¶
        System.out.println("æ£€æŸ¥æƒé™...");

        // å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆæ‡’åŠ è½½ï¼‰
        if (realSubject == null) {
            realSubject = new RealSubject();
        }

        // è°ƒç”¨çœŸå®å¯¹è±¡
        realSubject.request();

        // å¯ä»¥åšæ—¥å¿—
        System.out.println("è®°å½•æ—¥å¿—...");
    }
}

```



å®¢æˆ·ç«¯

```
public class Client {
    public static void main(String[] args) {
        Subject proxy = new Proxy();
        proxy.request();
    }
}

```

#### ä»£ç†æ¨¡å¼ç±»å‹

1. é™æ€ä»£ç†

ç¼–è¯‘æœŸå°±å†™æ­»äº†ä»£ç†ç±»ã€‚

ç¼ºç‚¹ï¼šå¦‚æœæ¥å£å¾ˆå¤šï¼Œéœ€è¦å†™å¾ˆå¤šä»£ç†ç±»ã€‚

2. åŠ¨æ€ä»£ç†

- **JDK åŠ¨æ€ä»£ç†**ï¼šåŸºäº `InvocationHandler` + åå°„ï¼Œè¦æ±‚è¢«ä»£ç†å¯¹è±¡å¿…é¡»å®ç°æ¥å£ã€‚
- **CGLIB åŠ¨æ€ä»£ç†**ï¼šåŸºäºå­—èŠ‚ç ç”Ÿæˆï¼Œå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ã€‚

 Spring AOP å°±æ˜¯åŸºäº **åŠ¨æ€ä»£ç†** å®ç°çš„ã€‚

#### âœ… **ä¼˜ç‚¹**

- æ§åˆ¶è®¿é—®ï¼šéš”ç¦»å®¢æˆ·ç«¯ä¸çœŸå®å¯¹è±¡ã€‚
- å¯æ‰©å±•ï¼šä»£ç†å¯åœ¨ä¸ä¿®æ”¹çœŸå®å¯¹è±¡çš„å‰æä¸‹å¢å¼ºåŠŸèƒ½ã€‚
- æé«˜çµæ´»æ€§ï¼šæ”¯æŒè¿œç¨‹è°ƒç”¨ã€æ‡’åŠ è½½ç­‰æ¨¡å¼ã€‚

#### âŒ **ç¼ºç‚¹**

- å¯èƒ½å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚
- åŠ¨æ€ä»£ç†å¯èƒ½å½±å“æ€§èƒ½ï¼ˆå°¤å…¶æ˜¯åå°„å’Œå­—èŠ‚ç ç”Ÿæˆï¼‰ã€‚

### 9.å¤–è§‚æ¨¡å¼

å­ç³»ç»Ÿ

```
// ç”µè§†
class TV {
    public void on() {
        System.out.println("TV is on");
    }
    public void off() {
        System.out.println("TV is off");
    }
}

// éŸ³å“
class SoundSystem {
    public void on() {
        System.out.println("Sound system is on");
    }
    public void off() {
        System.out.println("Sound system is off");
    }
    public void setVolume(int volume) {
        System.out.println("Setting volume to " + volume);
    }
}

// DVD æ’­æ”¾å™¨
class DVDPlayer {
    public void on() {
        System.out.println("DVD player is on");
    }
    public void off() {
        System.out.println("DVD player is off");
    }
    public void playMovie(String movie) {
        System.out.println("Playing movie: " + movie);
    }
}
```

å¤–è§‚

```
// å¤–è§‚ç±»
public class HomeTheaterFacade {
    private TV tv;
    private SoundSystem soundSystem;
    private DVDPlayer dvdPlayer;

    public HomeTheaterFacade() {
        this.tv = new TV();
        this.soundSystem = new SoundSystem();
        this.dvdPlayer = new DVDPlayer();
    }

    // ç”µå½±æ¨¡å¼ï¼šä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼ŒèƒŒåæ‰§è¡Œä¸€ç³»åˆ—å¤æ‚æ“ä½œ
    public void watchMovie(String movie) {
        System.out.println("å‡†å¤‡è¿›å…¥ç”µå½±æ¨¡å¼...");
        tv.on();
        soundSystem.on();
        soundSystem.setVolume(15);
        dvdPlayer.on();
        dvdPlayer.playMovie(movie);
        System.out.println("ç”µå½±æ¨¡å¼å‡†å¤‡å°±ç»ªï¼");
    }

    // ç»“æŸæ¨¡å¼ï¼šå¦ä¸€ä¸ªç®€å•çš„æ–¹æ³•
    public void endMovie() {
        System.out.println("å‡†å¤‡é€€å‡ºç”µå½±æ¨¡å¼...");
        dvdPlayer.off();
        soundSystem.off();
        tv.off();
        System.out.println("æ‰€æœ‰è®¾å¤‡å·²å…³é—­ã€‚");
    }
}
```

å®¢æˆ·ç«¯

```
// å®¢æˆ·ç«¯
public class Client {
    public static void main(String[] args) {
        // åˆ›å»ºå¤–è§‚å¯¹è±¡ï¼Œå®¢æˆ·ç«¯æ— éœ€å…³å¿ƒå­ç³»ç»Ÿçš„å¤æ‚æ€§
        HomeTheaterFacade homeTheater = new HomeTheaterFacade();

        // å®¢æˆ·ç«¯åªéœ€è°ƒç”¨ä¸€ä¸ªç®€å•çš„æ–¹æ³•
        homeTheater.watchMovie("The Matrix");

        System.out.println("\n----------------\n");

        homeTheater.endMovie();
    }
}
```

**Spring æ¡†æ¶**

- `JdbcTemplate`ã€`RedisTemplate`ã€`RestTemplate` å°±æ˜¯å¤–è§‚æ¨¡å¼çš„åº”ç”¨ï¼š
   å®ƒä»¬å¯¹å¤æ‚çš„æ•°æ®åº“æ“ä½œã€Redis æ“ä½œã€HTTP è°ƒç”¨è¿›è¡Œäº†å°è£…ï¼Œå®¢æˆ·ç«¯åªéœ€è°ƒç”¨ç®€å•æ–¹æ³•ã€‚

**æ—¥å¿—æ¡†æ¶ï¼ˆSLF4Jï¼‰**

- `LoggerFactory.getLogger()` å°±æ˜¯å¤–è§‚ï¼Œåº•å±‚å¯èƒ½æ˜¯ Logbackã€Log4jï¼Œä½†å®¢æˆ·ç«¯åªä¾èµ–ç»Ÿä¸€æ¥å£ã€‚

**ç”µè„‘å¼€æœº**

- æŒ‰ä¸‹ç”µæºé”®ï¼ˆFacadeï¼‰ â†’ è°ƒç”¨ CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰å­ç³»ç»Ÿã€‚

**API Gatewayï¼ˆå¾®æœåŠ¡ç½‘å…³ï¼‰**

- å¤–éƒ¨ç³»ç»Ÿåªè°ƒç”¨ç½‘å…³ï¼Œç½‘å…³å†å»è°ƒåº¦å¤šä¸ªå¾®æœåŠ¡ã€‚

#### âœ… ä¼˜ç‚¹

- **ç®€åŒ–è°ƒç”¨**ï¼šå±è”½å¤æ‚æ€§ï¼Œè®©å®¢æˆ·ç«¯æ›´å®¹æ˜“ä½¿ç”¨ç³»ç»Ÿã€‚
- **é™ä½è€¦åˆ**ï¼šå®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿè§£è€¦ï¼Œåªä¾èµ– Facadeã€‚
- **æ›´å®‰å…¨**ï¼šå¤–è§‚ç±»å¯ä»¥æ§åˆ¶å®¢æˆ·ç«¯è®¿é—®çš„å­ç³»ç»ŸèŒƒå›´ã€‚

#### âŒ ç¼ºç‚¹

- å¯èƒ½æˆä¸ºâ€œä¸Šå¸ç±»â€ï¼ŒèŒè´£è¿‡å¤šã€‚
- å¢åŠ äº†ä¸€å±‚é—´æ¥è°ƒç”¨ï¼Œçµæ´»æ€§é™ä½ï¼ˆå®¢æˆ·ç«¯æ— æ³•è®¿é—®åˆ°å­ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ï¼‰ã€‚

### 10.æ¡¥æ¥æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼Œè§£å†³ç»„åˆçˆ†ç‚¸é—®é¢˜ã€‚
 **ç»“æ„**ï¼šAbstraction æŒæœ‰ Implementorã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šå¤šç»´åº¦æ‰©å±•ï¼ˆé¢œè‰²+å½¢çŠ¶ï¼‰ã€‚
 **ä¼˜ç‚¹**ï¼šé¿å…ç±»çˆ†ç‚¸ã€‚
 **ç¼ºç‚¹**ï¼šå¢åŠ æŠ½è±¡å±‚ã€‚
 **åº”ç”¨**ï¼šJDBC æ¥å£ + é©±åŠ¨å®ç°ã€‚

å…·ä½“å®ç°

```
// å®ç°è€…æ¥å£ï¼šå®šä¹‰æ¶ˆæ¯å‘é€æ–¹å¼
interface MessageSender {
    void sendMessage(String message);
}

// å…·ä½“å®ç°è€…ï¼šé‚®ä»¶å‘é€
class EmailMessageSender implements MessageSender {
    @Override
    public void sendMessage(String message) {
        System.out.println("é€šè¿‡é‚®ä»¶å‘é€æ¶ˆæ¯: " + message);
    }
}

// å…·ä½“å®ç°è€…ï¼šçŸ­ä¿¡å‘é€
class SMSMessageSender implements MessageSender {
    @Override
    public void sendMessage(String message) {
        System.out.println("é€šè¿‡çŸ­ä¿¡å‘é€æ¶ˆæ¯: " + message);
    }
}
```

æŠ½è±¡å±‚

```
// æŠ½è±¡ç±»ï¼šå®šä¹‰æ¶ˆæ¯ç±»å‹
abstract class Message {
    protected MessageSender sender;

    public Message(MessageSender sender) {
        this.sender = sender;
    }

    // æŠ½è±¡æ–¹æ³•ï¼Œç•™ç»™å­ç±»å®ç°
    public abstract void send(String text);
}

// ç»†åŒ–æŠ½è±¡ï¼šæ™®é€šæ¶ˆæ¯
class NormalMessage extends Message {
    public NormalMessage(MessageSender sender) {
        super(sender);
    }

    @Override
    public void send(String text) {
        // æ™®é€šæ¶ˆæ¯ç›´æ¥å‘é€
        sender.sendMessage(text);
    }
}

// ç»†åŒ–æŠ½è±¡ï¼šåŠ æ€¥æ¶ˆæ¯
class UrgentMessage extends Message {
    public UrgentMessage(MessageSender sender) {
        super(sender);
    }

    @Override
    public void send(String text) {
        // åŠ æ€¥æ¶ˆæ¯å¯ä»¥æ·»åŠ é¢å¤–çš„å¤„ç†é€»è¾‘
        text = "åŠ æ€¥ï¼š" + text;
        sender.sendMessage(text);
    }
}
```

å®¢æˆ·ç«¯

```
public class Client {
    public static void main(String[] args) {
        // æ¡¥æ¥ï¼šæ™®é€šæ¶ˆæ¯ + é‚®ä»¶å‘é€
        Message normalMessage = new NormalMessage(new EmailMessageSender());
        normalMessage.send("è¿™æ˜¯ä¸€æ¡æ™®é€šæ¶ˆæ¯ã€‚");

        // æ¡¥æ¥ï¼šåŠ æ€¥æ¶ˆæ¯ + çŸ­ä¿¡å‘é€
        Message urgentMessage = new UrgentMessage(new SMSMessageSender());
        urgentMessage.send("è¿™æ˜¯ä¸€æ¡åŠ æ€¥æ¶ˆæ¯ã€‚");
    }
}
```

#### âœ… ä¼˜ç‚¹

- é¿å…ç±»çˆ†ç‚¸ï¼Œé™ä½ç»§æ‰¿å±‚æ¬¡ã€‚
- æŠ½è±¡ä¸å®ç°å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œäº’ä¸å½±å“ã€‚
- ç¬¦åˆå¼€é—­åŸåˆ™ã€‚

#### âŒ ç¼ºç‚¹

- å¢åŠ äº†ç³»ç»Ÿå¤æ‚æ€§ï¼ˆè¦å¤šè®¾è®¡ä¸€å±‚ Implementorï¼‰ã€‚
- é€‚åˆå˜åŒ–ç»´åº¦æ˜æ˜¾çš„åœºæ™¯ï¼Œä¸é€‚åˆå•ä¸€ç»´åº¦ç³»ç»Ÿã€‚





### 11.ç»„åˆæ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ï¼Œä½¿ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ä½¿ç”¨ä¸€è‡´æ¥å£ã€‚
 **ç»“æ„**ï¼šComponent â†’ Leaf / Compositeã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šå±‚æ¬¡ç»“æ„ï¼ˆæ–‡ä»¶å¤¹/æ–‡ä»¶ï¼‰ã€‚
 **ä¼˜ç‚¹**ï¼šä¸€è‡´æ€§æ“ä½œã€‚
 **ç¼ºç‚¹**ï¼šéš¾ä»¥é™åˆ¶ç»„åˆå±‚æ¬¡ã€‚
 **åº”ç”¨**ï¼šSwing ç»„ä»¶æ ‘ã€XML DOMã€‚

æŠ½è±¡ç»„ä»¶

```java
interface FileSystemNode {
    void show();
}
```

å¶å­èŠ‚ç‚¹

```java
class FileNode implements FileSystemNode {
    private String name;

    public FileNode(String name) {
        this.name = name;
    }

    @Override
    public void show() {
        System.out.println("æ–‡ä»¶: " + name);
    }
}

```

å®¹å™¨èŠ‚ç‚¹

```java
import java.util.ArrayList;
import java.util.List;

class DirectoryNode implements FileSystemNode {
    private String name;
    private List<FileSystemNode> children = new ArrayList<>();

    public DirectoryNode(String name) {
        this.name = name;
    }

    public void add(FileSystemNode node) {
        children.add(node);
    }

    @Override
    public void show() {
        System.out.println("ç›®å½•: " + name);
        for (FileSystemNode child : children) {
            child.show();
        }
    }
}

```

å®¢æˆ·ç«¯

```java
public class Client {
    public static void main(String[] args) {
        FileSystemNode file1 = new FileNode("a.txt");
        FileSystemNode file2 = new FileNode("b.txt");

        DirectoryNode folder = new DirectoryNode("docs");
        folder.add(file1);
        folder.add(file2);

        DirectoryNode root = new DirectoryNode("root");
        root.add(folder);
        root.add(new FileNode("c.txt"));

        root.show();
    }
}

```

**æ–‡ä»¶ç³»ç»Ÿ**

- æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ç»Ÿä¸€çœ‹ä½œâ€œèŠ‚ç‚¹â€ã€‚

**ç»„ç»‡æ¶æ„**

- å‘˜å·¥ï¼ˆLeafï¼‰å’Œéƒ¨é—¨ï¼ˆCompositeï¼‰éƒ½å®ç° `OrganizationUnit` æ¥å£ã€‚

**èœå•ç³»ç»Ÿï¼ˆGUIï¼‰**

- èœå•é¡¹ï¼ˆLeafï¼‰å’Œå­èœå•ï¼ˆCompositeï¼‰ç»Ÿä¸€å¤„ç†ã€‚

**å›¾å½¢ç»˜åˆ¶ç³»ç»Ÿ**

- çº¿æ®µã€åœ†å½¢ï¼ˆLeafï¼‰ï¼Œç»„åˆå›¾å½¢ï¼ˆCompositeï¼‰ã€‚

#### âœ… ä¼˜ç‚¹

- **ç»Ÿä¸€æ€§**ï¼šå®¢æˆ·ç«¯å¯ä»¥ç»Ÿä¸€å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚
- **æ‰©å±•æ€§å¼º**ï¼šæ–°å¢å¶å­èŠ‚ç‚¹æˆ–ç»„åˆèŠ‚ç‚¹æ—¶ï¼Œä¸å½±å“å·²æœ‰ä»£ç ã€‚
- **å±‚æ¬¡ç»“æ„æ¸…æ™°**ï¼šå¤©ç„¶é€‚åˆæ ‘å½¢æ•°æ®è¡¨ç¤ºã€‚

#### âŒ ç¼ºç‚¹

- ç³»ç»Ÿä¼šäº§ç”Ÿè¿‡å¤šçš„ç»†ç²’åº¦å¯¹è±¡ï¼ˆèŠ‚ç‚¹å¤šæ—¶å†…å­˜å ç”¨é«˜ï¼‰ã€‚
- æ§åˆ¶ç²’åº¦å¯èƒ½å˜å¼±ï¼ˆæ¯”å¦‚æœ‰äº›æ–¹æ³•åªé€‚ç”¨äºå¶å­ï¼Œä½†æ¥å£ç»Ÿä¸€åå®¹æ˜“è¢«è¯¯ç”¨ï¼‰ã€‚



### 12.äº«å…ƒæ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå…±äº«å¯¹è±¡ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚
 **ç»“æ„**ï¼šFlyweightFactory ç®¡ç†å…±äº«å¯¹è±¡ã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šå¤§é‡ç»†ç²’åº¦å¯¹è±¡ï¼ˆå­—ç¬¦ã€æ£‹å­ï¼‰ã€‚
 **ä¼˜ç‚¹**ï¼šèŠ‚çœå†…å­˜ã€‚
 **ç¼ºç‚¹**ï¼šé€»è¾‘å¤æ‚åŒ–ã€‚
 **åº”ç”¨**ï¼š`Integer.valueOf()` ç¼“å­˜ï¼ŒJVM å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚

æŠ½è±¡äº«å…ƒ

```java
interface Flyweight {
    void operation(String extrinsicState);
}

```

å…·ä½“äº«å…ƒ

```java
class ConcreteFlyweight implements Flyweight {
    private final String intrinsicState; // å†…éƒ¨çŠ¶æ€ï¼ˆå…±äº«ï¼‰

    public ConcreteFlyweight(String intrinsicState) {
        this.intrinsicState = intrinsicState;
    }

    @Override
    public void operation(String extrinsicState) {
        System.out.println("å†…éƒ¨çŠ¶æ€: " + intrinsicState + "ï¼Œå¤–éƒ¨çŠ¶æ€: " + extrinsicState);
    }
}

```

äº«å…ƒå·¥å‚

```java
import java.util.HashMap;
import java.util.Map;

class FlyweightFactory {
    private final Map<String, Flyweight> pool = new HashMap<>();

    public Flyweight getFlyweight(String key) {
        if (!pool.containsKey(key)) {
            pool.put(key, new ConcreteFlyweight(key));
        }
        return pool.get(key);
    }

    public int poolSize() {
        return pool.size();
    }
}

```

å®¢æˆ·ç«¯

```java
public class Client {
    public static void main(String[] args) {
        FlyweightFactory factory = new FlyweightFactory();

        Flyweight f1 = factory.getFlyweight("A");
        Flyweight f2 = factory.getFlyweight("A");
        Flyweight f3 = factory.getFlyweight("B");

        f1.operation("ä½ç½®1");
        f2.operation("ä½ç½®2");
        f3.operation("ä½ç½®3");

        System.out.println("äº«å…ƒæ± å¤§å°: " + factory.poolSize());
    }
}

```





**Java String å¸¸é‡æ± **

- `"abc"` å­—ç¬¦ä¸²å­—é¢é‡ä¼šè¢«æ”¾å…¥å¸¸é‡æ± ï¼Œå¤ç”¨ç›¸åŒå­—ç¬¦ä¸²å¯¹è±¡ã€‚

**Java Integer ç¼“å­˜**

- `Integer.valueOf(127)` æ€»æ˜¯è¿”å›ç¼“å­˜å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºã€‚

**æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± **

- èµ„æºå¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ã€‚

**å­—ä½“æ¸²æŸ“ã€å›¾æ ‡ç¼“å­˜**

- æ–‡æœ¬ç¼–è¾‘å™¨ä¸­é‡å¤å‡ºç°çš„å­—ç¬¦ã€å›¾æ ‡åªåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä½ç½®ä½œä¸ºå¤–éƒ¨çŠ¶æ€ã€‚

**æ¸¸æˆå¯¹è±¡**

- å­å¼¹ã€æ ‘æœ¨ã€è‰åœ°ç­‰å¤§é‡ç›¸åŒå¯¹è±¡å¯ä»¥å¤ç”¨ã€‚

#### âœ… ä¼˜ç‚¹

- å¤§å¤§å‡å°‘å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡ï¼Œæå‡æ€§èƒ½ã€‚
- å…±äº«å¯¹è±¡æ›´å®¹æ˜“é›†ä¸­ç®¡ç†ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºã€‚

#### âŒ ç¼ºç‚¹

- å¼•å…¥äº†åŒºåˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€çš„å¤æ‚æ€§ã€‚
- å¤–éƒ¨çŠ¶æ€éœ€è¦ç”±å®¢æˆ·ç«¯ç»´æŠ¤ï¼Œå¢åŠ äº†ä½¿ç”¨æˆæœ¬ã€‚
- è¿‡åº¦ä½¿ç”¨å¯èƒ½å¯¼è‡´ç³»ç»Ÿç»“æ„ä¸æ¸…æ™°ã€‚



## è¡Œä¸ºå‹æ¨¡å¼



### è§‚å¯Ÿè€…æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå¯¹è±¡çŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰ä¾èµ–è€…ã€‚
 **ç»“æ„**ï¼šSubject + Observerã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šäº‹ä»¶è®¢é˜…ã€‚
 **ä¼˜ç‚¹**ï¼šè§£è€¦å‘å¸ƒä¸è®¢é˜…ã€‚
 **ç¼ºç‚¹**ï¼šé“¾å¼é€šçŸ¥å¯èƒ½å½±å“æ€§èƒ½ã€‚
 **åº”ç”¨**ï¼šJava `Observer`ï¼ŒGUI äº‹ä»¶ç›‘å¬ã€‚

åŸºç¡€å‘å¸ƒè€…

```java
package refactoring_guru.observer.example.publisher;

import refactoring_guru.observer.example.listeners.EventListener;

import java.io.File;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class EventManager {
    Map<String, List<EventListener>> listeners = new HashMap<>();

    public EventManager(String... operations) {
        for (String operation : operations) {
            this.listeners.put(operation, new ArrayList<>());
        }
    }

    public void subscribe(String eventType, EventListener listener) {
        List<EventListener> users = listeners.get(eventType);
        users.add(listener);
    }

    public void unsubscribe(String eventType, EventListener listener) {
        List<EventListener> users = listeners.get(eventType);
        users.remove(listener);
    }

    public void notify(String eventType, File file) {
        List<EventListener> users = listeners.get(eventType);
        for (EventListener listener : users) {
            listener.update(eventType, file);
        }
    }
}
```

å…·ä½“å‘å¸ƒè€…

```java
package refactoring_guru.observer.example.editor;

import refactoring_guru.observer.example.publisher.EventManager;

import java.io.File;

public class Editor {
    public EventManager events;
    private File file;

    public Editor() {
        this.events = new EventManager("open", "save");
    }

    public void openFile(String filePath) {
        this.file = new File(filePath);
        events.notify("open", file);
    }

    public void saveFile() throws Exception {
        if (this.file != null) {
            events.notify("save", file);
        } else {
            throw new Exception("Please open a file first.");
        }
    }
}
```

#### âœ… ä¼˜ç‚¹

- **è§£è€¦**ï¼šä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´æ˜¯æŠ½è±¡ä¾èµ–ï¼Œä¸ç›´æ¥è€¦åˆã€‚
- **çµæ´»æ‰©å±•**ï¼šå¢åŠ æ–°çš„è§‚å¯Ÿè€…æ— éœ€ä¿®æ”¹ä¸»é¢˜ä»£ç ã€‚
- **æ”¯æŒå¹¿æ’­é€šä¿¡**ï¼šä¸€ä¸ªäº‹ä»¶å¯ä»¥é€šçŸ¥å¤šä¸ªå¯¹è±¡ã€‚

#### âŒ ç¼ºç‚¹

- **æ€§èƒ½é—®é¢˜**ï¼šè§‚å¯Ÿè€…æ•°é‡å¤šæ—¶ï¼Œé€šçŸ¥ä¼šå¾ˆè€—æ—¶ã€‚
- **é€šçŸ¥é“¾å¤æ‚**ï¼šè‹¥è§‚å¯Ÿè€…ä¹‹é—´æœ‰ä¾èµ–ï¼Œå¯èƒ½å¼•å‘çº§è”æ›´æ–°ï¼Œéš¾ä»¥è°ƒè¯•ã€‚
- **å†…å­˜æ³„æ¼é£é™©**ï¼šå¦‚æœè§‚å¯Ÿè€…å¿˜è®°ç§»é™¤å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚

### ç­–ç•¥æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå°è£…ä¸€ç³»åˆ—ç®—æ³•ï¼Œä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚
 **ç»“æ„**ï¼šContext + Strategyã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šä¸åŒç®—æ³•å¯æ›¿æ¢ã€‚
 **ä¼˜ç‚¹**ï¼šé¿å…å¤§é‡ `if-else`ã€‚
 **ç¼ºç‚¹**ï¼šå®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰ç­–ç•¥ã€‚
 **åº”ç”¨**ï¼šæ”¯ä»˜æ–¹å¼é€‰æ‹©ã€‚

> å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ï¼Œå°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œè®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯ã€‚

ğŸ“Œ ç®€å•è¯´ï¼š

- **æŠŠ if-else/switch æ‹†å‡ºæ¥**ï¼Œå°è£…æˆå¯æ›¿æ¢çš„ç­–ç•¥ç±»ã€‚
- å®¢æˆ·ç«¯åªä¾èµ–æŠ½è±¡ç­–ç•¥ï¼Œå…·ä½“å®ç°ç”±å¤–éƒ¨æ³¨å…¥ã€‚



ç¯å¢ƒç±»

```java
class PayContext {
    private PayStrategy strategy;

    public PayContext(PayStrategy strategy) {
        this.strategy = strategy;
    }

    public void setStrategy(PayStrategy strategy) {
        this.strategy = strategy;
    }

    public void execute(double amount) {
        strategy.pay(amount);
    }
}

```



ç­–ç•¥æ¥å£

```java
interface PayStrategy {
    void pay(double amount);
}

```



å…·ä½“ç­–ç•¥ç±»

```java
class AliPay implements PayStrategy {
    @Override
    public void pay(double amount) {
        System.out.println("ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ï¼š" + amount + " å…ƒ");
    }
}

class WeChatPay implements PayStrategy {
    @Override
    public void pay(double amount) {
        System.out.println("ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ï¼š" + amount + " å…ƒ");
    }
}

class CreditCardPay implements PayStrategy {
    @Override
    public void pay(double amount) {
        System.out.println("ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ï¼š" + amount + " å…ƒ");
    }
}

```



å®¢æˆ·ç«¯

```java
public class Client {
    public static void main(String[] args) {
        PayContext context = new PayContext(new AliPay());
        context.execute(100);

        context.setStrategy(new WeChatPay());
        context.execute(200);

        context.setStrategy(new CreditCardPay());
        context.execute(300);
    }
}

```

Java 8 å¼€å§‹æ”¯æŒ lambda æ–¹æ³•ï¼Œ å®ƒå¯ä½œä¸ºä¸€ç§æ›¿ä»£ç­–ç•¥æ¨¡å¼çš„ç®€å•æ–¹å¼ã€‚

è¿™é‡Œæœ‰ä¸€äº›æ ¸å¿ƒ Java ç¨‹åºåº“ä¸­ç­–ç•¥æ¨¡å¼çš„ç¤ºä¾‹ï¼š

- å¯¹ [`java.util.Comparator#compare()`](http://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html#compare-T-T-) çš„è°ƒç”¨æ¥è‡ª `Collections#sort()`.
- [`javax.servlet.http.HttpServlet`](http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServlet.html)ï¼š  `serviceÂ­()`æ–¹æ³•ï¼Œ è¿˜æœ‰æ‰€æœ‰æ¥å— `HttpÂ­ServletÂ­Request`å’Œ `HttpÂ­ServletÂ­Response`å¯¹è±¡ä½œä¸ºå‚æ•°çš„ `doÂ­XXX()`æ–¹æ³•ã€‚
- [`javax.servlet.Filter#doFilter()`](http://docs.oracle.com/javaee/7/api/javax/servlet/Filter.html#doFilter-javax.servlet.ServletRequest-javax.servlet.ServletResponse-javax.servlet.FilterChain-)

#### âœ… ä¼˜ç‚¹

- éµå¾ª **å¼€é—­åŸåˆ™**ï¼šæ–°å¢ç­–ç•¥ä¸éœ€è¦æ”¹ Contextã€‚
- é¿å…å¤§é‡ if-elseã€‚
- ç®—æ³•å¯è‡ªç”±åˆ‡æ¢ï¼Œçµæ´»æ€§é«˜ã€‚
- ç­–ç•¥ç±»å¯ä»¥å¤ç”¨ã€‚

#### âŒ ç¼ºç‚¹

- ä¼šå¢åŠ ç±»çš„æ•°é‡ï¼Œæ¯ä¸ªç­–ç•¥éƒ½æ˜¯ä¸€ä¸ªç±»ã€‚
- å®¢æˆ·ç«¯å¿…é¡»äº†è§£ä¸åŒç­–ç•¥çš„åŒºåˆ«ï¼Œæ‰èƒ½æ­£ç¡®é€‰æ‹©ã€‚
- å¦‚æœç­–ç•¥è¿‡å¤šï¼Œç»´æŠ¤æˆæœ¬å¯èƒ½å˜é«˜ã€‚

### è´£ä»»é“¾æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå¤šä¸ªå¯¹è±¡ä¾æ¬¡å¤„ç†è¯·æ±‚ï¼Œç›´åˆ°è¢«å¤„ç†ã€‚
 **ç»“æ„**ï¼šHandler é“¾ã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šè¯·æ±‚è¿‡æ»¤ã€æ‹¦æˆªå™¨ã€‚
 **ä¼˜ç‚¹**ï¼šè§£è€¦è¯·æ±‚ä¸å¤„ç†è€…ã€‚
 **ç¼ºç‚¹**ï¼šè°ƒè¯•å›°éš¾ï¼Œå¯èƒ½æ— äººå¤„ç†è¯·æ±‚ã€‚
 **åº”ç”¨**ï¼šServlet è¿‡æ»¤å™¨é“¾ï¼Œæ—¥å¿—æ¡†æ¶ã€‚

1. **Handlerï¼ˆæŠ½è±¡å¤„ç†è€…ï¼‰**

```java
abstract class Approver {
    protected Approver next;  // ä¸‹ä¸€ä¸ªå¤„ç†è€…
    protected String name;

    public Approver(String name) {
        this.name = name;
    }

    public void setNext(Approver next) {
        this.next = next;
    }

    public abstract void approve(int days);
}

```



2. **ConcreteHandlerï¼ˆå…·ä½“å¤„ç†è€…ï¼‰**

   ```java
   class TeamLeader extends Approver {
       public TeamLeader(String name) { super(name); }
   
       @Override
       public void approve(int days) {
           if (days <= 1) {
               System.out.println(name + " æ‰¹å‡†äº† " + days + " å¤©å‡");
           } else if (next != null) {
               next.approve(days);
           }
       }
   }
   
   class Manager extends Approver {
       public Manager(String name) { super(name); }
   
       @Override
       public void approve(int days) {
           if (days <= 3) {
               System.out.println(name + " æ‰¹å‡†äº† " + days + " å¤©å‡");
           } else if (next != null) {
               next.approve(days);
           }
       }
   }
   
   class Director extends Approver {
       public Director(String name) { super(name); }
   
       @Override
       public void approve(int days) {
           if (days <= 7) {
               System.out.println(name + " æ‰¹å‡†äº† " + days + " å¤©å‡");
           } else if (next != null) {
               next.approve(days);
           }
       }
   }
   
   class CEO extends Approver {
       public CEO(String name) { super(name); }
   
       @Override
       public void approve(int days) {
           System.out.println(name + " æ‰¹å‡†äº† " + days + " å¤©å‡");
       }
   }
   
   ```

   

3. **Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**

```java
public class Client {
    public static void main(String[] args) {
        // æ„å»ºè´£ä»»é“¾
        Approver leader = new TeamLeader("ç»„é•¿");
        Approver manager = new Manager("ç»ç†");
        Approver director = new Director("æ€»ç›‘");
        Approver ceo = new CEO("CEO");

        leader.setNext(manager);
        manager.setNext(director);
        director.setNext(ceo);

        // å‘èµ·è¯·æ±‚
        leader.approve(1);
        leader.approve(3);
        leader.approve(5);
        leader.approve(10);
    }
}

```

**Java Servlet Filterï¼ˆè¿‡æ»¤å™¨é“¾ï¼‰**

- è¯·æ±‚ç»è¿‡ä¸€ç³»åˆ— Filterï¼ˆç¼–ç è¿‡æ»¤å™¨ã€æƒé™è¿‡æ»¤å™¨ã€æ—¥å¿—è¿‡æ»¤å™¨ï¼‰ã€‚
- æ¯ä¸ª Filter è¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆä¼ é€’ã€‚
- [`javax.servlet.Filter#doFilter()`](http://docs.oracle.com/javaee/7/api/javax/servlet/Filter.html#doFilter-javax.servlet.ServletRequest-javax.servlet.ServletResponse-javax.servlet.FilterChain-)

**Spring AOP æ‹¦æˆªå™¨é“¾**

- å¤šä¸ªåˆ‡é¢ï¼ˆäº‹åŠ¡ã€æ—¥å¿—ã€å®‰å…¨ï¼‰ä¾æ¬¡æ‰§è¡Œã€‚

**æ—¥å¿—å¤„ç†**

- DEBUG â†’ INFO â†’ WARN â†’ ERROR å¤šçº§æ—¥å¿—è®°å½•å™¨ã€‚
- [`java.util.logging.Logger#log()`](http://docs.oracle.com/javase/8/docs/api/java/util/logging/Logger.html#log-java.util.logging.Level-java.lang.String-)

**å®¡æ‰¹æµç¨‹ã€å·¥ä½œæµå¼•æ“**

- å¸¸è§äº OA ç³»ç»Ÿã€è¯·å‡å®¡æ‰¹ã€è´¹ç”¨æŠ¥é”€ã€‚

#### âœ…  ä¼˜ç‚¹

- éµå¾ª **å¼€é—­åŸåˆ™**ï¼šæ–°å¢å¤„ç†è€…åªéœ€è¦åŠ ç±»ï¼Œä¸å½±å“ç°æœ‰é€»è¾‘ã€‚
- è¯·æ±‚å’Œå¤„ç†é€»è¾‘è§£è€¦ï¼Œçµæ´»æ€§é«˜ã€‚
- å¯ä»¥åŠ¨æ€ç»„åˆå¤„ç†é“¾ã€‚

#### âŒ ç¼ºç‚¹

- å¦‚æœé“¾å¤ªé•¿ï¼Œè¯·æ±‚å¯èƒ½ä¼šç»è¿‡å¾ˆå¤šèŠ‚ç‚¹æ‰è¢«å¤„ç†ï¼Œæ•ˆç‡ä½ã€‚
- ä¸ä¿è¯ä¸€å®šä¼šè¢«å¤„ç†ï¼ˆå¯èƒ½æ²¡äººæ¥æ”¶ï¼‰ã€‚
- è°ƒè¯•å’Œè¿½è¸ªè¾ƒéº»çƒ¦ã€‚

### çŠ¶æ€æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå¯¹è±¡è¡Œä¸ºéšå†…éƒ¨çŠ¶æ€æ”¹å˜è€Œæ”¹å˜ã€‚
 **ç»“æ„**ï¼šContext + Stateã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šçŠ¶æ€æœºã€‚
 **ä¼˜ç‚¹**ï¼šæ¶ˆé™¤ `if-else`ã€‚
 **ç¼ºç‚¹**ï¼šç±»æ•°é‡å¢åŠ ã€‚
 **åº”ç”¨**ï¼šTCP è¿æ¥çŠ¶æ€ã€‚

**Contextï¼ˆç¯å¢ƒç±»ï¼‰**

- æŒæœ‰çŠ¶æ€å¯¹è±¡ã€‚
- å¯¹å¤–æä¾›æ¥å£ï¼Œä½†å†…éƒ¨è°ƒç”¨å§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡ã€‚

```
class OrderContext {
    private OrderState state;

    public OrderContext() {
        this.state = new PendingPayment(); // åˆå§‹çŠ¶æ€
    }

    public void setState(OrderState state) {
        this.state = state;
    }

    public void request() {
        state.handle(this);
    }
}

```



**Stateï¼ˆæŠ½è±¡çŠ¶æ€ï¼‰**

- å®šä¹‰ä¸åŒçŠ¶æ€ä¸‹çš„å…¬å…±è¡Œä¸ºæ¥å£ã€‚

```
interface OrderState {
    void handle(OrderContext context);
}

```



**ConcreteStateï¼ˆå…·ä½“çŠ¶æ€ï¼‰**

- å®ç°å…·ä½“çŠ¶æ€ä¸‹çš„é€»è¾‘ã€‚
- å¯ä»¥å†³å®šæ˜¯å¦åˆ‡æ¢åˆ°å…¶ä»–çŠ¶æ€ã€‚

```java
class PendingPayment implements OrderState {
    @Override
    public void handle(OrderContext context) {
        System.out.println("è®¢å•å¾…æ”¯ä»˜ï¼Œæ‰§è¡Œæ”¯ä»˜æ“ä½œ...");
        context.setState(new Paid());  // åˆ‡æ¢åˆ°å·²æ”¯ä»˜çŠ¶æ€
    }
}

class Paid implements OrderState {
    @Override
    public void handle(OrderContext context) {
        System.out.println("è®¢å•å·²æ”¯ä»˜ï¼Œæ‰§è¡Œå‘è´§æ“ä½œ...");
        context.setState(new Shipped());  // åˆ‡æ¢åˆ°å·²å‘è´§çŠ¶æ€
    }
}

class Shipped implements OrderState {
    @Override
    public void handle(OrderContext context) {
        System.out.println("è®¢å•å·²å‘è´§ï¼Œæ‰§è¡Œç¡®è®¤æ”¶è´§æ“ä½œ...");
        context.setState(new Completed());  // åˆ‡æ¢åˆ°å·²å®ŒæˆçŠ¶æ€
    }
}

class Completed implements OrderState {
    @Override
    public void handle(OrderContext context) {
        System.out.println("è®¢å•å·²å®Œæˆï¼Œä¸å¯æ“ä½œã€‚");
    }
}

```

#### âœ… ä¼˜ç‚¹

- éµå¾ª **å¼€é—­åŸåˆ™**ï¼šæ–°å¢çŠ¶æ€ä¸å½±å“å·²æœ‰é€»è¾‘ã€‚
- çŠ¶æ€åˆ‡æ¢é€»è¾‘æ¸…æ™°ï¼Œé¿å…å¤§é‡ if-elseã€‚
- æŠŠä¸çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ç‹¬ç«‹ç±»é‡Œï¼ŒèŒè´£æ¸…æ™°ã€‚

#### âŒ ç¼ºç‚¹

- çŠ¶æ€ç±»æ•°é‡å¯èƒ½è¿‡å¤šï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚
- çŠ¶æ€åˆ‡æ¢çš„é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªçŠ¶æ€ç±»é‡Œï¼Œç»´æŠ¤æ—¶å¯èƒ½æ¯”è¾ƒéº»çƒ¦ã€‚

### å‘½ä»¤æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ï¼Œæ”¯æŒæ’¤é”€/æ’é˜Ÿæ“ä½œã€‚
 **ç»“æ„**ï¼šInvoker + Command + Receiverã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šäº‹åŠ¡ã€æ—¥å¿—æ“ä½œã€‚
 **ä¼˜ç‚¹**ï¼šè§£è€¦è¯·æ±‚ä¸æ‰§è¡Œã€‚
 **ç¼ºç‚¹**ï¼šç±»æ•°é‡å¢åŠ ã€‚
 **åº”ç”¨**ï¼šGUI æŒ‰é’®å‘½ä»¤ï¼Œæ•°æ®åº“äº‹åŠ¡æ—¥å¿—ã€‚

æŠ½è±¡å‘½ä»¤æ¥å£

```
interface Command {
    void execute();
    void undo();  // æ”¯æŒæ’¤é”€
}

```

å…·ä½“å‘½ä»¤

```
class LightOnCommand implements Command {
    private Light light;

    public LightOnCommand(Light light) {
        this.light = light;
    }

    @Override
    public void execute() {
        light.turnOn();
    }

    @Override
    public void undo() {
        light.turnOff();
    }
}

class LightOffCommand implements Command {
    private Light light;

    public LightOffCommand(Light light) {
        this.light = light;
    }

    @Override
    public void execute() {
        light.turnOff();
    }

    @Override
    public void undo() {
        light.turnOn();
    }
}

```

æ¥æ”¶è€…

```java
class Light {
    public void turnOn() {
        System.out.println("ç”µç¯å·²æ‰“å¼€");
    }

    public void turnOff() {
        System.out.println("ç”µç¯å·²å…³é—­");
    }
}

```

è°ƒç”¨è€…

```java
class RemoteControl {
    private Command command;

    public void setCommand(Command command) {
        this.command = command;
    }

    public void pressButton() {
        command.execute();
    }

    public void pressUndo() {
        command.undo();
    }
}

```

å®¢æˆ·ç«¯

```java
public class Client {
    public static void main(String[] args) {
        Light light = new Light();

        Command lightOn = new LightOnCommand(light);
        Command lightOff = new LightOffCommand(light);

        RemoteControl remote = new RemoteControl();

        remote.setCommand(lightOn);
        remote.pressButton();  // æ‰“å¼€ç¯
        remote.pressUndo();    // æ’¤é”€ â†’ å…³ç¯

        remote.setCommand(lightOff);
        remote.pressButton();  // å…³ç¯
        remote.pressUndo();    // æ’¤é”€ â†’ å¼€ç¯
    }
}

```

#### âœ… ä¼˜ç‚¹

- **è§£è€¦**ï¼šè°ƒç”¨è€…ä¸æ¥æ”¶è€…è§£è€¦ï¼Œæ‰©å±•æ€§é«˜ã€‚
- **å¼€é—­åŸåˆ™**ï¼šæ–°å¢å‘½ä»¤åªéœ€å¢åŠ ç±»ï¼Œä¸å½±å“å·²æœ‰ä»£ç ã€‚
- **å¯æ’¤é”€/é‡åš**ï¼šå‘½ä»¤å¯¹è±¡å¯è®°å½•å†å²ï¼Œæ”¯æŒå›æ»šã€‚
- **ç»„åˆå‘½ä»¤**ï¼šå¯å®ç°å®å‘½ä»¤ï¼ˆå¤šä¸ªå‘½ä»¤ä¸€èµ·æ‰§è¡Œï¼‰ã€‚

#### âŒ ç¼ºç‚¹

- ä¼šå¢åŠ ç±»çš„æ•°é‡ï¼ˆæ¯ä¸ªå‘½ä»¤ä¸€ä¸ªç±»ï¼‰ã€‚
- å¦‚æœå‘½ä»¤è¿‡å¤šï¼Œä»£ç ç»“æ„å¯èƒ½æ¯”è¾ƒå¤æ‚ã€‚

### è¿­ä»£å™¨æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šé¡ºåºè®¿é—®é›†åˆå…ƒç´ è€Œä¸æš´éœ²å†…éƒ¨ç»“æ„ã€‚
 **ç»“æ„**ï¼šIterator æ¥å£ + Aggregateã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šé›†åˆéå†ã€‚
 **ä¼˜ç‚¹**ï¼šç»Ÿä¸€éå†æ–¹å¼ã€‚
 **ç¼ºç‚¹**ï¼šé¢å¤–å¼€é”€ã€‚
 **åº”ç”¨**ï¼šJava çš„ `Iterator` æ¥å£ã€‚

> æä¾›ä¸€ç§æ–¹æ³•ï¼Œé¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œä¸æš´éœ²å…¶å†…éƒ¨è¡¨ç¤ºã€‚

ğŸ“Œ é€šä¿—è¯´ï¼š

- ä¸ç®¡é›†åˆæ˜¯æ•°ç»„ã€é“¾è¡¨è¿˜æ˜¯æ ‘ï¼Œ**ç”¨æˆ·åªéœ€è¦ç”¨è¿­ä»£å™¨æŒ‰é¡ºåºå–å…ƒç´ ï¼Œä¸å¿…å…³å¿ƒå†…éƒ¨æ•°æ®ç»“æ„**ã€‚
- é›†åˆç±»è´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œè¿­ä»£å™¨è´Ÿè´£éå†æ•°æ®ã€‚

Javaæ¥å£

```java
List<String> list = new ArrayList<>();
Iterator<String> it = list.iterator();
while (it.hasNext()) {
    System.out.println(it.next());
}

```

#### âœ… ä¼˜ç‚¹

- éµå¾ª **å•ä¸€èŒè´£åŸåˆ™**ï¼šé›†åˆè´Ÿè´£å­˜å‚¨ï¼Œè¿­ä»£å™¨è´Ÿè´£éå†ã€‚
- å°è£…æ€§å¥½ï¼šä¸ç”¨æš´éœ²é›†åˆçš„å†…éƒ¨ç»“æ„ã€‚
- å¯æ‰©å±•æ€§å¼ºï¼šæ”¯æŒå¤šç§éå†æ–¹å¼ï¼ˆæ­£å‘ã€åå‘ã€è·³è·ƒï¼‰ã€‚

#### âŒ ç¼ºç‚¹

- è¿­ä»£å™¨å¯¹è±¡ä¼šé¢å¤–æ¶ˆè€—å†…å­˜ã€‚
- å¦‚æœé›†åˆè¢«ä¿®æ”¹ï¼Œè¿­ä»£å™¨å¯èƒ½å¤±æ•ˆï¼ˆJava çš„ **fail-fast** æœºåˆ¶ï¼‰ã€‚

### å¤‡å¿˜å½•æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šä¿å­˜å¯¹è±¡å†…éƒ¨çŠ¶æ€ï¼Œæ”¯æŒæ’¤é”€ã€‚
 **ç»“æ„**ï¼šOriginator + Memento + Caretakerã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šç¼–è¾‘å™¨æ’¤é”€ã€æ¸¸æˆå­˜æ¡£ã€‚
 **ä¼˜ç‚¹**ï¼šå°è£…çŠ¶æ€ã€‚
 **ç¼ºç‚¹**ï¼šå†…å­˜æ¶ˆè€—å¤§ã€‚
 **åº”ç”¨**ï¼šIDE Undo åŠŸèƒ½ã€‚

å‘èµ·äºº

````java
class TextEditor {
    private String content;

    public void setContent(String content) {
        this.content = content;
    }

    public String getContent() {
        return content;
    }

    // åˆ›å»ºå¤‡å¿˜å½•
    public Memento save() {
        return new Memento(content);
    }

    // ä»å¤‡å¿˜å½•æ¢å¤
    public void restore(Memento memento) {
        this.content = memento.getContent();
    }

    // å†…éƒ¨ç±»ï¼Œä¿è¯å¤–ç•Œä¸èƒ½éšä¾¿æ“ä½œ
    public static class Memento {
        private final String content;

        private Memento(String content) {
            this.content = content;
        }

        private String getContent() {
            return content;
        }
    }
}
````

ç®¡ç†äºº

```java
class Caretaker {
    private Stack<TextEditor.Memento> history = new Stack<>();

    public void save(TextEditor editor) {
        history.push(editor.save());
    }

    public void undo(TextEditor editor) {
        if (!history.isEmpty()) {
            editor.restore(history.pop());
        }
    }
}

```

å®¢æˆ·ç«¯

```
public class Client {
    public static void main(String[] args) {
        TextEditor editor = new TextEditor();
        Caretaker caretaker = new Caretaker();

        editor.setContent("ç¬¬ä¸€æ¬¡è¾“å…¥");
        caretaker.save(editor);

        editor.setContent("ç¬¬äºŒæ¬¡è¾“å…¥");
        caretaker.save(editor);

        editor.setContent("ç¬¬ä¸‰æ¬¡è¾“å…¥");
        System.out.println("å½“å‰å†…å®¹: " + editor.getContent());

        caretaker.undo(editor);
        System.out.println("æ’¤é”€ä¸€æ¬¡: " + editor.getContent());

        caretaker.undo(editor);
        System.out.println("æ’¤é”€ä¸¤æ¬¡: " + editor.getContent());
    }
}

```



#### âœ… ä¼˜ç‚¹

- å°è£…æ€§å¥½ï¼šä¸æš´éœ²å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚
- ç®€åŒ–äº†å‘èµ·äººï¼šåªéœ€è¦ä¿å­˜/æ¢å¤ï¼Œä¸å…³å¿ƒå†å²çš„ç®¡ç†ã€‚
- ç¬¦åˆ **å•ä¸€èŒè´£åŸåˆ™**ï¼šçŠ¶æ€çš„å­˜å‚¨äº¤ç»™å¤‡å¿˜å½•ï¼Œå†å²ç®¡ç†äº¤ç»™çœ‹æŠ¤è€…ã€‚

#### âŒ ç¼ºç‚¹

- å¯èƒ½æ¶ˆè€—å¤§é‡å†…å­˜ï¼ˆå¦‚æœé¢‘ç¹ä¿å­˜çŠ¶æ€ï¼‰ã€‚
- åœ¨å¤æ‚å¯¹è±¡é‡Œï¼Œå¤‡ä»½çŠ¶æ€çš„å¼€é”€å¯èƒ½å¾ˆå¤§ã€‚
- å¦‚æœéœ€è¦æ”¯æŒâ€œå¢é‡å­˜æ¡£â€ï¼Œå®ç°ä¼šå˜å¤æ‚ã€‚





### è§£é‡Šå™¨æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šä¸ºè¯­è¨€å®šä¹‰æ–‡æ³•ï¼Œå¹¶è§£é‡Šæ‰§è¡Œã€‚
 **ç»“æ„**ï¼šExpression æ¥å£ + Terminal/NonTerminalã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šç®€å•è¯­è¨€è§£æã€‚
 **ä¼˜ç‚¹**ï¼šæ‰©å±•æ€§å¼ºã€‚
 **ç¼ºç‚¹**ï¼šå¤æ‚æ–‡æ³•éš¾ä»¥ç»´æŠ¤ã€‚
 **åº”ç”¨**ï¼šæ­£åˆ™è¡¨è¾¾å¼è§£æå™¨ã€‚

æŠ½è±¡è¡¨è¾¾å¼

```
interface Expression {
    boolean interpret(Map<String, Boolean> context);
}

```

ç»ˆç»“ç¬¦è¡¨è¾¾å¼

```
class VariableExpression implements Expression {
    private String name;

    public VariableExpression(String name) {
        this.name = name;
    }

    @Override
    public boolean interpret(Map<String, Boolean> context) {
        return context.get(name);
    }
}

```

éç»ˆç»“ç¬¦è¡¨è¾¾å¼

```
class AndExpression implements Expression {
    private Expression left, right;

    public AndExpression(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }

    @Override
    public boolean interpret(Map<String, Boolean> context) {
        return left.interpret(context) && right.interpret(context);
    }
}

class OrExpression implements Expression {
    private Expression left, right;

    public OrExpression(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }

    @Override
    public boolean interpret(Map<String, Boolean> context) {
        return left.interpret(context) || right.interpret(context);
    }
}

class NotExpression implements Expression {
    private Expression exp;

    public NotExpression(Expression exp) {
        this.exp = exp;
    }

    @Override
    public boolean interpret(Map<String, Boolean> context) {
        return !exp.interpret(context);
    }
}

```

å®¢æˆ·ç«¯

```
public class Client {
    public static void main(String[] args) {
        // æ„å»ºè¡¨è¾¾å¼: (a AND b) OR (c AND NOT d)
        Expression a = new VariableExpression("a");
        Expression b = new VariableExpression("b");
        Expression c = new VariableExpression("c");
        Expression d = new VariableExpression("d");

        Expression expr = new OrExpression(
            new AndExpression(a, b),
            new AndExpression(c, new NotExpression(d))
        );

        // ä¸Šä¸‹æ–‡èµ‹å€¼
        Map<String, Boolean> context = new HashMap<>();
        context.put("a", true);
        context.put("b", false);
        context.put("c", true);
        context.put("d", false);

        // è§£é‡Š
        boolean result = expr.interpret(context);
        System.out.println("ç»“æœ: " + result);
    }
}

```



#### âœ… ä¼˜ç‚¹

- æ˜“äºæ‰©å±•ï¼šæ¯ä¸ªæ–‡æ³•è§„åˆ™å¯¹åº”ä¸€ä¸ªç±»ï¼Œæ–°å¢è§„åˆ™æ—¶åªéœ€æ–°å¢ç±»ã€‚
- ä»£ç ç»“æ„æ¸…æ™°ï¼šå°†å¤æ‚è¡¨è¾¾å¼çš„è§£æé€»è¾‘æ‹†åˆ†æˆå¯¹è±¡æ ‘ã€‚
- ç¬¦åˆ **å¼€é—­åŸåˆ™**ã€‚

#### âŒ ç¼ºç‚¹

- ç±»æ•°é‡å¯èƒ½çˆ†ç‚¸ï¼ˆæ¯ä¸ªè§„åˆ™ä¸€ä¸ªç±»ï¼‰ã€‚
- å¯¹äºå¤æ‚æ–‡æ³•æ€§èƒ½å·®ï¼Œä¸å¦‚ **ç¼–è¯‘åŸç†é‡Œçš„è§£æå™¨ç”Ÿæˆå·¥å…·ï¼ˆANTLRã€Yaccï¼‰**ã€‚
- å¯è¯»æ€§ä¸‹é™ï¼Œå¤§é‡å°ç±»ä¸åˆ©äºç»´æŠ¤ã€‚



### ä¸­ä»‹è€…æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡ä¸­ä»‹å¯¹è±¡å°è£…å¯¹è±¡ä¹‹é—´çš„äº¤äº’ã€‚
 **ç»“æ„**ï¼šMediator + Colleagueã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šå¤æ‚äº¤äº’ã€‚
 **ä¼˜ç‚¹**ï¼šå‡å°‘å¯¹è±¡é—´è€¦åˆã€‚
 **ç¼ºç‚¹**ï¼šä¸­ä»‹è€…å¯èƒ½è¿‡äºå¤æ‚ã€‚
 **åº”ç”¨**ï¼šMVC çš„ Controllerã€‚

æŠ½è±¡ä¸­ä»‹è€…

```
interface ChatMediator {
    void sendMessage(String msg, User user);
    void addUser(User user);
}

```



å…·ä½“ä¸­ä»‹è€…

```
class ChatRoom implements ChatMediator {
    private List<User> users = new ArrayList<>();

    @Override
    public void sendMessage(String msg, User user) {
        for (User u : users) {
            if (u != user) {
                u.receive(msg);
            }
        }
    }

    @Override
    public void addUser(User user) {
        users.add(user);
    }
}

```

æŠ½è±¡åŒäº‹ç±»

```
abstract class User {
    protected ChatMediator mediator;
    protected String name;

    public User(ChatMediator mediator, String name) {
        this.mediator = mediator;
        this.name = name;
    }

    public abstract void send(String msg);
    public abstract void receive(String msg);
}

```





å…·ä½“åŒäº‹ç±»



```
abstract class User {
    protected ChatMediator mediator;
    protected String name;

    public User(ChatMediator mediator, String name) {
        this.mediator = mediator;
        this.name = name;
    }

    public abstract void send(String msg);
    public abstract void receive(String msg);
}

```

å®¢æˆ·ç«¯

```
public class Client {
    public static void main(String[] args) {
        ChatMediator chat = new ChatRoom();

        User u1 = new ChatUser(chat, "Alice");
        User u2 = new ChatUser(chat, "Bob");
        User u3 = new ChatUser(chat, "Charlie");

        chat.addUser(u1);
        chat.addUser(u2);
        chat.addUser(u3);

        u1.send("å¤§å®¶å¥½ï¼");
        u2.send("ä½ å¥½ Aliceï¼");
    }
}

```

**GUI æ¡†æ¶**

- çª—å£ã€æŒ‰é’®ã€è¾“å…¥æ¡†ä¹‹é—´çš„äº¤äº’ï¼Œé€šå¸¸ç”¨ä¸­ä»‹è€…ï¼ˆå¯¹è¯æ¡†ç®¡ç†å™¨ï¼‰ã€‚

**èŠå¤©å®¤ / æ¶ˆæ¯é˜Ÿåˆ— / äº‹ä»¶æ€»çº¿**

- ç”¨æˆ·æˆ–æ¨¡å—ä¹‹é—´é€šè¿‡ä¸­ä»‹è€…ï¼ˆèŠå¤©å®¤ã€æ¶ˆæ¯ä¸­å¿ƒï¼‰é€šä¿¡ã€‚

**èˆªç­è°ƒåº¦ç³»ç»Ÿ**

- é£æœºï¼ˆåŒäº‹ï¼‰é€šè¿‡å¡”å°ï¼ˆä¸­ä»‹è€…ï¼‰åè°ƒèµ·é™ã€‚

**Spring ApplicationContext**

- Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œé€šè¿‡ IoC å®¹å™¨è°ƒåº¦ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ä¸­ä»‹è€…æ€æƒ³ã€‚

#### âœ… ä¼˜ç‚¹

- é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼ˆè§£è€¦åˆï¼‰ã€‚
- å°†äº¤äº’é€»è¾‘é›†ä¸­åˆ°ä¸€ä¸ªä¸­ä»‹è€…ï¼Œä¾¿äºç»´æŠ¤ã€‚
- ç¬¦åˆ **è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆæœ€å°‘çŸ¥è¯†åŸåˆ™ï¼‰**ï¼šå¯¹è±¡åªä¸ä¸­ä»‹è€…äº¤äº’ã€‚

#### âŒ ç¼ºç‚¹

- ä¸­ä»‹è€…æœ¬èº«å¯èƒ½å˜å¾—è¿‡äºå¤æ‚ï¼Œæ¼”å˜æˆâ€œä¸Šå¸ç±»â€ã€‚
- è¿‡åº¦ä½¿ç”¨ä¼šè®©é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªç±»é‡Œï¼Œç»´æŠ¤å›°éš¾ã€‚

### æ¨¡æ¿æ–¹æ³•æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå­ç±»å®ç°å…·ä½“æ­¥éª¤ã€‚
 **ç»“æ„**ï¼šæŠ½è±¡ç±» + å…·ä½“å®ç°ç±»ã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šç®—æ³•æµç¨‹å›ºå®šï¼Œä½†éƒ¨åˆ†æ­¥éª¤å˜åŒ–ã€‚
 **ä¼˜ç‚¹**ï¼šå¤ç”¨æµç¨‹é€»è¾‘ã€‚
 **ç¼ºç‚¹**ï¼šå­ç±»è‡ªç”±åº¦å—é™ã€‚
 **åº”ç”¨**ï¼š`AbstractList`ï¼ŒSpring `JdbcTemplate`ã€‚

æŠ½è±¡ç±»

```java
abstract class DataProcessor {
    // æ¨¡æ¿æ–¹æ³•ï¼Œè§„å®šæµç¨‹
    public final void process() {
        readData();
        processData();
        writeData();
    }

    protected abstract void readData();
    protected abstract void processData();
    protected abstract void writeData();
}

```

å…·ä½“å­ç±»

```java
class CSVDataProcessor extends DataProcessor {
    @Override
    protected void readData() {
        System.out.println("è¯»å– CSV æ•°æ®");
    }

    @Override
    protected void processData() {
        System.out.println("å¤„ç† CSV æ•°æ®");
    }

    @Override
    protected void writeData() {
        System.out.println("å†™å…¥ CSV ç»“æœ");
    }
}

class ExcelDataProcessor extends DataProcessor {
    @Override
    protected void readData() {
        System.out.println("è¯»å– Excel æ•°æ®");
    }

    @Override
    protected void processData() {
        System.out.println("å¤„ç† Excel æ•°æ®");
    }

    @Override
    protected void writeData() {
        System.out.println("å†™å…¥ Excel ç»“æœ");
    }
}

```

å®¢æˆ·ç«¯

```java
public class Client {
    public static void main(String[] args) {
        DataProcessor csv = new CSVDataProcessor();
        csv.process();

        DataProcessor excel = new ExcelDataProcessor();
        excel.process();
    }
}

```

#### âœ… ä¼˜ç‚¹

- å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚
- éµå¾ª **å¼€é—­åŸåˆ™**ï¼šæ–°å¢å­ç±»å³å¯æ‰©å±•æ–°çš„ç®—æ³•å˜ç§ã€‚
- ä»£ç å¤ç”¨ï¼šæŠŠå…¬å…±éƒ¨åˆ†æå–åˆ°çˆ¶ç±»ã€‚

#### âŒ ç¼ºç‚¹

- å­ç±»æ•°é‡å¯èƒ½è¿‡å¤šï¼ˆæ¯ä¸ªå˜åŒ–ç‚¹ä¸€ä¸ªå­ç±»ï¼‰ã€‚
- ç»§æ‰¿å…³ç³»ä½¿å¾—çˆ¶ç±»å¯¹å­ç±»æœ‰ä¸€å®šçš„é™åˆ¶ï¼ˆä¸å¦‚ç»„åˆçµæ´»ï¼‰ã€‚





### è®¿é—®è€…æ¨¡å¼

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†æ“ä½œä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œé¿å…ä¿®æ”¹ç±»å®šä¹‰ã€‚
 **ç»“æ„**ï¼šVisitor + Elementã€‚
 **é€‚ç”¨åœºæ™¯**ï¼šå¯¹è±¡ç»“æ„ç¨³å®šï¼Œæ“ä½œé¢‘ç¹å˜åŒ–ã€‚
 **ä¼˜ç‚¹**ï¼šå¢åŠ æ–°æ“ä½œç®€å•ã€‚
 **ç¼ºç‚¹**ï¼šå¢åŠ æ–°å…ƒç´ å›°éš¾ã€‚
 **åº”ç”¨**ï¼šç¼–è¯‘å™¨è¯­æ³•æ ‘éå†ã€‚



è®¿é—®è€…æ¥å£

```
interface Visitor {
    void visitFile(FileElement file);
    void visitDirectory(DirectoryElement dir);
}

```



å…·ä½“è®¿é—®è€…

```
class SizeVisitor implements Visitor {
    private int totalSize = 0;

    @Override
    public void visitFile(FileElement file) {
        totalSize += file.getSize();
    }

    @Override
    public void visitDirectory(DirectoryElement dir) {
        for (Element e : dir.getChildren()) {
            e.accept(this); // é€’å½’è®¿é—®
        }
    }

    public int getTotalSize() { return totalSize; }
}

class PrintVisitor implements Visitor {
    private int indent = 0;

    @Override
    public void visitFile(FileElement file) {
        System.out.println("  ".repeat(indent) + file.getName() + " (" + file.getSize() + ")");
    }

    @Override
    public void visitDirectory(DirectoryElement dir) {
        System.out.println("  ".repeat(indent) + "[" + dir.getName() + "]");
        indent++;
        for (Element e : dir.getChildren()) {
            e.accept(this);
        }
        indent--;
    }
}

```



å…ƒç´ æ¥å£

```
interface Element {
    void accept(Visitor visitor);
}

```



å…·ä½“å…ƒç´ 

```
class FileElement implements Element {
    private String name;
    private int size;

    public FileElement(String name, int size) {
        this.name = name;
        this.size = size;
    }

    public int getSize() { return size; }
    public String getName() { return name; }

    @Override
    public void accept(Visitor visitor) {
        visitor.visitFile(this);
    }
}

class DirectoryElement implements Element {
    private String name;
    private List<Element> children = new ArrayList<>();

    public DirectoryElement(String name) {
        this.name = name;
    }

    public void add(Element e) { children.add(e); }
    public List<Element> getChildren() { return children; }
    public String getName() { return name; }

    @Override
    public void accept(Visitor visitor) {
        visitor.visitDirectory(this);
    }
}

```

å®¢æˆ·ç«¯

```
public class Client {
    public static void main(String[] args) {
        DirectoryElement root = new DirectoryElement("root");
        root.add(new FileElement("a.txt", 10));
        root.add(new FileElement("b.txt", 20));

        DirectoryElement subDir = new DirectoryElement("sub");
        subDir.add(new FileElement("c.txt", 5));
        root.add(subDir);

        // æ‰“å°
        PrintVisitor printVisitor = new PrintVisitor();
        root.accept(printVisitor);

        // ç»Ÿè®¡å¤§å°
        SizeVisitor sizeVisitor = new SizeVisitor();
        root.accept(sizeVisitor);
        System.out.println("æ€»å¤§å°: " + sizeVisitor.getTotalSize());
    }
}

```

#### âœ… ä¼˜ç‚¹

- **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šæ•°æ®ç»“æ„ä¸å˜ï¼Œå¢åŠ æ–°æ“ä½œå¾ˆå®¹æ˜“ã€‚
- **æ“ä½œé›†ä¸­**ï¼šå°†æ“ä½œé€»è¾‘é›†ä¸­åˆ°è®¿é—®è€…ç±»ä¸­ï¼Œé¿å…åˆ†æ•£åœ¨å…ƒç´ ç±»é‡Œã€‚
- æ”¯æŒå¯¹ä¸åŒç±»å‹å…ƒç´ åšä¸åŒæ“ä½œã€‚

#### âŒ ç¼ºç‚¹

- **å¢åŠ æ–°å…ƒç´ å›°éš¾**ï¼šå¦‚æœè¦ç»™ç»“æ„ä¸­åŠ ä¸€ç§æ–°å…ƒç´ ï¼Œå°±è¦ä¿®æ”¹æ‰€æœ‰è®¿é—®è€… â†’ è¿èƒŒå¼€é—­åŸåˆ™ã€‚
- **ç»“æ„å¤æ‚**ï¼šéœ€è¦åŒé‡åˆ†æ´¾ï¼ˆ`element.accept(visitor)` â†’ `visitor.visit(element)`ï¼‰ã€‚
- **ä¾µå…¥æ€§**ï¼šå…ƒç´ ç±»å¿…é¡»æš´éœ²è‡ªå·±çš„ `accept()`ï¼Œè®©è®¿é—®è€…è®¿é—®å†…éƒ¨ã€‚
