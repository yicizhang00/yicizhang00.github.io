---
title: å…¨å±€å¼‚å¸¸æ•è·
date: 2026-01-05 16:31:25
tags:

categories:
    - Java
---
# å¯¼è¨€
<img src="https://raw.githubusercontent.com/yicizhang00/image_host/main/blog-img/20260105170251061.png" alt="image-20260105170250771" style="zoom: 25%;" />

ä¸Šå›¾å±•ç¤ºçš„æ˜¯æ­å·å¸‚æ°‘å¡APPåœ¨2026å¹´1æœˆ1æ—¥å‡ºç°çš„ä¸€æ¬¡å…¸å‹é”™è¯¯æ¡ˆä¾‹ï¼šç”±äº`åŸ‹ç‚¹`åŠŸèƒ½çš„å¼‚å¸¸ï¼Œä¸ä»…å¯¼è‡´äº†ä¸»æµç¨‹ä¸­æ–­ï¼Œè¿˜å°†è¯¦ç»†çš„å¼‚å¸¸å †æ ˆä¿¡æ¯æš´éœ²ç»™äº†ç”¨æˆ·ã€‚è¿™ç§ç°è±¡ä¸ä»…å½±å“äº†ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿå­˜åœ¨å®‰å…¨éšæ‚£ã€‚å¦‚ä½•è§„èŒƒåœ°è¿›è¡Œå…¨å±€å¼‚å¸¸å¤„ç†ï¼Œå°†åœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»ã€‚

å…¨å±€å¼‚å¸¸æ•è·æ˜¯ç°ä»£ Java Web é¡¹ç›®æ¶æ„ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚å®ƒèƒ½å¤Ÿé›†ä¸­ç®¡ç†å’Œå¤„ç†ç³»ç»Ÿä¸­å¯èƒ½å‡ºç°çš„å„ç±»å¼‚å¸¸ï¼Œæå‡ API çš„å¥å£®æ€§ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·å‹å¥½æ€§ã€‚é€šè¿‡åˆç†è®¾è®¡å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œä¸ä»…å¯ä»¥ä¿è¯å‰åç«¯æ¥å£çš„å“åº”ä¸€è‡´æ€§ï¼Œè¿˜èƒ½æ–¹ä¾¿æ’æŸ¥å’Œå®šä½é—®é¢˜ã€‚

åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç›´æ¥ä½¿ç”¨ `throw e` ç­‰æ–¹å¼æŠ›å‡ºå¼‚å¸¸ï¼Œå®¹æ˜“å¯¼è‡´å¤§é‡å †æ ˆä¿¡æ¯æš´éœ²ç»™è°ƒç”¨æ–¹ï¼Œæ—¢å½±å“APIå‹å¥½åº¦ï¼Œä¹Ÿå¯èƒ½å¸¦æ¥å®‰å…¨éšæ‚£ã€‚é€šè¿‡ç»Ÿä¸€çš„å…¨å±€å¼‚å¸¸æ•è·æœºåˆ¶ï¼Œå¯ä»¥é¿å…å¼‚å¸¸å †æ ˆæ³„éœ²ï¼Œå°†å¼‚å¸¸æ‹¦æˆªåè½¬åŒ–ä¸ºä¸€è‡´ã€è§„èŒƒçš„å‰ç«¯å“åº”ã€‚åŒæ—¶ï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨è¿˜å¯ä»¥ä½œä¸ºç³»ç»Ÿå…œåº•ä¿æŠ¤â€”â€”å½“ä»£ç ä¸­æœªè¢«æ˜¾å¼æ•è·çš„å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œæ‹¦æˆªè¿™äº›å¼‚å¸¸ï¼Œè¿”å›è§„èŒƒåŒ–é”™è¯¯ä¿¡æ¯ï¼Œé˜²æ­¢ç³»ç»Ÿå´©æºƒæˆ–å¼‚å¸¸ä¿¡æ¯å¤–æ³„ã€‚

æœ¬ç¯‡ç¬”è®°å°†ç³»ç»Ÿæ¢³ç† Spring Boot/Web é¡¹ç›®ä¸­å¸¸è§å¼‚å¸¸çš„ç±»åˆ«ã€è§¦å‘åœºæ™¯å’Œæœ€ä½³æ•è·å®è·µã€‚ä»åŸºç¡€çš„ `@RestControllerAdvice`ã€`@ExceptionHandler` çš„åº”ç”¨ï¼Œåˆ°è¿›é˜¶çš„å„ç±»å¼‚å¸¸ç±»å‹å½’çº³ï¼Œä»¥åŠæ¨èçš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨éª¨æ¶ä»£ç ï¼Œè®©é¡¹ç›®å¼‚å¸¸å¤„ç†æ›´è§„èŒƒã€æ›´æ˜“æ‰©å±•ã€‚



# å…¨å±€å¼‚å¸¸æ•è·
æ ¸å¿ƒæ³¨è§£`@RestControllerAdvice`å’Œ`@ExceptionHandler`

```java
@RestControllerAdvice  // æˆ– @ControllerAdvice + @ResponseBody
public class GlobalExceptionHandler {

    // æ•è·è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusiness(BusinessException ex) {
        return ResponseEntity.badRequest()
                .body(new ErrorResponse("BUSINESS_ERROR", ex.getMessage()));
    }

    // æ•è·æ‰€æœ‰æœªå¤„ç†å¼‚å¸¸ï¼ˆå…œåº•ï¼‰
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGeneral(Exception ex) {
        log.error("Unexpected error", ex);
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(new ErrorResponse("SYSTEM_ERROR", "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"));
    }
}
```

## æœ€ä½³å®è·µ
ä¸€èˆ¬ç»Ÿä¸€çš„å…¨å±€å¼‚å¸¸æ•è·ä½œä¸ºä¸€ä¸ªå…¬å…±ç±»`BaseExceptionHandler`ï¼Œå…·ä½“å¾®æœåŠ¡ä¸­éœ€è¦å¼•å…¥è¿™ä¸ªå…¬å…±ç±»ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª`GlobalExceptionHandler`ç»§æ‰¿ä»–ã€‚
### BaseExceptionHandler å…¬å…±çˆ¶ç±»ç¤ºä¾‹

```java
public abstract class BaseExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ErrorResponse> handleBusiness(BusinessException ex) {
        return ResponseEntity.badRequest()
                .body(new ErrorResponse("BUSINESS_ERROR", ex.getMessage()));
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGeneral(Exception ex) {
        // è¿™é‡Œå‡è®¾æœ‰æ—¥å¿—å·¥å…·
        log.error("Unexpected system exception", ex);
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(new ErrorResponse("SYSTEM_ERROR", "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜"));
    }
}
```

### å„å¾®æœåŠ¡ä¸­çš„ç»§æ‰¿å®ç°

```java
@RestControllerAdvice
public class GlobalExceptionHandler extends BaseExceptionHandler {
    // å¯æ ¹æ®æ¯ä¸ªå¾®æœåŠ¡è‡ªå·±çš„å®é™…æƒ…å†µï¼Œæ·»åŠ æ–°çš„ä¸šåŠ¡å¼‚å¸¸å¤„ç†æ–¹æ³•
    // è‹¥æ— ç‰¹æ®Šéœ€æ±‚ï¼Œå¯ä»¥ä¸å†™ä»£ç ï¼Œå®Œå…¨ç»§æ‰¿çˆ¶ç±»è¡Œä¸º
}
```



## **RestControllerAdvice**

`@RestControllerAdvice` æ˜¯ Spring ä¸­ç”¨äºå…¨å±€å¼‚å¸¸å¤„ç†çš„æ³¨è§£ã€‚å®ƒæ˜¯ `@ControllerAdvice` å’Œ `@ResponseBody` çš„ç»„åˆæ³¨è§£ï¼Œä½œç”¨å¦‚ä¸‹ï¼š

- **æ‹¦æˆªæ‰€æœ‰è¢« `@RestController` æ³¨è§£çš„æ§åˆ¶å™¨ä¸­çš„å¼‚å¸¸**ï¼Œå®ç°ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚
- æ ‡æ³¨åœ¨ç±»ä¸Šåï¼Œè¯¥ç±»ä¸­ç”¨ `@ExceptionHandler` æ³¨è§£çš„æ–¹æ³•ä¼šè‡ªåŠ¨å¤„ç†å…¨å±€èŒƒå›´å†…çš„å¼‚å¸¸ï¼Œå¹¶è¿”å› JSON æ•°æ®ï¼ˆå³è¿”å›ä½“ä¼šè¢«è‡ªåŠ¨åºåˆ—åŒ–ä¸º JSONï¼‰ã€‚
- é€šå¸¸ç”¨äº**RESTful æ¥å£é¡¹ç›®**ï¼Œæå‡å¼‚å¸¸å¤„ç†çš„ç»Ÿä¸€æ€§ä¸è§„èŒƒæ€§ã€‚

**æ€»ç»“**ï¼š  
`@RestControllerAdvice` å¯ä»¥è®©ä½ æŠŠæ‰€æœ‰ Controller å±‚çš„å¼‚å¸¸é›†ä¸­å¤„ç†ï¼Œå¹¶ä¸”æ–¹ä¾¿åœ°è¿”å›ç»Ÿä¸€çš„æ•°æ®ç»“æ„ï¼ˆå¦‚é€šç”¨çš„é”™è¯¯å“åº”å¯¹è±¡ï¼‰ã€‚


## **ExceptionHandler**

`@ExceptionHandler` æ˜¯ Spring æ¡†æ¶æä¾›çš„å¼‚å¸¸å¤„ç†æ³¨è§£ï¼Œç”¨äºå®šä¹‰åœ¨æŸä¸ªæ–¹æ³•ä¸Šï¼Œå½“æŒ‡å®šç±»å‹çš„å¼‚å¸¸åœ¨ Controller å±‚è¢«æŠ›å‡ºæ—¶ï¼Œç”±è¢«æ³¨è§£çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚

- **ä½¿ç”¨æ–¹å¼**ï¼šæ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œå‚æ•°ä¸ºéœ€è¦æ•è·çš„å¼‚å¸¸ç±»å‹ã€‚å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå¼‚å¸¸ç±»ã€‚
- **ä½œç”¨**ï¼šæ•è·å¹¶å¤„ç†æŒ‡å®šå¼‚å¸¸ï¼Œé€šå¸¸ç»“åˆå…¨å±€å¼‚å¸¸å¤„ç†ç±»ï¼ˆå¦‚ä¸Šæ–‡ä¸­çš„ `@RestControllerAdvice`ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œå®ç°å¼‚å¸¸æ•è·å’Œç»Ÿä¸€è¿”å›å“åº”ã€‚

**ç¤ºä¾‹è¯´æ˜ï¼š**

```java
@ExceptionHandler(NullPointerException.class)
public ResponseEntity<String> handleNullPointer(NullPointerException ex) {
    // å¯ä»¥è‡ªè¡Œå¤„ç†å¼‚å¸¸ï¼Œä¾‹å¦‚æ‰“å°æ—¥å¿—ã€ç»„è£…å“åº”ç­‰
    return ResponseEntity.status(HttpStatus.BAD_REQUEST)
        .body("ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š" + ex.getMessage());
}
```
- å½“æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‘ç”Ÿ `NullPointerException`ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨è¿›è¡Œå¤„ç†ã€‚
- æ­¤æ–¹æ³•ç»Ÿä¸€åŒ…è£… HTTP çŠ¶æ€ç ä¸å¼‚å¸¸ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

**æ€»ç»“**ï¼š  
`@ExceptionHandler` ç»“åˆ `@RestControllerAdvice` ä½¿ç”¨ï¼Œå®ç°äº†æ•è·å…¨å±€ Controller å¼‚å¸¸ã€é›†ä¸­å¤„ç†å’Œç»Ÿä¸€è¿”å›æ ¼å¼çš„ç›®çš„ã€‚




# å¸¸ç”¨å¼‚å¸¸ç±»å‹
ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å…¬å…±ç±»ä¸­å°½å¯èƒ½æŠ½è±¡åœ°é€šç”¨æ•è·ä¸€äº›å¸¸ç”¨å¼‚å¸¸ç±»å‹ï¼Œä¾‹å¦‚`HttpRequestMethodNotSupportedException`,`BindException`,`MethodArgumentNotValidException`,`HandlerMethodValidationException`ç­‰
## å¸¸ç”¨å¼‚å¸¸ç±»å‹
| å¼‚å¸¸ç±»                                      | è§¦å‘åœºæ™¯                                                                              | å»ºè®® HTTP çŠ¶æ€ç                   |
| ------------------------------------------- | ------------------------------------------------------------------------------------- | ---------------------------------- |
| `MethodArgumentNotValidException`           | JSR-303/380 æ ¡éªŒå¤±è´¥ï¼ˆ`@Valid` + å¯¹è±¡å‚æ•°ï¼‰                                            | 400 Bad Request                    |
| `BindException`                             | è¡¨å•æäº¤ï¼ˆapplication/x-www-form-urlencodedï¼‰æ ¡éªŒå¤±è´¥                                 | 400 Bad Request                    |
| `ConstraintViolationException`              | æ‰‹åŠ¨è°ƒç”¨ `Validator.validate()` æˆ–è·¯å¾„å˜é‡/è¯·æ±‚å‚æ•°æ ¡éªŒå¤±è´¥                           | 400 Bad Request                    |
| `MissingServletRequestParameterException`   | ç¼ºå°‘å¿…éœ€çš„è¯·æ±‚å‚æ•°ï¼ˆ`@RequestParam(required = true)`ï¼‰                                 | 400 Bad Request                    |
| `ServletRequestBindingException`            | è¯·æ±‚å‚æ•°ç»‘å®šå¤±è´¥ï¼ˆå¦‚ç±»å‹ä¸åŒ¹é…ï¼‰                                                       | 400 Bad Request                    |
| `HandlerMethodValidationException` (Spring6)| æ–¹æ³•çº§ `@Validated` æ ¡éªŒå¤±è´¥                                                           | 400 Bad Request                    |
| `HttpRequestMethodNotSupportedException`    | è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒï¼ˆå¦‚ POST è®¿é—®åªå…è®¸ GET çš„æ¥å£ï¼‰                                         | 405 Method Not Allowed             |
| `NoHandlerFoundException`                   | 404 è·¯å¾„æœªæ‰¾åˆ°ï¼ˆéœ€å¼€å¯ `spring.mvc.throw-exception-if-no-handler-found=true`ï¼‰          | 404 Not Found                      |
| `HttpMediaTypeNotSupportedException`        | è¯·æ±‚å¤´ Content-Type ä¸æ”¯æŒï¼ˆå¦‚æ¥å£è¦æ±‚ application/jsonï¼Œä½†ä¼ äº† text/plainï¼‰           | 415 Unsupported Media Type         |
| `HttpMessageNotReadableException`           | JSON è§£æå¤±è´¥ï¼ˆå¦‚æ ¼å¼é”™è¯¯ã€å­—æ®µç±»å‹ä¸åŒ¹é…ï¼‰                                            | 400 Bad Request                    |
| `HttpMessageNotWritableException`           | å“åº”åºåˆ—åŒ–å¤±è´¥ï¼ˆé€šå¸¸ä¸ºæœåŠ¡å™¨ç¼–ç é—®é¢˜ï¼Œè¾ƒå°‘è§ï¼‰                                         | 500 Internal Server Error          |
| `MissingPathVariableException`              | `@PathVariable` å˜é‡ç¼ºå¤±ï¼ˆè·¯å¾„æ¨¡æ¿ä¸æ³¨è§£ä¸åŒ¹é…ï¼‰                                      | 500ï¼ˆå¼€å‘é—®é¢˜ï¼‰æˆ– 400              |
| `MissingRequestHeaderException`             | ç¼ºå°‘å¿…éœ€çš„è¯·æ±‚å¤´ï¼ˆ`@RequestHeader(required = true)`ï¼‰                                 | 400 Bad Request                    |
| `TypeMismatchException`                     | è·¯å¾„å˜é‡/è¯·æ±‚å‚æ•°ç±»å‹è½¬æ¢å¤±è´¥ï¼ˆå¦‚å­—ç¬¦ä¸²è½¬æ•°å­—å¤±è´¥ï¼‰                                   | 400 Bad Request                    |
| `AsyncRequestTimeoutException`              | å¼‚æ­¥è¯·æ±‚è¶…æ—¶ï¼ˆå¦‚ `DeferredResult`ã€`Callable` ä½¿ç”¨æ—¶ï¼‰                                 | 503 Service Unavailable (æ¨è)     |

ğŸ’¡ **è¯´æ˜**ï¼š
- éƒ¨åˆ†å¼‚å¸¸ï¼ˆå¦‚ HandlerMethodValidationExceptionï¼‰ä¸º Spring6+ æ–°å¢ï¼Œç”¨äºæ–¹æ³•çº§å‚æ•°æ ¡éªŒã€‚
- é»˜è®¤ 404 ä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè¦åœ¨ `application.yml` ä¸­å¼€å¯ `spring.mvc.throw-exception-if-no-handler-found=true` æ‰èƒ½è¢«å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·ã€‚
- 500 ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯å¼€å‘å¤±è¯¯äº§ç”Ÿçš„å¼‚å¸¸ï¼Œä¸€èˆ¬åº”é¿å…æš´éœ²ç»™å‰ç«¯ç”¨æˆ·ã€‚

é™„é…ç½®ç¤ºä¾‹ï¼ˆå¯æ•è· 404 è·¯ç”±å¼‚å¸¸ï¼‰ï¼š
```yaml
spring:
  mvc:
    throw-exception-if-no-handler-found: true
  web:
    resources:
      add-resources: false  # é¿å…é™æ€èµ„æºå¹²æ‰°
```

âœ… ä¸€ã€å‚æ•°æ ¡éªŒ & æ•°æ®ç»‘å®šç±»å¼‚å¸¸

| å¼‚å¸¸ç±»                                | è§¦å‘åœºæ™¯                                                  | å»ºè®® HTTP çŠ¶æ€ç       |
|---------------------------------------|----------------------------------------------------------|----------------------|
| `MethodArgumentNotValidException`     | JSR-303/380 æ ¡éªŒå¤±è´¥ï¼ˆ`@Valid` + å¯¹è±¡å‚æ•°ï¼‰                | 400 Bad Request      |
| `BindException`                       | è¡¨å•æäº¤ï¼ˆ`application/x-www-form-urlencoded`ï¼‰æ ¡éªŒå¤±è´¥   | 400 Bad Request      |
| `ConstraintViolationException`        | æ‰‹åŠ¨è°ƒç”¨ `Validator.validate()` æˆ–è·¯å¾„å˜é‡/è¯·æ±‚å‚æ•°æ ¡éªŒå¤±è´¥ | 400 Bad Request      |
| `MissingServletRequestParameterException` | ç¼ºå°‘å¿…éœ€çš„è¯·æ±‚å‚æ•°ï¼ˆ`@RequestParam(required = true)`ï¼‰      | 400 Bad Request      |
| `ServletRequestBindingException`      | è¯·æ±‚å‚æ•°ç»‘å®šå¤±è´¥ï¼ˆå¦‚ç±»å‹ä¸åŒ¹é…ï¼‰                          | 400 Bad Request      |

ğŸ’¡ **æ³¨æ„**ï¼š

- `MethodArgumentNotValidException` å’Œ `BindException` éƒ½ç»§æ‰¿è‡ª `BindException`ï¼Œä½†é€šå¸¸åˆ†å¼€å¤„ç†ä»¥è·å–ä¸åŒä¿¡æ¯ã€‚
- Spring 6 å¼•å…¥äº† `HandlerMethodValidationException`ï¼ˆç”¨äºæ–¹æ³•çº§ `@Validated`ï¼‰ï¼Œå¯ä½œä¸ºè¡¥å……ã€‚

---

âœ… äºŒã€HTTP æ–¹æ³• & è·¯ç”±ç±»å¼‚å¸¸

| å¼‚å¸¸ç±»                                | è§¦å‘åœºæ™¯                                                         | å»ºè®®çŠ¶æ€ç              |
|---------------------------------------|-----------------------------------------------------------------|-----------------------|
| `HttpRequestMethodNotSupportedException` | è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒï¼ˆå¦‚ POST è®¿é—®åªå…è®¸ GET çš„æ¥å£ï¼‰                  | 405 Method Not Allowed|
| `NoHandlerFoundException`                | 404 è·¯å¾„æœªæ‰¾åˆ°ï¼ˆéœ€å¼€å¯ `spring.mvc.throw-exception-if-no-handler-found=true`ï¼‰ | 404 Not Found      |

âš ï¸ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot å¯¹ 404 è¿”å› Whitelabel Error Pageï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

è‹¥æƒ³åœ¨ `@ControllerAdvice` ä¸­æ•è· 404ï¼Œå¿…é¡»é…ç½®ï¼š

```yaml
spring:
  mvc:
    throw-exception-if-no-handler-found: true
  web:
    resources:
      add-resources: false  # é¿å…é™æ€èµ„æºå¹²æ‰°
```

---

âœ… ä¸‰ã€æ¶ˆæ¯è½¬æ¢ & å†…å®¹åå•†å¼‚å¸¸

| å¼‚å¸¸ç±»                                | è§¦å‘åœºæ™¯                                                              | å»ºè®®çŠ¶æ€ç               |
|---------------------------------------|----------------------------------------------------------------------|------------------------|
| `HttpMediaTypeNotSupportedException`  | è¯·æ±‚å¤´ Content-Type ä¸æ”¯æŒï¼ˆå¦‚æ¥å£è¦æ±‚ application/jsonï¼Œä½†ä¼  text/plainï¼‰| 415 Unsupported Media Type|
| `HttpMessageNotReadableException`     | JSON è§£æå¤±è´¥ï¼ˆå¦‚æ ¼å¼é”™è¯¯ã€å­—æ®µç±»å‹ä¸åŒ¹é…ï¼‰                            | 400 Bad Request        |
| `HttpMessageNotWritableException`     | åºåˆ—åŒ–å“åº”å¤±è´¥ï¼ˆè¾ƒå°‘è§ï¼‰                                               | 500 Internal Server Error|

---

âœ… å››ã€è·¯å¾„å˜é‡ & è¯·æ±‚å¤´å¼‚å¸¸

| å¼‚å¸¸ç±»                                | è§¦å‘åœºæ™¯                                              | å»ºè®®çŠ¶æ€ç             |
|---------------------------------------|------------------------------------------------------|----------------------|
| `MissingPathVariableException`        | `@PathVariable` å˜é‡ç¼ºå¤±ï¼ˆè·¯å¾„æ¨¡æ¿ä¸æ³¨è§£ä¸åŒ¹é…ï¼‰       | 500ï¼ˆå¼€å‘é—®é¢˜ï¼‰æˆ– 400 |
| `MissingRequestHeaderException`       | ç¼ºå°‘å¿…éœ€çš„è¯·æ±‚å¤´ï¼ˆ`@RequestHeader(required = true)`ï¼‰ | 400 Bad Request      |
| `TypeMismatchException`               | è·¯å¾„å˜é‡/è¯·æ±‚å‚æ•°ç±»å‹è½¬æ¢å¤±è´¥ï¼ˆå¦‚å­—ç¬¦ä¸²è½¬æ•°å­—å¤±è´¥ï¼‰    | 400 Bad Request      |

---

âœ… äº”ã€å¼‚æ­¥ & è¶…æ—¶å¼‚å¸¸ï¼ˆé«˜çº§ï¼‰

| å¼‚å¸¸ç±»                        | è§¦å‘åœºæ™¯                                 | å»ºè®®çŠ¶æ€ç         |
|------------------------------|------------------------------------------|-------------------|
| `AsyncRequestTimeoutException`| å¼‚æ­¥è¯·æ±‚è¶…æ—¶ï¼ˆä½¿ç”¨ `DeferredResult` æˆ– `Callable`ï¼‰ | 503 Service Unavailable |

---

âœ… å…­ã€æ¨èçš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨éª¨æ¶

```java
@RestControllerAdvice
@Slf4j
public class GlobalWebExceptionHandler {

    // 1. å‚æ•°æ ¡éªŒå¤±è´¥ï¼ˆ@Valid å¯¹è±¡å‚æ•°ï¼‰
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<String> handleValidation(MethodArgumentNotValidException ex) {
        // æå–æ ¡éªŒå¤±è´¥ä¿¡æ¯
        String errorMsg = ex.getBindingResult().getFieldErrors()
            .stream().map(e -> e.getField() + ": " + e.getDefaultMessage())
            .reduce((a, b) -> a + "; " + b).orElse("å‚æ•°æ ¡éªŒå¤±è´¥");
        log.warn("å‚æ•°æ ¡éªŒå¼‚å¸¸: {}", errorMsg);
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errorMsg);
    }

    // 2. è¡¨å•å‚æ•°æ ¡éªŒ
    @ExceptionHandler(BindException.class)
    public ResponseEntity<String> handleBind(BindException ex) {
        String errorMsg = ex.getBindingResult().getFieldErrors()
            .stream().map(e -> e.getField() + ": " + e.getDefaultMessage())
            .reduce((a, b) -> a + "; " + b).orElse("å‚æ•°ç»‘å®šå¼‚å¸¸");
        log.warn("å‚æ•°ç»‘å®šå¼‚å¸¸: {}", errorMsg);
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errorMsg);
    }

    // 3. æ–¹æ³•å‚æ•°æ ¡éªŒï¼ˆå¦‚ @Validated + @PathVariableï¼‰
    @ExceptionHandler(ConstraintViolationException.class)
    public ResponseEntity<String> handleConstraint(ConstraintViolationException ex) {
        String errorMsg = ex.getConstraintViolations()
            .stream().map(v -> v.getPropertyPath() + ": " + v.getMessage())
            .reduce((a, b) -> a + "; " + b).orElse("çº¦æŸæ ¡éªŒå¼‚å¸¸");
        log.warn("çº¦æŸæ ¡éªŒå¼‚å¸¸: {}", errorMsg);
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errorMsg);
    }

    // 4. ç¼ºå°‘è¯·æ±‚å‚æ•°
    @ExceptionHandler(MissingServletRequestParameterException.class)
    public ResponseEntity<String> handleMissingParam(MissingServletRequestParameterException ex) {
        String errorMsg = "ç¼ºå°‘è¯·æ±‚å‚æ•°: " + ex.getParameterName();
        log.warn(errorMsg);
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errorMsg);
    }

    // 5. HTTP è¯·æ±‚æ–¹æ³•ä¸å…è®¸
    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)
    public ResponseEntity<String> handleMethodNotSupported(HttpRequestMethodNotSupportedException ex) {
        String errorMsg = "è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒ: " + ex.getMethod();
        log.warn(errorMsg);
        return ResponseEntity.status(HttpStatus.METHOD_NOT_ALLOWED).body(errorMsg);
    }

    // 6. NoHandlerFoundExceptionï¼ˆå³ 404ï¼‰
    @ExceptionHandler(NoHandlerFoundException.class)
    public ResponseEntity<String> handleNoHandler(NoHandlerFoundException ex) {
        String errorMsg = "è¯·æ±‚è·¯å¾„ä¸å­˜åœ¨: " + ex.getRequestURL();
        log.warn(errorMsg);
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(errorMsg);
    }

    // 7. JSONè§£æå¤±è´¥
    @ExceptionHandler(HttpMessageNotReadableException.class)
    public ResponseEntity<String> handleNotReadable(HttpMessageNotReadableException ex) {
        log.warn("æ¶ˆæ¯ä¸å¯è¯»: {}", ex.getMessage());
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body("è¯·æ±‚ä½“JSONæ ¼å¼é”™è¯¯");
    }

    // 8. Content-Typeä¸æ”¯æŒ
    @ExceptionHandler(HttpMediaTypeNotSupportedException.class)
    public ResponseEntity<String> handleMediaType(HttpMediaTypeNotSupportedException ex) {
        log.warn("ä¸æ”¯æŒçš„Content-Type: {}", ex.getContentType());
        return ResponseEntity.status(HttpStatus.UNSUPPORTED_MEDIA_TYPE).body("ä¸æ”¯æŒçš„Content-Type");
    }

    // 9. ç»Ÿä¸€å¤„ç†ï¼ˆå…œåº•ï¼‰
    @ExceptionHandler(Exception.class)
    public ResponseEntity<String> handleDefault(Exception ex) {
        log.error("æœåŠ¡å™¨å†…éƒ¨å¼‚å¸¸", ex);
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body("æœåŠ¡å™¨å¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
    }
}
```

