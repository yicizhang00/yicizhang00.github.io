---
title: JVM基础
date: 2025-08-12 01:55:16
tags:
categories:  
  - Java
  - JVM
---

# 内存管理

## 运行时数据区

运行时数据区包括：方法区、虚拟机栈、本地方法栈、堆、和程序计数器。

<img src="https://raw.githubusercontent.com/yicizhang00/image_host/main/blog-img/202509010119605.png" alt="image-20250901011910374" style="zoom: 33%;" />

### 程序计数器

程序计数器（PC）是 JVM 线程私有的寄存器，用于记录当前线程执行的字节码指令地址。为了让线程切换时，下一线程能够准确回到正确的执行位置，每个线程都有一个独立的程序计数器。

| **场景**              | **PC 的值**            | **原因**                                                     |
| :-------------------- | :--------------------- | :----------------------------------------------------------- |
| **执行 Java 字节码**  | 指向当前字节码指令地址 | JVM 正常执行 Java 代码时，PC 有效。                          |
| **执行 JNI 本地代码** | **可能为 NULL**        | 当调用 JNI 本地方法时，执行权会从 JVM 托管的代码切换到操作系统直接执行的本地机器码（通常是 C/C++ 编译的二进制代码）。此时，程序计数器会转而记录**本地机器码的指令地址**，而非 Java 代码的行号。 |

**注意**：程序计数器是唯一一个不会出现 `OutOfMemoryError` 的内存区域，它的生命周期随着线程的创建而创建，随着线程的结束而死亡。

### Java虚拟机栈

当每个方法被执行时，虚拟机都会创建一个栈帧（Stack Frame），记录当前方法的局部变量表、操作数栈、动态连接、方法出口等信息。

| 组成部分                               | 说明                                                   |
| :------------------------------------- | :----------------------------------------------------- |
| **局部变量表（Local Variable Table）** | 存储方法参数和局部变量，按索引访问（从 0 开始）。      |
| **操作数栈（Operand Stack）**          | 用于字节码指令计算（如 `iadd`, `invokevirtual`）。     |
| **动态链接（Dynamic Linking）**        | 支持方法调用时的动态绑定（如虚方法调用）。             |
| **返回地址（Return Address）**         | 方法执行完成后返回的地址（用于 `return` 或异常处理）。 |

其中局部变量表

### 本地方法栈

本地方法栈（Native M ethod Stacks）与虚拟机栈所发挥的作用是非常相似的，其区别只是虚拟机栈为虚拟机执行Java方法（也就是字节码）服务，而本地方法栈则是为虚拟机使用到的本地（Native）方法服务，即JNI方法。

### 堆



### 方法区